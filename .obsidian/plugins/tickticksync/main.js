"use strict";const F=require("obsidian"),ra=!1;var Ss=Array.isArray,Xl=Array.prototype.indexOf,Ir=Array.from,Qa=Object.defineProperty,Ai=Object.getOwnPropertyDescriptor,Za=Object.getOwnPropertyDescriptors,Ql=Object.prototype,Zl=Array.prototype,_r=Object.getPrototypeOf,aa=Object.isExtensible;const Ni=()=>{};function ec(s){return typeof(s==null?void 0:s.then)=="function"}function tc(s){return s()}function nn(s){for(var e=0;e<s.length;e++)s[e]()}function Zt(s,e){if(Array.isArray(s))return s;if(!(Symbol.iterator in s))return Array.from(s);const t=[];for(const i of s)if(t.push(i),t.length===e)break;return t}const gt=2,eo=4,yn=8,Sr=16,qt=32,qi=64,rn=128,rt=256,an=512,ze=1024,Nt=2048,ni=4096,jt=8192,wn=16384,ic=32768,bn=65536,to=1<<17,sc=1<<19,io=1<<20,ar=1<<21,Yt=Symbol("$state"),nc=Symbol("legacy props");let gs=[],or=[];function so(){var s=gs;gs=[],nn(s)}function rc(){var s=or;or=[],nn(s)}function Pr(s){gs.length===0&&queueMicrotask(so),gs.push(s)}function ac(){gs.length>0&&so(),or.length>0&&rc()}function no(s){return s===this.v}function ro(s,e){return s!=s?e==e:s!==e||s!==null&&typeof s=="object"||typeof s=="function"}function Er(s){return!ro(s,this.v)}function oc(s){throw new Error("https://svelte.dev/e/effect_in_teardown")}function lc(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function cc(s){throw new Error("https://svelte.dev/e/effect_orphan")}function uc(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function dc(s){throw new Error("https://svelte.dev/e/props_invalid_value")}function fc(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function hc(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function pc(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}let Hi=!1,gc=!1;function mc(){Hi=!0}const Or=1,Cr=2,ao=4,vc=8,kc=16,yc=1,wc=2,bc=4,Tc=8,Ic=16,_c=1,Sc=2,Re=Symbol(),Pc="http://www.w3.org/1999/xhtml";function oo(s){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}let he=null;function on(s){he=s}function Ze(s,e=!1,t){var i=he={p:he,c:null,d:!1,e:null,m:!1,s,x:null,l:null};Hi&&!e&&(he.l={s:null,u:null,r1:[],r2:mi(!1)}),Ar(()=>{i.d=!0})}function et(s){const e=he;if(e!==null){const a=e.e;if(a!==null){var t=pe,i=fe;e.e=null;try{for(var n=0;n<a.length;n++){var r=a[n];Lt(r.effect),vt(r.reaction),Ps(r.fn)}}finally{Lt(t),vt(i)}}he=e.p,e.m=!0}return{}}function Ki(){return!Hi||he!==null&&he.l===null}function li(s){if(typeof s!="object"||s===null||Yt in s)return s;const e=_r(s);if(e!==Ql&&e!==Zl)return s;var t=new Map,i=Ss(s),n=Ht(0),r=fe,a=o=>{var l=fe;vt(r);var c=o();return vt(l),c};return i&&t.set("length",Ht(s.length)),new Proxy(s,{defineProperty(o,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&fc();var f=t.get(l);return f===void 0?(f=a(()=>Ht(c.value)),t.set(l,f)):x(f,a(()=>li(c.value))),!0},deleteProperty(o,l){var c=t.get(l);if(c===void 0)l in o&&(t.set(l,a(()=>Ht(Re))),Kn(n));else{if(i&&typeof l=="string"){var f=t.get("length"),p=Number(l);Number.isInteger(p)&&p<f.v&&x(f,p)}x(c,Re),Kn(n)}return!0},get(o,l,c){var u;if(l===Yt)return s;var f=t.get(l),p=l in o;if(f===void 0&&(!p||(u=Ai(o,l))!=null&&u.writable)&&(f=a(()=>Ht(li(p?o[l]:Re))),t.set(l,f)),f!==void 0){var d=P(f);return d===Re?void 0:d}return Reflect.get(o,l,c)},getOwnPropertyDescriptor(o,l){var c=Reflect.getOwnPropertyDescriptor(o,l);if(c&&"value"in c){var f=t.get(l);f&&(c.value=P(f))}else if(c===void 0){var p=t.get(l),d=p==null?void 0:p.v;if(p!==void 0&&d!==Re)return{enumerable:!0,configurable:!0,value:d,writable:!0}}return c},has(o,l){var d;if(l===Yt)return!0;var c=t.get(l),f=c!==void 0&&c.v!==Re||Reflect.has(o,l);if(c!==void 0||pe!==null&&(!f||(d=Ai(o,l))!=null&&d.writable)){c===void 0&&(c=a(()=>Ht(f?li(o[l]):Re)),t.set(l,c));var p=P(c);if(p===Re)return!1}return f},set(o,l,c,f){var b;var p=t.get(l),d=l in o;if(i&&l==="length")for(var u=c;u<p.v;u+=1){var g=t.get(u+"");g!==void 0?x(g,Re):u in o&&(g=a(()=>Ht(Re)),t.set(u+"",g))}p===void 0?(!d||(b=Ai(o,l))!=null&&b.writable)&&(p=a(()=>Ht(void 0)),x(p,a(()=>li(c))),t.set(l,p)):(d=p.v!==Re,x(p,a(()=>li(c))));var h=Reflect.getOwnPropertyDescriptor(o,l);if(h!=null&&h.set&&h.set.call(f,c),!d){if(i&&typeof l=="string"){var m=t.get("length"),v=Number(l);Number.isInteger(v)&&v>=m.v&&x(m,v+1)}Kn(n)}return!0},ownKeys(o){P(n);var l=Reflect.ownKeys(o).filter(p=>{var d=t.get(p);return d===void 0||d.v!==Re});for(var[c,f]of t)f.v!==Re&&!(c in o)&&l.push(c);return l},setPrototypeOf(){hc()}})}function Kn(s,e=1){x(s,s.v+e)}function oa(s){try{if(s!==null&&typeof s=="object"&&Yt in s)return s[Yt]}catch{}return s}function Ec(s,e){return Object.is(oa(s),oa(e))}function Fi(s){var e=gt|Nt,t=fe!==null&&(fe.f&gt)!==0?fe:null;return pe===null||t!==null&&(t.f&rt)!==0?e|=rt:pe.f|=io,{ctx:he,deps:null,effects:null,equals:no,f:e,fn:s,reactions:null,rv:0,v:null,wv:0,parent:t??pe}}function ei(s){const e=Fi(s);return mo(e),e}function ti(s){const e=Fi(s);return e.equals=Er,e}function lo(s){var e=s.effects;if(e!==null){s.effects=null;for(var t=0;t<e.length;t+=1)ii(e[t])}}function Oc(s){for(var e=s.parent;e!==null;){if((e.f&gt)===0)return e;e=e.parent}return null}function co(s){var e,t=pe;Lt(Oc(s));try{lo(s),e=wo(s)}finally{Lt(t)}return e}function uo(s){var e=co(s);if(s.equals(e)||(s.v=e,s.wv=ko()),!Vi){var t=(Wt||(s.f&rt)!==0)&&s.deps!==null?ni:ze;kt(s,t)}}const ms=new Map;function mi(s,e){var t={f:0,v:s,reactions:null,equals:no,rv:0,wv:0};return t}function Ht(s,e){const t=mi(s);return mo(t),t}function z(s,e=!1){var i;const t=mi(s);return e||(t.equals=Er),Hi&&he!==null&&he.l!==null&&((i=he.l).s??(i.s=[])).push(t),t}function x(s,e,t=!1){fe!==null&&!Ot&&Ki()&&(fe.f&(gt|Sr))!==0&&!(Ve!=null&&Ve.includes(s))&&pc();let i=t?li(e):e;return Jt(s,i)}function Jt(s,e){if(!s.equals(e)){var t=s.v;Vi?ms.set(s,e):ms.set(s,t),s.v=e,(s.f&gt)!==0&&((s.f&Nt)!==0&&co(s),kt(s,(s.f&rt)===0?ze:ni)),s.wv=ko(),fo(s,Nt),Ki()&&pe!==null&&(pe.f&ze)!==0&&(pe.f&(qt|qi))===0&&(dt===null?Dc([s]):dt.push(s))}return e}function fo(s,e){var t=s.reactions;if(t!==null)for(var i=Ki(),n=t.length,r=0;r<n;r++){var a=t[r],o=a.f;(o&Nt)===0&&(!i&&a===pe||(kt(a,e),(o&(ze|rt))!==0&&((o&gt)!==0?fo(a,ni):Pn(a))))}}function Cc(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let Ac=!1;var la,ho,po,go;function Nc(){if(la===void 0){la=window,ho=/Firefox/.test(navigator.userAgent);var s=Element.prototype,e=Node.prototype,t=Text.prototype;po=Ai(e,"firstChild").get,go=Ai(e,"nextSibling").get,aa(s)&&(s.__click=void 0,s.__className=void 0,s.__attributes=null,s.__style=void 0,s.__e=void 0),aa(t)&&(t.__t=void 0)}}function Tn(s=""){return document.createTextNode(s)}function ln(s){return po.call(s)}function In(s){return go.call(s)}function N(s,e){return ln(s)}function mt(s,e){{var t=ln(s);return t instanceof Comment&&t.data===""?In(t):t}}function $(s,e=1,t=!1){let i=s;for(;e--;)i=In(i);return i}function Lc(s){s.textContent=""}let Js=!1,cn=!1,un=null,fi=!1,Vi=!1;function ca(s){Vi=s}let us=[];let fe=null,Ot=!1;function vt(s){fe=s}let pe=null;function Lt(s){pe=s}let Ve=null;function mo(s){fe!==null&&fe.f&ar&&(Ve===null?Ve=[s]:Ve.push(s))}let He=null,st=0,dt=null;function Dc(s){dt=s}let vo=1,dn=0,Wt=!1,Gt=null;function ko(){return++vo}function zi(s){var p;var e=s.f;if((e&Nt)!==0)return!0;if((e&ni)!==0){var t=s.deps,i=(e&rt)!==0;if(t!==null){var n,r,a=(e&an)!==0,o=i&&pe!==null&&!Wt,l=t.length;if(a||o){var c=s,f=c.parent;for(n=0;n<l;n++)r=t[n],(a||!((p=r==null?void 0:r.reactions)!=null&&p.includes(c)))&&(r.reactions??(r.reactions=[])).push(c);a&&(c.f^=an),o&&f!==null&&(f.f&rt)===0&&(c.f^=rt)}for(n=0;n<l;n++)if(r=t[n],zi(r)&&uo(r),r.wv>s.wv)return!0}(!i||pe!==null&&!Wt)&&kt(s,ze)}return!1}function Fc(s,e){for(var t=e;t!==null;){if((t.f&rn)!==0)try{t.fn(s);return}catch{t.f^=rn}t=t.parent}throw Js=!1,s}function ua(s){return(s.f&wn)===0&&(s.parent===null||(s.parent.f&rn)===0)}function _n(s,e,t,i){if(Js){if(t===null&&(Js=!1),ua(e))throw s;return}if(t!==null&&(Js=!0),Fc(s,e),ua(e))throw s}function yo(s,e,t=!0){var i=s.reactions;if(i!==null)for(var n=0;n<i.length;n++){var r=i[n];Ve!=null&&Ve.includes(s)||((r.f&gt)!==0?yo(r,e,!1):e===r&&(t?kt(r,Nt):(r.f&ze)!==0&&kt(r,ni),Pn(r)))}}function wo(s){var u;var e=He,t=st,i=dt,n=fe,r=Wt,a=Ve,o=he,l=Ot,c=s.f;He=null,st=0,dt=null,Wt=(c&rt)!==0&&(Ot||!fi||fe===null),fe=(c&(qt|qi))===0?s:null,Ve=null,on(s.ctx),Ot=!1,dn++,s.f|=ar;try{var f=(0,s.fn)(),p=s.deps;if(He!==null){var d;if(fn(s,st),p!==null&&st>0)for(p.length=st+He.length,d=0;d<He.length;d++)p[st+d]=He[d];else s.deps=p=He;if(!Wt)for(d=st;d<p.length;d++)((u=p[d]).reactions??(u.reactions=[])).push(s)}else p!==null&&st<p.length&&(fn(s,st),p.length=st);if(Ki()&&dt!==null&&!Ot&&p!==null&&(s.f&(gt|ni|Nt))===0)for(d=0;d<dt.length;d++)yo(dt[d],s);return n!==null&&n!==s&&(dn++,dt!==null&&(i===null?i=dt:i.push(...dt))),f}finally{He=e,st=t,dt=i,fe=n,Wt=r,Ve=a,on(o),Ot=l,s.f^=ar}}function xc(s,e){let t=e.reactions;if(t!==null){var i=Xl.call(t,s);if(i!==-1){var n=t.length-1;n===0?t=e.reactions=null:(t[i]=t[n],t.pop())}}t===null&&(e.f&gt)!==0&&(He===null||!He.includes(e))&&(kt(e,ni),(e.f&(rt|an))===0&&(e.f^=an),lo(e),fn(e,0))}function fn(s,e){var t=s.deps;if(t!==null)for(var i=e;i<t.length;i++)xc(s,t[i])}function Sn(s){var e=s.f;if((e&wn)===0){kt(s,ze);var t=pe,i=he,n=fi;pe=s,fi=!0;try{(e&Sr)!==0?zc(s):_o(s),Io(s);var r=wo(s);s.teardown=typeof r=="function"?r:null,s.wv=vo;var a=s.deps,o;ra&&gc&&s.f&Nt}catch(l){_n(l,s,t,i||s.ctx)}finally{fi=n,pe=t}}}function $c(){try{uc()}catch(s){if(un!==null)_n(s,un,null);else throw s}}function bo(){var s=fi;try{var e=0;for(fi=!0;us.length>0;){e++>1e3&&$c();var t=us,i=t.length;us=[];for(var n=0;n<i;n++){var r=jc(t[n]);Mc(r)}ms.clear()}}finally{cn=!1,fi=s,un=null}}function Mc(s){var e=s.length;if(e!==0)for(var t=0;t<e;t++){var i=s[t];if((i.f&(wn|jt))===0)try{zi(i)&&(Sn(i),i.deps===null&&i.first===null&&i.nodes_start===null&&(i.teardown===null?So(i):i.fn=null))}catch(n){_n(n,i,null,i.ctx)}}}function Pn(s){cn||(cn=!0,queueMicrotask(bo));for(var e=un=s;e.parent!==null;){e=e.parent;var t=e.f;if((t&(qi|qt))!==0){if((t&ze)===0)return;e.f^=ze}}us.push(e)}function jc(s){for(var e=[],t=s;t!==null;){var i=t.f,n=(i&(qt|qi))!==0,r=n&&(i&ze)!==0;if(!r&&(i&jt)===0){if((i&eo)!==0)e.push(t);else if(n)t.f^=ze;else try{zi(t)&&Sn(t)}catch(l){_n(l,t,null,t.ctx)}var a=t.first;if(a!==null){t=a;continue}}var o=t.parent;for(t=t.next;t===null&&o!==null;)t=o.next,o=o.parent}return e}function Rc(s){for(var e;;){if(ac(),us.length===0)return e;cn=!0,bo()}}function P(s){var e=s.f,t=(e&gt)!==0;if(Gt!==null&&Gt.add(s),fe!==null&&!Ot){if(!(Ve!=null&&Ve.includes(s))){var i=fe.deps;s.rv<dn&&(s.rv=dn,He===null&&i!==null&&i[st]===s?st++:He===null?He=[s]:(!Wt||!He.includes(s))&&He.push(s))}}else if(t&&s.deps===null&&s.effects===null){var n=s,r=n.parent;r!==null&&(r.f&rt)===0&&(n.f^=rt)}return t&&(n=s,zi(n)&&uo(n)),Vi&&ms.has(s)?ms.get(s):s.v}function Bc(s){var e=Gt;Gt=new Set;var t=Gt,i;try{if(Qe(s),e!==null)for(i of Gt)e.add(i)}finally{Gt=e}return t}function vs(s){var e=Bc(()=>Qe(s));for(var t of e)if((t.f&to)!==0)for(const i of t.deps||[])(i.f&gt)===0&&Jt(i,i.v);else Jt(t,t.v)}function Qe(s){var e=Ot;try{return Ot=!0,s()}finally{Ot=e}}const Uc=-7169;function kt(s,e){s.f=s.f&Uc|e}function qc(s){if(!(typeof s!="object"||!s||s instanceof EventTarget)){if(Yt in s)lr(s);else if(!Array.isArray(s))for(let e in s){const t=s[e];typeof t=="object"&&t&&Yt in t&&lr(t)}}}function lr(s,e=new Set){if(typeof s=="object"&&s!==null&&!(s instanceof EventTarget)&&!e.has(s)){e.add(s),s instanceof Date&&s.getTime();for(let i in s)try{lr(s[i],e)}catch{}const t=_r(s);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const i=Za(t);for(let n in i){const r=i[n].get;if(r)try{r.call(s)}catch{}}}}}function To(s){pe===null&&fe===null&&cc(),fe!==null&&(fe.f&rt)!==0&&pe===null&&lc(),Vi&&oc()}function Hc(s,e){var t=e.last;t===null?e.last=e.first=s:(t.next=s,s.prev=t,e.last=s)}function Gi(s,e,t,i=!0){var n=pe,r={ctx:he,deps:null,nodes_start:null,nodes_end:null,f:s|Nt,first:null,fn:e,last:null,next:null,parent:n,prev:null,teardown:null,transitions:null,wv:0};if(t)try{Sn(r),r.f|=ic}catch(l){throw ii(r),l}else e!==null&&Pn(r);var a=t&&r.deps===null&&r.first===null&&r.nodes_start===null&&r.teardown===null&&(r.f&(io|rn))===0;if(!a&&i&&(n!==null&&Hc(r,n),fe!==null&&(fe.f&gt)!==0)){var o=fe;(o.effects??(o.effects=[])).push(r)}return r}function Ar(s){const e=Gi(yn,null,!1);return kt(e,ze),e.teardown=s,e}function cr(s){To();var e=pe!==null&&(pe.f&qt)!==0&&he!==null&&!he.m;if(e){var t=he;(t.e??(t.e=[])).push({fn:s,effect:pe,reaction:fe})}else{var i=Ps(s);return i}}function Kc(s){return To(),Os(s)}function Vc(s){const e=Gi(qi,s,!0);return(t={})=>new Promise(i=>{t.outro?Xt(e,()=>{ii(e),i(void 0)}):(ii(e),i(void 0))})}function Ps(s){return Gi(eo,s,!1)}function Ge(s,e){var t=he,i={effect:null,ran:!1};t.l.r1.push(i),i.effect=Os(()=>{s(),!i.ran&&(i.ran=!0,x(t.l.r2,!0),Qe(e))})}function Es(){var s=he;Os(()=>{if(P(s.l.r2)){for(var e of s.l.r1){var t=e.effect;(t.f&ze)!==0&&kt(t,ni),zi(t)&&Sn(t),e.ran=!1}s.l.r2.v=!1}})}function Os(s){return Gi(yn,s,!0)}function ie(s,e=[],t=Fi){const i=e.map(t);return Cs(()=>s(...i.map(P)))}function Cs(s,e=0){return Gi(yn|Sr|e,s,!0)}function Rt(s,e=!0){return Gi(yn|qt,s,!0,e)}function Io(s){var e=s.teardown;if(e!==null){const t=Vi,i=fe;ca(!0),vt(null);try{e.call(null)}finally{ca(t),vt(i)}}}function _o(s,e=!1){var t=s.first;for(s.first=s.last=null;t!==null;){var i=t.next;(t.f&qi)!==0?t.parent=null:ii(t,e),t=i}}function zc(s){for(var e=s.first;e!==null;){var t=e.next;(e.f&qt)===0&&ii(e),e=t}}function ii(s,e=!0){var t=!1;(e||(s.f&sc)!==0)&&s.nodes_start!==null&&(Gc(s.nodes_start,s.nodes_end),t=!0),_o(s,e&&!t),fn(s,0),kt(s,wn);var i=s.transitions;if(i!==null)for(const r of i)r.stop();Io(s);var n=s.parent;n!==null&&n.first!==null&&So(s),s.next=s.prev=s.teardown=s.ctx=s.deps=s.fn=s.nodes_start=s.nodes_end=null}function Gc(s,e){for(;s!==null;){var t=s===e?null:In(s);s.remove(),s=t}}function So(s){var e=s.parent,t=s.prev,i=s.next;t!==null&&(t.next=i),i!==null&&(i.prev=t),e!==null&&(e.first===s&&(e.first=i),e.last===s&&(e.last=t))}function Xt(s,e){var t=[];Nr(s,t,!0),Po(t,()=>{ii(s),e&&e()})}function Po(s,e){var t=s.length;if(t>0){var i=()=>--t||e();for(var n of s)n.out(i)}else e()}function Nr(s,e,t){if((s.f&jt)===0){if(s.f^=jt,s.transitions!==null)for(const a of s.transitions)(a.is_global||t)&&e.push(a);for(var i=s.first;i!==null;){var n=i.next,r=(i.f&bn)!==0||(i.f&qt)!==0;Nr(i,e,r?t:!1),i=n}}}function hi(s){Eo(s,!0)}function Eo(s,e){if((s.f&jt)!==0){s.f^=jt,(s.f&ze)===0&&(s.f^=ze),zi(s)&&(kt(s,Nt),Pn(s));for(var t=s.first;t!==null;){var i=t.next,n=(t.f&bn)!==0||(t.f&qt)!==0;Eo(t,n?e:!1),t=i}if(s.transitions!==null)for(const r of s.transitions)(r.is_global||e)&&r.in()}}const Wc=["touchstart","touchmove"];function Yc(s){return Wc.includes(s)}let da=!1;function Jc(){da||(da=!0,document.addEventListener("reset",s=>{Promise.resolve().then(()=>{var e;if(!s.defaultPrevented)for(const t of s.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function Oo(s){var e=fe,t=pe;vt(null),Lt(null);try{return s()}finally{vt(e),Lt(t)}}function Lr(s,e,t,i=t){s.addEventListener(e,()=>Oo(t));const n=s.__on_r;n?s.__on_r=()=>{n(),i(!0)}:s.__on_r=()=>i(!0),Jc()}const Xc=new Set,fa=new Set;function Qc(s,e,t,i={}){function n(r){if(i.capture||rs.call(e,r),!r.cancelBubble)return Oo(()=>t==null?void 0:t.call(this,r))}return s.startsWith("pointer")||s.startsWith("touch")||s==="wheel"?Pr(()=>{e.addEventListener(s,n,i)}):e.addEventListener(s,n,i),n}function re(s,e,t,i,n){var r={capture:i,passive:n},a=Qc(s,e,t,r);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Ar(()=>{e.removeEventListener(s,a,r)})}function rs(s){var b;var e=this,t=e.ownerDocument,i=s.type,n=((b=s.composedPath)==null?void 0:b.call(s))||[],r=n[0]||s.target,a=0,o=s.__root;if(o){var l=n.indexOf(o);if(l!==-1&&(e===document||e===window)){s.__root=e;return}var c=n.indexOf(e);if(c===-1)return;l<=c&&(a=l)}if(r=n[a]||s.target,r!==e){Qa(s,"currentTarget",{configurable:!0,get(){return r||t}});var f=fe,p=pe;vt(null),Lt(null);try{for(var d,u=[];r!==null;){var g=r.assignedSlot||r.parentNode||r.host||null;try{var h=r["__"+i];if(h!=null&&(!r.disabled||s.target===r))if(Ss(h)){var[m,...v]=h;m.apply(r,[s,...v])}else h.call(r,s)}catch(w){d?u.push(w):d=w}if(s.cancelBubble||g===e||g===null)break;r=g}if(d){for(let w of u)queueMicrotask(()=>{throw w});throw d}}finally{s.__root=e,delete s.currentTarget,vt(f),Lt(p)}}}function Zc(s){var e=document.createElement("template");return e.innerHTML=s.replaceAll("<!>","<!---->"),e.content}function hn(s,e){var t=pe;t.nodes_start===null&&(t.nodes_start=s,t.nodes_end=e)}function X(s,e){var t=(e&_c)!==0,i=(e&Sc)!==0,n,r=!s.startsWith("<!>");return()=>{n===void 0&&(n=Zc(r?s:"<!>"+s),t||(n=ln(n)));var a=i||ho?document.importNode(n,!0):n.cloneNode(!0);if(t){var o=ln(a),l=a.lastChild;hn(o,l)}else hn(a,a);return a}}function ha(s=""){{var e=Tn(s+"");return hn(e,e),e}}function ur(){var s=document.createDocumentFragment(),e=document.createComment(""),t=Tn();return s.append(e,t),hn(e,t),s}function K(s,e){s!==null&&s.before(e)}function ce(s,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(s.__t??(s.__t=s.nodeValue))&&(s.__t=t,s.nodeValue=t+"")}function Co(s,e){return eu(s,e)}const bi=new Map;function eu(s,{target:e,anchor:t,props:i={},events:n,context:r,intro:a=!0}){Nc();var o=new Set,l=p=>{for(var d=0;d<p.length;d++){var u=p[d];if(!o.has(u)){o.add(u);var g=Yc(u);e.addEventListener(u,rs,{passive:g});var h=bi.get(u);h===void 0?(document.addEventListener(u,rs,{passive:g}),bi.set(u,1)):bi.set(u,h+1)}}};l(Ir(Xc)),fa.add(l);var c=void 0,f=Vc(()=>{var p=t??e.appendChild(Tn());return Rt(()=>{if(r){Ze({});var d=he;d.c=r}n&&(i.$$events=n),c=s(p,i)||{},r&&et()}),()=>{var g;for(var d of o){e.removeEventListener(d,rs);var u=bi.get(d);--u===0?(document.removeEventListener(d,rs),bi.delete(d)):bi.set(d,u)}fa.delete(l),p!==t&&((g=p.parentNode)==null||g.removeChild(p))}});return dr.set(c,f),c}let dr=new WeakMap;function Ao(s,e){const t=dr.get(s);return t?(dr.delete(s),t(e)):Promise.resolve()}const Vn=0,js=1,zn=2;function tu(s,e,t,i,n){var r=s,a=Ki(),o=he,l=Re,c,f,p,d=(a?mi:z)(void 0),u=(a?mi:z)(void 0),g=!1;function h(v,b){g=!0,b&&(Lt(m),vt(m),on(o));try{v===Vn&&t&&(c?hi(c):c=Rt(()=>t(r))),v===js&&i&&(f?hi(f):f=Rt(()=>i(r,d))),v===zn&&n&&(p?hi(p):p=Rt(()=>n(r,u))),v!==Vn&&c&&Xt(c,()=>c=null),v!==js&&f&&Xt(f,()=>f=null),v!==zn&&p&&Xt(p,()=>p=null)}finally{b&&(on(null),vt(null),Lt(null),Rc())}}var m=Cs(()=>{if(l!==(l=e())){if(ec(l)){var v=l;g=!1,v.then(b=>{v===l&&(Jt(d,b),h(js,!0))},b=>{if(v===l&&(Jt(u,b),h(zn,!0),!n))throw u.v}),Pr(()=>{g||h(Vn,!0)})}else Jt(d,l),h(js,!1);return()=>l=Re}})}function Te(s,e,[t,i]=[0,0]){var n=s,r=null,a=null,o=Re,l=t>0?bn:0,c=!1;const f=(d,u=!0)=>{c=!0,p(u,d)},p=(d,u)=>{o!==(o=d)&&(o?(r?hi(r):u&&(r=Rt(()=>u(n))),a&&Xt(a,()=>{a=null})):(a?hi(a):u&&(a=Rt(()=>u(n,[t+1,i]))),r&&Xt(r,()=>{r=null})))};Cs(()=>{c=!1,e(f),c||p(null,null)},l)}function _t(s,e){return e}function iu(s,e,t,i){for(var n=[],r=e.length,a=0;a<r;a++)Nr(e[a].e,n,!0);var o=r>0&&n.length===0&&t!==null;if(o){var l=t.parentNode;Lc(l),l.append(t),i.clear(),Vt(s,e[0].prev,e[r-1].next)}Po(n,()=>{for(var c=0;c<r;c++){var f=e[c];o||(i.delete(f.k),Vt(s,f.prev,f.next)),ii(f.e,!o)}})}function St(s,e,t,i,n,r=null){var a=s,o={flags:e,items:new Map,first:null},l=(e&ao)!==0;if(l){var c=s;a=c.appendChild(Tn())}var f=null,p=!1,d=ti(()=>{var u=t();return Ss(u)?u:u==null?[]:Ir(u)});Cs(()=>{var u=P(d),g=u.length;p&&g===0||(p=g===0,su(u,o,a,n,e,i,t),r!==null&&(g===0?f?hi(f):f=Rt(()=>r(a)):f!==null&&Xt(f,()=>{f=null})),P(d))})}function su(s,e,t,i,n,r,a){var R,M,j,q;var o=(n&vc)!==0,l=(n&(Or|Cr))!==0,c=s.length,f=e.items,p=e.first,d=p,u,g=null,h,m=[],v=[],b,w,k,T;if(o)for(T=0;T<c;T+=1)b=s[T],w=r(b,T),k=f.get(w),k!==void 0&&((R=k.a)==null||R.measure(),(h??(h=new Set)).add(k));for(T=0;T<c;T+=1){if(b=s[T],w=r(b,T),k=f.get(w),k===void 0){var I=d?d.e.nodes_start:t;g=ru(I,e,g,g===null?e.first:g.next,b,w,T,i,n,a),f.set(w,g),m=[],v=[],d=g.next;continue}if(l&&nu(k,b,T,n),(k.e.f&jt)!==0&&(hi(k.e),o&&((M=k.a)==null||M.unfix(),(h??(h=new Set)).delete(k))),k!==d){if(u!==void 0&&u.has(k)){if(m.length<v.length){var E=v[0],S;g=E.prev;var L=m[0],A=m[m.length-1];for(S=0;S<m.length;S+=1)pa(m[S],E,t);for(S=0;S<v.length;S+=1)u.delete(v[S]);Vt(e,L.prev,A.next),Vt(e,g,L),Vt(e,A,E),d=E,g=A,T-=1,m=[],v=[]}else u.delete(k),pa(k,d,t),Vt(e,k.prev,k.next),Vt(e,k,g===null?e.first:g.next),Vt(e,g,k),g=k;continue}for(m=[],v=[];d!==null&&d.k!==w;)(d.e.f&jt)===0&&(u??(u=new Set)).add(d),v.push(d),d=d.next;if(d===null)continue;k=d}m.push(k),g=k,d=k.next}if(d!==null||u!==void 0){for(var _=u===void 0?[]:Ir(u);d!==null;)(d.e.f&jt)===0&&_.push(d),d=d.next;var C=_.length;if(C>0){var D=(n&ao)!==0&&c===0?t:null;if(o){for(T=0;T<C;T+=1)(j=_[T].a)==null||j.measure();for(T=0;T<C;T+=1)(q=_[T].a)==null||q.fix()}iu(e,_,D,f)}}o&&Pr(()=>{var ee;if(h!==void 0)for(k of h)(ee=k.a)==null||ee.apply()}),pe.first=e.first&&e.first.e,pe.last=g&&g.e}function nu(s,e,t,i){(i&Or)!==0&&Jt(s.v,e),(i&Cr)!==0?Jt(s.i,t):s.i=t}function ru(s,e,t,i,n,r,a,o,l,c){var f=(l&Or)!==0,p=(l&kc)===0,d=f?p?z(n):mi(n):n,u=(l&Cr)===0?a:mi(a),g={i:u,v:d,k:r,a:null,e:null,prev:t,next:i};try{return g.e=Rt(()=>o(s,d,u,c),Ac),g.e.prev=t&&t.e,g.e.next=i&&i.e,t===null?e.first=g:(t.next=g,t.e.next=g.e),i!==null&&(i.prev=g,i.e.prev=g.e),g}finally{}}function pa(s,e,t){for(var i=s.next?s.next.e.nodes_start:t,n=e?e.e.nodes_start:t,r=s.e.nodes_start;r!==i;){var a=In(r);n.before(r),r=a}}function Vt(s,e,t){e===null?s.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function au(s,e,t,i,n){var o;var r=(o=e.$$slots)==null?void 0:o[t],a=!1;r===!0&&(r=e.children,a=!0),r===void 0||r(s,a?()=>i:i)}function ou(s,e,t){var i=s,n,r;Cs(()=>{n!==(n=e())&&(r&&(Xt(r),r=null),n&&(r=Rt(()=>t(i,n))))},bn)}function No(s,e,t){Ps(()=>{var i=Qe(()=>e(s,t==null?void 0:t())||{});if(i!=null&&i.destroy)return()=>i.destroy()})}function lu(s,e,t){var i=s==null?"":""+s;return i===""?null:i}function cu(s,e){return s==null?null:String(s)}function Dr(s,e,t,i,n,r){var a=s.__className;if(a!==t||a===void 0){var o=lu(t);o==null?s.removeAttribute("class"):s.className=o,s.__className=t}return r}function ga(s,e,t,i){var n=s.__style;if(n!==e){var r=cu(e);r==null?s.removeAttribute("style"):s.style.cssText=r,s.__style=e}return i}function ks(s,e,t){if(s.multiple){if(e==null)return;if(!Ss(e))return Cc();for(var i of s.options)i.selected=e.includes(ds(i));return}for(i of s.options){var n=ds(i);if(Ec(n,e)){i.selected=!0;return}}(!t||e!==void 0)&&(s.selectedIndex=-1)}function Fr(s,e){let t=!0;Ps(()=>{e&&ks(s,Qe(e),t),t=!1;var i=new MutationObserver(()=>{var n=s.__value;ks(s,n)});return i.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{i.disconnect()}})}function ys(s,e,t=e){var i=!0;Lr(s,"change",n=>{var r=n?"[selected]":":checked",a;if(s.multiple)a=[].map.call(s.querySelectorAll(r),ds);else{var o=s.querySelector(r)??s.querySelector("option:not([disabled])");a=o&&ds(o)}t(a)}),Ps(()=>{var n=e();if(ks(s,n,i),i&&n===void 0){var r=s.querySelector(":checked");r!==null&&(n=ds(r),t(n))}s.__value=n,i=!1}),Fr(s)}function ds(s){return"__value"in s?s.__value:s.value}const uu=Symbol("is custom element"),du=Symbol("is html");function fr(s,e){var t=Lo(s);t.checked!==(t.checked=e??void 0)&&(s.checked=e)}function fu(s,e,t,i){var n=Lo(s);n[e]!==(n[e]=t)&&(hu(s).includes(e)?s[e]=t:s.setAttribute(e,t))}function Lo(s){return s.__attributes??(s.__attributes={[uu]:s.nodeName.includes("-"),[du]:s.namespaceURI===Pc})}var ma=new Map;function hu(s){var e=ma.get(s.nodeName);if(e)return e;ma.set(s.nodeName,e=[]);for(var t,i=s,n=Element.prototype;n!==i;){t=Za(i);for(var r in t)t[r].set&&e.push(r);i=_r(i)}return e}function xi(s,e,t=e){var i=Ki();Lr(s,"input",n=>{var r=n?s.defaultValue:s.value;if(r=Gn(s)?Wn(r):r,t(r),i&&r!==(r=e())){var a=s.selectionStart,o=s.selectionEnd;s.value=r??"",o!==null&&(s.selectionStart=a,s.selectionEnd=Math.min(o,s.value.length))}}),Qe(e)==null&&s.value&&t(Gn(s)?Wn(s.value):s.value),Os(()=>{var n=e();Gn(s)&&n===Wn(s.value)||s.type==="date"&&!n&&!s.value||n!==s.value&&(s.value=n??"")})}function xr(s,e,t=e){Lr(s,"change",i=>{var n=i?s.defaultChecked:s.checked;t(n)}),Qe(e)==null&&t(s.checked),Os(()=>{var i=e();s.checked=!!i})}function Gn(s){var e=s.type;return e==="number"||e==="range"}function Wn(s){return s===""?null:+s}function ot(s=!1){const e=he,t=e.l.u;if(!t)return;let i=()=>qc(e.s);if(s){let n=0,r={};const a=Fi(()=>{let o=!1;const l=e.s;for(const c in l)l[c]!==r[c]&&(r[c]=l[c],o=!0);return o&&n++,n});i=()=>P(a)}t.b.length&&Kc(()=>{va(e,i),nn(t.b)}),cr(()=>{const n=Qe(()=>t.m.map(tc));return()=>{for(const r of n)typeof r=="function"&&r()}}),t.a.length&&cr(()=>{va(e,i),nn(t.a)})}function va(s,e){if(s.l.s)for(const t of s.l.s)P(t);e()}let Rs=!1,hr=Symbol();function As(s,e,t){const i=t[e]??(t[e]={store:null,source:z(void 0),unsubscribe:Ni});if(i.store!==s&&!(hr in t))if(i.unsubscribe(),i.store=s??null,s==null)i.source.v=void 0,i.unsubscribe=Ni;else{var n=!0;i.unsubscribe=Do(s,r=>{n?i.source.v=r:x(i.source,r)}),n=!1}return s&&hr in t?ku(s):P(i.source)}function Ns(){const s={};function e(){Ar(()=>{for(var t in s)s[t].unsubscribe();Qa(s,hr,{enumerable:!1,value:!0})})}return[s,e]}function pu(s,e,t){return s.set(t),e}function gu(s){var e=Rs;try{return Rs=!1,[s(),Rs]}finally{Rs=e}}function ka(s){var e;return((e=s.ctx)==null?void 0:e.d)??!1}function ke(s,e,t,i){var E;var n=(t&yc)!==0,r=!Hi||(t&wc)!==0,a=(t&Tc)!==0,o=(t&Ic)!==0,l=!1,c;a?[c,l]=gu(()=>s[e]):c=s[e];var f=Yt in s||nc in s,p=a&&(((E=Ai(s,e))==null?void 0:E.set)??(f&&e in s&&(S=>s[e]=S)))||void 0,d=i,u=!0,g=!1,h=()=>(g=!0,u&&(u=!1,o?d=Qe(i):d=i),d);c===void 0&&i!==void 0&&(p&&r&&dc(),c=h(),p&&p(c));var m;if(r)m=()=>{var S=s[e];return S===void 0?h():(u=!0,g=!1,S)};else{var v=(n?Fi:ti)(()=>s[e]);v.f|=to,m=()=>{var S=P(v);return S!==void 0&&(d=void 0),S===void 0?d:S}}if((t&bc)===0)return m;if(p){var b=s.$$legacy;return function(S,L){return arguments.length>0?((!r||!L||b||l)&&p(L?m():S),S):m()}}var w=!1,k=!1,T=z(c),I=Fi(()=>{var S=m(),L=P(T);return w?(w=!1,k=!0,L):(k=!1,T.v=S)});return a&&P(I),n||(I.equals=Er),function(S,L){if(Gt!==null&&(w=k,m(),P(T)),arguments.length>0){const A=L?P(I):r&&a?li(S):S;if(!I.equals(A)){if(w=!0,x(T,A),g&&d!==void 0&&(d=A),ka(I))return S;Qe(()=>P(I))}return S}return ka(I)?I.v:P(I)}}function Wi(s){he===null&&oo(),Hi&&he.l!==null?vu(he).m.push(s):cr(()=>{const e=Qe(s);if(typeof e=="function")return e})}function mu(s,e,{bubbles:t=!1,cancelable:i=!1}={}){return new CustomEvent(s,{detail:e,bubbles:t,cancelable:i})}function Ls(){const s=he;return s===null&&oo(),(e,t,i)=>{var r;const n=(r=s.s.$$events)==null?void 0:r[e];if(n){const a=Ss(n)?n.slice():[n],o=mu(e,t,i);for(const l of a)l.call(s.x,o);return!o.defaultPrevented}return!0}}function vu(s){var e=s.l;return e.u??(e.u={a:[],b:[],m:[]})}function Do(s,e,t){if(s==null)return e(void 0),Ni;const i=Qe(()=>s.subscribe(e,t));return i.unsubscribe?()=>i.unsubscribe():i}const Ti=[];function Fo(s,e=Ni){let t=null;const i=new Set;function n(o){if(ro(s,o)&&(s=o,t)){const l=!Ti.length;for(const c of i)c[1](),Ti.push(c,s);if(l){for(let c=0;c<Ti.length;c+=2)Ti[c][0](Ti[c+1]);Ti.length=0}}}function r(o){n(o(s))}function a(o,l=Ni){const c=[o,l];return i.add(c),i.size===1&&(t=e(n,r)||Ni),o(s),()=>{i.delete(c),i.size===0&&t&&(t(),t=null)}}return{set:n,update:r,subscribe:a}}function ku(s){let e;return Do(s,t=>e=t)(),e}let ts=null,Ae;function yu(s){if(Ae)return;ts=s;const{subscribe:e,set:t,update:i}=Fo(Be);function n(r){Object.assign(Be,r),ts&&wu(Be)}Ae={subscribe:e,update:r=>{i(a=>{const o=r(a);return n(o),o})},set:async r=>{t(r),n(r),await(ts==null?void 0:ts.saveSettings())}}}const xo={baseURL:"ticktick.com",automaticSynchronizationInterval:300,enableFullVaultSync:!1,tagAndOr:1,debugMode:!1,logLevel:"info",SyncProject:"",SyncTag:"",defaultProjectId:"",defaultProjectName:"Inbox",TickTickTasksFilePath:"/",keepProjectFolders:!1,syncNotes:!0,noteDelimiter:"-------------------------------------------------------------",fileLinksInTickTick:"taskLink",taskLinksInObsidian:"taskLink",bkupFolder:"/",inboxID:"",inboxName:"Inbox",checkPoint:0,skipBackup:!1,fileMetadata:{},TickTickTasksData:{projects:[],tasks:[]}};let Be={...xo};const O=()=>Be,wu=s=>{Be=s},Ee=s=>(Be={...Be,...s},Ae.set(Be),O()),pi=()=>Be.TickTickTasksData.projects,$o=s=>(Be.TickTickTasksData.projects=s,pi()),ft=()=>Be.TickTickTasksData.tasks,oi=s=>(Be.TickTickTasksData.tasks=s,ft()),bu=()=>Be.TickTickTasksData.projectGroups,Mo=s=>(Be.TickTickTasksData.projectGroups=s,bu()),It=()=>Be.TickTickTasksFilePath==="/"?"":Be.TickTickTasksFilePath;function jo(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var as={exports:{}},Tu=as.exports,ya;function Iu(){return ya||(ya=1,function(s,e){(function(t,i){var n="1.0.40",r="",a="?",o="function",l="undefined",c="object",f="string",p="major",d="model",u="name",g="type",h="vendor",m="version",v="architecture",b="console",w="mobile",k="tablet",T="smarttv",I="wearable",E="embedded",S=500,L="Amazon",A="Apple",_="ASUS",C="BlackBerry",D="Browser",R="Chrome",M="Edge",j="Firefox",q="Google",ee="Huawei",oe="LG",te="Microsoft",ue="Motorola",ve="Opera",se="Samsung",me="Sharp",W="Sony",de="Xiaomi",B="Zebra",ae="Facebook",ye="Chromium OS",U="Mac OS",Z=" Browser",Oe=function(J,Q){var H={};for(var V in J)Q[V]&&Q[V].length%2===0?H[V]=Q[V].concat(J[V]):H[V]=J[V];return H},Se=function(J){for(var Q={},H=0;H<J.length;H++)Q[J[H].toUpperCase()]=J[H];return Q},je=function(J,Q){return typeof J===f?De(Q).indexOf(De(J))!==-1:!1},De=function(J){return J.toLowerCase()},Ne=function(J){return typeof J===f?J.replace(/[^\d\.]/g,r).split(".")[0]:i},Ce=function(J,Q){if(typeof J===f)return J=J.replace(/^\s\s*/,r),typeof Q===l?J:J.substring(0,S)},Le=function(J,Q){for(var H=0,V,Me,it,le,G,Et;H<Q.length&&!G;){var Hn=Q[H],na=Q[H+1];for(V=Me=0;V<Hn.length&&!G&&Hn[V];)if(G=Hn[V++].exec(J),G)for(it=0;it<na.length;it++)Et=G[++Me],le=na[it],typeof le===c&&le.length>0?le.length===2?typeof le[1]==o?this[le[0]]=le[1].call(this,Et):this[le[0]]=le[1]:le.length===3?typeof le[1]===o&&!(le[1].exec&&le[1].test)?this[le[0]]=Et?le[1].call(this,Et,le[2]):i:this[le[0]]=Et?Et.replace(le[1],le[2]):i:le.length===4&&(this[le[0]]=Et?le[3].call(this,Et.replace(le[1],le[2])):i):this[le]=Et||i;H+=2}},Fe=function(J,Q){for(var H in Q)if(typeof Q[H]===c&&Q[H].length>0){for(var V=0;V<Q[H].length;V++)if(je(Q[H][V],J))return H===a?i:H}else if(je(Q[H],J))return H===a?i:H;return Q.hasOwnProperty("*")?Q["*"]:J},ne={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},Pe={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},xe={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[m,[u,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[m,[u,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[u,m],[/opios[\/ ]+([\w\.]+)/i],[m,[u,ve+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[m,[u,ve+" GX"]],[/\bopr\/([\w\.]+)/i],[m,[u,ve]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[m,[u,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[m,[u,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[u,m],[/quark(?:pc)?\/([-\w\.]+)/i],[m,[u,"Quark"]],[/\bddg\/([\w\.]+)/i],[m,[u,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[m,[u,"UC"+D]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[m,[u,"WeChat"]],[/konqueror\/([\w\.]+)/i],[m,[u,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[m,[u,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[m,[u,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[m,[u,"Smart Lenovo "+D]],[/(avast|avg)\/([\w\.]+)/i],[[u,/(.+)/,"$1 Secure "+D],m],[/\bfocus\/([\w\.]+)/i],[m,[u,j+" Focus"]],[/\bopt\/([\w\.]+)/i],[m,[u,ve+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[m,[u,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[m,[u,"Dolphin"]],[/coast\/([\w\.]+)/i],[m,[u,ve+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[m,[u,"MIUI"+Z]],[/fxios\/([\w\.-]+)/i],[m,[u,j]],[/\bqihoobrowser\/?([\w\.]*)/i],[m,[u,"360"]],[/\b(qq)\/([\w\.]+)/i],[[u,/(.+)/,"$1Browser"],m],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[u,/(.+)/,"$1"+Z],m],[/samsungbrowser\/([\w\.]+)/i],[m,[u,se+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[m,[u,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[u,"Sogou Mobile"],m],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[u,m],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[u],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[m,u],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[u,ae],m],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[u,m],[/\bgsa\/([\w\.]+) .*safari\//i],[m,[u,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[m,[u,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[m,[u,R+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[u,R+" WebView"],m],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[m,[u,"Android "+D]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[u,m],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[m,[u,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[m,u],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[u,[m,Fe,ne]],[/(webkit|khtml)\/([\w\.]+)/i],[u,m],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[u,"Netscape"],m],[/(wolvic|librewolf)\/([\w\.]+)/i],[u,m],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[m,[u,j+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[u,[m,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[u,[m,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[v,"amd64"]],[/(ia32(?=;))/i],[[v,De]],[/((?:i[346]|x)86)[;\)]/i],[[v,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[v,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[v,"armhf"]],[/windows (ce|mobile); ppc;/i],[[v,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[v,/ower/,r,De]],[/(sun4\w)[;\)]/i],[[v,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[v,De]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[d,[h,se],[g,k]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[d,[h,se],[g,w]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[d,[h,A],[g,w]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[d,[h,A],[g,k]],[/(macintosh);/i],[d,[h,A]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[d,[h,me],[g,w]],[/(?:honor)([-\w ]+)[;\)]/i],[d,[h,"Honor"],[g,w]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[d,[h,ee],[g,k]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[d,[h,ee],[g,w]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[d,/_/g," "],[h,de],[g,w]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[d,/_/g," "],[h,de],[g,k]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[d,[h,"OPPO"],[g,w]],[/\b(opd2\d{3}a?) bui/i],[d,[h,"OPPO"],[g,k]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[d,[h,"Vivo"],[g,w]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[d,[h,"Realme"],[g,w]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[d,[h,ue],[g,w]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[d,[h,ue],[g,k]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[d,[h,oe],[g,k]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[d,[h,oe],[g,w]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[d,[h,"Lenovo"],[g,k]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[d,/_/g," "],[h,"Nokia"],[g,w]],[/(pixel c)\b/i],[d,[h,q],[g,k]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[d,[h,q],[g,w]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[d,[h,W],[g,w]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[d,"Xperia Tablet"],[h,W],[g,k]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[d,[h,"OnePlus"],[g,w]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[d,[h,L],[g,k]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[d,/(.+)/g,"Fire Phone $1"],[h,L],[g,w]],[/(playbook);[-\w\),; ]+(rim)/i],[d,h,[g,k]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[d,[h,C],[g,w]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[d,[h,_],[g,k]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[d,[h,_],[g,w]],[/(nexus 9)/i],[d,[h,"HTC"],[g,k]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[h,[d,/_/g," "],[g,w]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[d,[h,"TCL"],[g,k]],[/(itel) ((\w+))/i],[[h,De],d,[g,Fe,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[d,[h,"Acer"],[g,k]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[d,[h,"Meizu"],[g,w]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[d,[h,"Ulefone"],[g,w]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[d,[h,"Energizer"],[g,w]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[d,[h,"Cat"],[g,w]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[d,[h,"Smartfren"],[g,w]],[/droid.+; (a(?:015|06[35]|142p?))/i],[d,[h,"Nothing"],[g,w]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[h,d,[g,w]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[h,d,[g,k]],[/(surface duo)/i],[d,[h,te],[g,k]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[d,[h,"Fairphone"],[g,w]],[/(u304aa)/i],[d,[h,"AT&T"],[g,w]],[/\bsie-(\w*)/i],[d,[h,"Siemens"],[g,w]],[/\b(rct\w+) b/i],[d,[h,"RCA"],[g,k]],[/\b(venue[\d ]{2,7}) b/i],[d,[h,"Dell"],[g,k]],[/\b(q(?:mv|ta)\w+) b/i],[d,[h,"Verizon"],[g,k]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[d,[h,"Barnes & Noble"],[g,k]],[/\b(tm\d{3}\w+) b/i],[d,[h,"NuVision"],[g,k]],[/\b(k88) b/i],[d,[h,"ZTE"],[g,k]],[/\b(nx\d{3}j) b/i],[d,[h,"ZTE"],[g,w]],[/\b(gen\d{3}) b.+49h/i],[d,[h,"Swiss"],[g,w]],[/\b(zur\d{3}) b/i],[d,[h,"Swiss"],[g,k]],[/\b((zeki)?tb.*\b) b/i],[d,[h,"Zeki"],[g,k]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[h,"Dragon Touch"],d,[g,k]],[/\b(ns-?\w{0,9}) b/i],[d,[h,"Insignia"],[g,k]],[/\b((nxa|next)-?\w{0,9}) b/i],[d,[h,"NextBook"],[g,k]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[h,"Voice"],d,[g,w]],[/\b(lvtel\-)?(v1[12]) b/i],[[h,"LvTel"],d,[g,w]],[/\b(ph-1) /i],[d,[h,"Essential"],[g,w]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[d,[h,"Envizen"],[g,k]],[/\b(trio[-\w\. ]+) b/i],[d,[h,"MachSpeed"],[g,k]],[/\btu_(1491) b/i],[d,[h,"Rotor"],[g,k]],[/(shield[\w ]+) b/i],[d,[h,"Nvidia"],[g,k]],[/(sprint) (\w+)/i],[h,d,[g,w]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[h,te],[g,w]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[d,[h,B],[g,k]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[d,[h,B],[g,w]],[/smart-tv.+(samsung)/i],[h,[g,T]],[/hbbtv.+maple;(\d+)/i],[[d,/^/,"SmartTV"],[h,se],[g,T]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[h,oe],[g,T]],[/(apple) ?tv/i],[h,[d,A+" TV"],[g,T]],[/crkey/i],[[d,R+"cast"],[h,q],[g,T]],[/droid.+aft(\w+)( bui|\))/i],[d,[h,L],[g,T]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[d,[h,me],[g,T]],[/(bravia[\w ]+)( bui|\))/i],[d,[h,W],[g,T]],[/(mitv-\w{5}) bui/i],[d,[h,de],[g,T]],[/Hbbtv.*(technisat) (.*);/i],[h,d,[g,T]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[h,Ce],[d,Ce],[g,T]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[g,T]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[h,d,[g,b]],[/droid.+; (shield) bui/i],[d,[h,"Nvidia"],[g,b]],[/(playstation [345portablevi]+)/i],[d,[h,W],[g,b]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[d,[h,te],[g,b]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[d,[h,se],[g,I]],[/((pebble))app/i],[h,d,[g,I]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[d,[h,A],[g,I]],[/droid.+; (glass) \d/i],[d,[h,q],[g,I]],[/droid.+; (wt63?0{2,3})\)/i],[d,[h,B],[g,I]],[/droid.+; (glass) \d/i],[d,[h,q],[g,I]],[/(pico) (4|neo3(?: link|pro)?)/i],[h,d,[g,I]],[/; (quest( \d| pro)?)/i],[d,[h,ae],[g,I]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[h,[g,E]],[/(aeobc)\b/i],[d,[h,L],[g,E]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[d,[g,w]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[d,[g,k]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[g,k]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[g,w]],[/(android[-\w\. ]{0,9});.+buil/i],[d,[h,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[m,[u,M+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[u,m],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[m,[u,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[u,m],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[m,u]],os:[[/microsoft (windows) (vista|xp)/i],[u,m],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[u,[m,Fe,Pe]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[m,Fe,Pe],[u,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[m,/_/g,"."],[u,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[u,U],[m,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[m,u],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[u,m],[/\(bb(10);/i],[m,[u,C]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[m,[u,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[m,[u,j+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[m,[u,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[m,[u,"watchOS"]],[/crkey\/([\d\.]+)/i],[m,[u,R+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[u,ye],m],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[u,m],[/(sunos) ?([\w\.\d]*)/i],[[u,"Solaris"],m],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[u,m]]},$e=function(J,Q){if(typeof J===c&&(Q=J,J=i),!(this instanceof $e))return new $e(J,Q).getResult();var H=typeof t!==l&&t.navigator?t.navigator:i,V=J||(H&&H.userAgent?H.userAgent:r),Me=H&&H.userAgentData?H.userAgentData:i,it=Q?Oe(xe,Q):xe,le=H&&H.userAgent==V;return this.getBrowser=function(){var G={};return G[u]=i,G[m]=i,Le.call(G,V,it.browser),G[p]=Ne(G[m]),le&&H&&H.brave&&typeof H.brave.isBrave==o&&(G[u]="Brave"),G},this.getCPU=function(){var G={};return G[v]=i,Le.call(G,V,it.cpu),G},this.getDevice=function(){var G={};return G[h]=i,G[d]=i,G[g]=i,Le.call(G,V,it.device),le&&!G[g]&&Me&&Me.mobile&&(G[g]=w),le&&G[d]=="Macintosh"&&H&&typeof H.standalone!==l&&H.maxTouchPoints&&H.maxTouchPoints>2&&(G[d]="iPad",G[g]=k),G},this.getEngine=function(){var G={};return G[u]=i,G[m]=i,Le.call(G,V,it.engine),G},this.getOS=function(){var G={};return G[u]=i,G[m]=i,Le.call(G,V,it.os),le&&!G[u]&&Me&&Me.platform&&Me.platform!="Unknown"&&(G[u]=Me.platform.replace(/chrome os/i,ye).replace(/macos/i,U)),G},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return V},this.setUA=function(G){return V=typeof G===f&&G.length>S?Ce(G,S):G,this},this.setUA(V),this};$e.VERSION=n,$e.BROWSER=Se([u,m,p]),$e.CPU=Se([v]),$e.DEVICE=Se([d,h,g,b,w,T,k,I,E]),$e.ENGINE=$e.OS=Se([u,m]),s.exports&&(e=s.exports=$e),e.UAParser=$e;var qe=typeof t!==l&&(t.jQuery||t.Zepto);if(qe&&!qe.ua){var tt=new $e;qe.ua=tt.getResult(),qe.ua.get=function(){return tt.getUA()},qe.ua.set=function(J){tt.setUA(J);var Q=tt.getResult();for(var H in Q)qe.ua[H]=Q[H]}}})(typeof window=="object"?window:Tu)}(as,as.exports)),as.exports}var _u=Iu(),Yn,wa;function Su(){if(wa)return Yn;wa=1;for(var s=Math.floor(Math.random()*16777215),e=c.index=parseInt(Math.random()*16777215,10),t=(typeof process>"u"||typeof process.pid!="number"?Math.floor(Math.random()*1e5):process.pid)%65535,i=(()=>{try{return _Buffer}catch{try{return Buffer}catch{return null}}})(),n=function(u){return!!(u!=null&&u.constructor&&typeof u.constructor.isBuffer=="function"&&u.constructor.isBuffer(u))},r=[],a=0;a<256;a++)r[a]=(a<=15?"0":"")+a.toString(16);var o=new RegExp("^[0-9a-fA-F]{24}$"),l=[];for(a=0;a<10;)l[48+a]=a++;for(;a<16;)l[55+a]=l[87+a]=a++;function c(u){if(!(this instanceof c))return new c(u);if(u&&(u instanceof c||u._bsontype==="ObjectID"))return u;if(this._bsontype="ObjectID",u==null||typeof u=="number"){this.id=this.generate(u);return}var g=c.isValid(u);if(!g&&u!=null)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(g&&typeof u=="string"&&u.length===24)return c.createFromHexString(u);if(u!=null&&u.length===12)this.id=u;else{if(u!=null&&typeof u.toHexString=="function")return u;throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}}Yn=c,c.default=c,c.createFromTime=function(u){return u=parseInt(u,10)%4294967295,new c(p(8,u)+"0000000000000000")},c.createFromHexString=function(u){if(typeof u>"u"||u!=null&&u.length!==24)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");for(var g="",h=0;h<24;)g+=String.fromCharCode(l[u.charCodeAt(h++)]<<4|l[u.charCodeAt(h++)]);return new c(g)},c.isValid=function(u){return u==null?!1:typeof u=="number"?!0:typeof u=="string"?u.length===12||u.length===24&&o.test(u):u instanceof c?!0:n(u)?c.isValid(u.toString("hex")):typeof u.toHexString=="function"&&i&&(u.id instanceof i||typeof u.id=="string")?u.id.length===12||u.id.length===24&&o.test(u.id):!1},c.prototype={constructor:c,toHexString:function(){if(!this.id||!this.id.length)throw new Error("invalid ObjectId, ObjectId.id must be either a string or a Buffer, but is ["+JSON.stringify(this.id)+"]");if(this.id.length===24)return this.id;if(n(this.id))return this.id.toString("hex");for(var u="",g=0;g<this.id.length;g++)u+=r[this.id.charCodeAt(g)];return u},equals:function(u){return u instanceof c?this.toString()===u.toString():typeof u=="string"&&c.isValid(u)&&u.length===12&&n(this.id)?u===this.id.toString("binary"):typeof u=="string"&&c.isValid(u)&&u.length===24?u.toLowerCase()===this.toHexString():typeof u=="string"&&c.isValid(u)&&u.length===12?u===this.id:u!=null&&(u instanceof c||u.toHexString)?u.toHexString()===this.toHexString():!1},getTimestamp:function(){var u=new Date,g;return n(this.id)?g=this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24:g=this.id.charCodeAt(3)|this.id.charCodeAt(2)<<8|this.id.charCodeAt(1)<<16|this.id.charCodeAt(0)<<24,u.setTime(Math.floor(g)*1e3),u},generate:function(u){typeof u!="number"&&(u=~~(Date.now()/1e3)),u=parseInt(u,10)%4294967295;var g=f();return String.fromCharCode(u>>24&255,u>>16&255,u>>8&255,u&255,s>>16&255,s>>8&255,s&255,t>>8&255,t&255,g>>16&255,g>>8&255,g&255)}};function f(){return e=(e+1)%16777215}function p(u,g){return g=g.toString(16),g.length===u?g:"00000000".substring(g.length,u)+g}var d=Symbol&&Symbol.for&&Symbol.for("nodejs.util.inspect.custom")||"inspect";return c.prototype[d]=function(){return"ObjectID("+this+")"},c.prototype.toJSON=c.prototype.toHexString,c.prototype.toString=c.prototype.toHexString,Yn}var Pu=Su();const os=jo(Pu),Eu={ticktickServer:"ticktick.com",protocol:"https://",apiProtocol:"https://api.",apiVersion:"/api/v2",signInEndPoint:"user/signon?wc=true&remember=true",userPreferencesEndPoint:"user/preferences/settings",allProjectGroupsEndPoint:"batch/check/",allProjectsEndPoint:"projects",allTasksEndPoint:"batch/check/",TaskEndPoint:"task",updateTaskEndPoint:"batch/task",getSections:"column/project/",getAllCompletedItems:"project/all/completedInAll/",exportData:"data/export",projectMove:"batch/taskProject",parentMove:"batch/taskParent"};var Xs={exports:{}},Ou=Xs.exports,ba;function Cu(){return ba||(ba=1,function(s){(function(e,t){s.exports?s.exports=t():e.log=t()})(Ou,function(){var e=function(){},t="undefined",i=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"],r={},a=null;function o(h,m){var v=h[m];if(typeof v.bind=="function")return v.bind(h);try{return Function.prototype.bind.call(v,h)}catch{return function(){return Function.prototype.apply.apply(v,[h,arguments])}}}function l(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(h){return h==="debug"&&(h="log"),typeof console===t?!1:h==="trace"&&i?l:console[h]!==void 0?o(console,h):console.log!==void 0?o(console,"log"):e}function f(){for(var h=this.getLevel(),m=0;m<n.length;m++){var v=n[m];this[v]=m<h?e:this.methodFactory(v,h,this.name)}if(this.log=this.debug,typeof console===t&&h<this.levels.SILENT)return"No console available for logging"}function p(h){return function(){typeof console!==t&&(f.call(this),this[h].apply(this,arguments))}}function d(h,m,v){return c(h)||p.apply(this,arguments)}function u(h,m){var v=this,b,w,k,T="loglevel";typeof h=="string"?T+=":"+h:typeof h=="symbol"&&(T=void 0);function I(_){var C=(n[_]||"silent").toUpperCase();if(!(typeof window===t||!T)){try{window.localStorage[T]=C;return}catch{}try{window.document.cookie=encodeURIComponent(T)+"="+C+";"}catch{}}}function E(){var _;if(!(typeof window===t||!T)){try{_=window.localStorage[T]}catch{}if(typeof _===t)try{var C=window.document.cookie,D=encodeURIComponent(T),R=C.indexOf(D+"=");R!==-1&&(_=/^([^;]+)/.exec(C.slice(R+D.length+1))[1])}catch{}return v.levels[_]===void 0&&(_=void 0),_}}function S(){if(!(typeof window===t||!T)){try{window.localStorage.removeItem(T)}catch{}try{window.document.cookie=encodeURIComponent(T)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function L(_){var C=_;if(typeof C=="string"&&v.levels[C.toUpperCase()]!==void 0&&(C=v.levels[C.toUpperCase()]),typeof C=="number"&&C>=0&&C<=v.levels.SILENT)return C;throw new TypeError("log.setLevel() called with invalid level: "+_)}v.name=h,v.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},v.methodFactory=m||d,v.getLevel=function(){return k??w??b},v.setLevel=function(_,C){return k=L(_),C!==!1&&I(k),f.call(v)},v.setDefaultLevel=function(_){w=L(_),E()||v.setLevel(_,!1)},v.resetLevel=function(){k=null,S(),f.call(v)},v.enableAll=function(_){v.setLevel(v.levels.TRACE,_)},v.disableAll=function(_){v.setLevel(v.levels.SILENT,_)},v.rebuild=function(){if(a!==v&&(b=L(a.getLevel())),f.call(v),a===v)for(var _ in r)r[_].rebuild()},b=L(a?a.getLevel():"WARN");var A=E();A!=null&&(k=L(A)),f.call(v)}a=new u,a.getLogger=function(m){if(typeof m!="symbol"&&typeof m!="string"||m==="")throw new TypeError("You must supply a name when creating a logger.");var v=r[m];return v||(v=r[m]=new u(m,a.methodFactory)),v};var g=typeof window!==t?window.log:void 0;return a.noConflict=function(){return typeof window!==t&&window.log===a&&(window.log=g),a},a.getLoggers=function(){return r},a.default=a,a})}(Xs)),Xs.exports}var Au=Cu();const y=jo(Au),{ticktickServer:Jn,protocol:Bs,apiProtocol:Ta,apiVersion:Us,TaskEndPoint:Ia,updateTaskEndPoint:_a,allProjectGroupsEndPoint:Nu,allProjectsEndPoint:Lu,allTasksEndPoint:qs,signInEndPoint:Du,userPreferencesEndPoint:Fu,getSections:xu,getAllCompletedItems:$u,exportData:Mu,projectMove:ju,parentMove:Ru}=Eu;class pr{constructor({username:e,password:t,baseUrl:i,token:n,checkPoint:r}){this.username=e,this.password=t,this.token=n,this.inboxProperties={id:"",sortOrder:0},this.userAgent=this.getUserAgent(),this.deviceAgent=this.getXDevice(),i?(this.apiUrl=`${Ta}${i}${Us}`,this.loginUrl=`${Bs}${i}${Us}`,this.originUrl=`${Bs}${i}`):(this.apiUrl=`${Ta}${Jn}${Us}`,this.loginUrl=`${Bs}${Jn}${Us}`,this.originUrl=`${Bs}${Jn}`),r!=null?this._checkpoint=r:this.getPreviousCheckPoint()}get checkpoint(){return this._checkpoint}set checkpoint(e){this._checkpoint=e}get inboxId(){return this.inboxProperties.id}get lastError(){return this._lastError}set lastError(e){this._lastError=e}async login(){try{const e=`${this.loginUrl}/${Du}`,t={username:this.username,password:this.password},i=await this.makeRequest("Login",e,"POST",t);if(y.debug("Signed in Response: ",i),i&&i.token)return this._checkpoint=0,{token:i.token,inboxId:i.inboxId}}catch(e){this.setError("Login",null,e),y.error(e)}return null}async getUserSettings(){try{const e=`${this.apiUrl}/${Fu}`,t=await this.makeRequest("Get User Settings",e,"GET",void 0);return t||null}catch(e){return y.error("Get Inbox Properties failed: ",e),this.setError("Get Inbox Properties",null,e),null}}async getInboxProperties(){try{for(let e=0;e<10;e++){e!==0&&this.reset();const t=`${this.apiUrl}/${qs}`+this._checkpoint,i=await this.makeRequest("Get Inbox Properties",t,"GET");if(i)return i.syncTaskBean.update.forEach(n=>{n.projectId==this.inboxProperties.id&&n.sortOrder<this.inboxProperties.sortOrder&&(this.inboxProperties.sortOrder=n.sortOrder)}),this.inboxProperties.sortOrder--,!0}}catch(e){y.error("Get Inbox Properties failed: ",e),this.setError("Get Inbox Properties",null,e)}return!1}async getProjectGroups(){try{const e=`${this.apiUrl}/${Nu}`,t=await this.makeRequest("Get Project Groups",e,"GET",void 0);if(t)return t}catch(e){y.error("Get Project Groups failed: ",e),this.setError("Get Project Groups",null,e)}return[]}async getProjects(){try{const e=`${this.apiUrl}/${Lu}`,t=await this.makeRequest("Get Projects",e,"GET",void 0);if(t)return t}catch(e){y.error("Get Projects failed: ",e),this.setError("Get Projects",null,e)}return[]}async getProjectSections(e){try{const t=`${this.apiUrl}/${xu}/${e}`,i=await this.makeRequest("Get Project Sections",t,"GET",void 0);return i||[]}catch(t){return y.error("Get Project Sections failed: ",t),this.setError("Get Project Sections",null,t),[]}}async getAllResources(){try{let e=10;for(;e>0;){const t=new Date(this._checkpoint);y.debug("Get All Resources",this._checkpoint?"as of: "+t.toISOString():"from the beginning of time. ");const i=`${this.apiUrl}/${qs}`+this._checkpoint,n=await this.makeRequest("Get All Resources",i,"GET",void 0);if(n)return n;e-=1,this.getPreviousCheckPoint()}}catch(e){y.error("Get All Resources failed: ",e),this.setError("Get All Resources",null,e)}return null}async getTaskDetails(){try{let e=10;for(;e>0;){const t=`${this.apiUrl}/${qs}`+this._checkpoint,i=await this.makeRequest("Get Task Details",t,"GET",void 0);if(i){if(i.syncTaskBean.update.length>0)return O().checkPoint!=i.checkPoint&&(this._checkpoint=i.checkPoint,O().checkPoint=this._checkpoint,Ee({checkPoint:this._checkpoint})),i.syncTaskBean;e-=1,this.getPreviousCheckPoint()}else e-=1,this.getPreviousCheckPoint()}return[]}catch(e){return y.error("Get Tasks Details failed: ",e),this.setError("Get Tasks",null,e),[]}}async getTasks(){try{let e=3;for(;e>0;){const t=`${this.apiUrl}/${qs}`+this._checkpoint,i=await this.makeRequest("Get Tasks",t,"GET",void 0);if(i)return y.debug("Got: ",i.syncTaskBean.update.length),i.syncTaskBean.update;if(e>0)this.getPreviousCheckPoint(),e=e-1;else return[]}}catch(e){return y.error("Get Tasks failed: ",e),this.setError("Get Tasks",null,e),[]}}async getTask(e,t){try{let i=`${this.apiUrl}/${Ia}/${e}`;const n=`?projectID=${t}`;t&&(i=i+n);const r=await this.makeRequest("Get Tasks",i,"GET",void 0);return r||null}catch(i){return y.error("Get Tasks failed: ",i),this.setError("Get Tasks",null,i),null}}async getAllCompletedItems(){try{const e=`${this.apiUrl}/${$u}`,t=await this.makeRequest("Get All Completed Items",e,"GET",void 0);return t?t.syncTaskBean.update:[]}catch(e){return y.error("Get All Completed Items failed: ",e),this.setError("Get All Completed Tasks",null,e),[]}}async addTask(e){try{let t=!0;e.isAllDay==null?t=!0:t=e.isAllDay;const i={id:e.id?e.id:os(),projectId:e.projectId?e.projectId:this.inboxProperties.id,sortOrder:e.sortOrder?e.sortOrder:this.inboxProperties.sortOrder,title:e.title,content:e.content?e.content:"",desc:e.desc?e.desc:"",startDate:e.startDate?e.startDate:null,dueDate:e.dueDate?e.dueDate:null,timeZone:e.timeZone?e.timeZone:"America/New_York",isAllDay:t,reminder:e.reminder?e.reminder:null,reminders:e.reminders?e.reminders:[{id:os(),trigger:"TRIGGER:PT0S"}],repeatFlag:e.repeatFlag?e.repeatFlag:null,priority:e.priority?e.priority:0,status:e.status?e.status:0,items:e.items?e.items:[],progress:e.progress?e.progress:0,modifiedTime:e.modifiedTime?e.modifiedTime:new Date().toISOString().replace("Z","+0000"),deleted:e.deleted?e.deleted:0,assignee:e.assignee?e.assignee:null,isDirty:e.isDirty?e.isDirty:!0,local:e.local?e.local:!0,remindTime:e.remindTime?e.remindTime:null,tags:e.tags?e.tags:[],childIds:e.childIds?e.childIds:[],parentId:e.parentId?e.parentId:null},n=`${this.apiUrl}/${Ia}`,r=await this.makeRequest("Add Task",n,"POST",i);if(r){let a;return a=r.sortOrder,this.inboxProperties.sortOrder=a-1,r}else return[]}catch(t){return y.error("Add Task failed: ",t),this.setError("Add Task",null,t),[]}}async updateTask(e){try{let t=!0;e.isAllDay==null?t=!0:t=e.isAllDay;const i={id:e.id?e.id:os(),projectId:e.projectId?e.projectId:this.inboxProperties.id,sortOrder:e.sortOrder?e.sortOrder:this.inboxProperties.sortOrder,title:e.title,content:e.content?e.content:"",desc:e.desc?e.desc:"",startDate:e.startDate?e.startDate:null,dueDate:e.dueDate?e.dueDate:null,timeZone:e.timeZone?e.timeZone:"America/New_York",isAllDay:t,reminder:e.reminder?e.reminder:null,reminders:e.reminders?e.reminders:[{id:os(),trigger:"TRIGGER:PT0S"}],repeatFlag:e.repeatFlag?e.repeatFlag:null,priority:e.priority?e.priority:0,status:e.status?e.status:0,items:e.items?e.items:[],progress:e.progress?e.progress:0,modifiedTime:e.modifiedTime?e.modifiedTime:new Date().toISOString().replace("Z","+0000"),deleted:e.deleted?e.deleted:0,assignee:e.assignee?e.assignee:null,isDirty:e.isDirty?e.isDirty:!0,local:e.local?e.local:!0,remindTime:e.remindTime?e.remindTime:null,tags:e.tags?e.tags:[],childIds:e.childIds?e.childIds:[],parentId:e.parentId?e.parentId:null};let n;n={add:[],addAttachments:[],delete:[],deleteAttachments:[],updateAttachments:[],update:[i]};const r=`${this.apiUrl}/${_a}`,a=await this.makeRequest("Update Task",r,"POST",n);return a||null}catch(t){return y.error("Update Task failed: ",t),this.setError("Update Task",null,t),null}}async deleteTask(e,t){if(!e||!t)throw new Error("Both Task Id and Project ID are required for a delete, otherwise TickTick will fail silently.");try{const i={taskId:e,projectId:t};let n;n={add:[],addAttachments:[],delete:[i],deleteAttachments:[],updateAttachments:[],update:[]};const r=`${this.apiUrl}/${_a}`,a=await this.makeRequest("Delete Task",r,"POST",n);return a?(this.inboxProperties.sortOrder=a.sortOrder-1,a):null}catch(i){return y.error("Delete Task  failed: ",i),this.setError("Delete Task Tasks",null,i),null}}async exportData(){try{const e=`${this.apiUrl}/${Mu}`,t=await this.makeRequest("Export",e,"GET",void 0);if(t){let i=t;return i=i.substring(1),i=i.substring(0,i.length-1),i=i.replace(/\\\"/g,'"'),i=i.replace(/\\n/g,`
`),i}else return null}catch(e){return y.error("Export failed: ",e),this.setError("Export",null,e),null}}async projectMove(e,t,i){try{const n=`${this.apiUrl}/${ju}`,r=[{fromProjectId:t,toProjectId:i,taskId:e,sortOrder:this.inboxProperties.sortOrder}],a=await this.makeRequest("Project Move",n,"POST",r);return a?(this.inboxProperties.sortOrder=a.sortOrder-1,a):null}catch(n){return y.error("Project Move failed: ",n),this.setError("Project Move",null,n),null}}async parentMove(e,t,i){try{const n=`${this.apiUrl}/${Ru}`,r=[{parentId:t,projectId:i,taskId:e}],a=await this.makeRequest("Project Move",n,"POST",r);if(a)return this.inboxProperties.sortOrder=a.sortOrder-1,a}catch(n){return y.error("Parent Move failed: ",n),this.setError("Parent Move",null,n),null}}async makeRequest(e,t,i,n=void 0){this.lastError=void 0;try{let r={};e=="Login"?r=this.createLoginRequestOptions(t,n):(this.cookieHeader||(this.cookieHeader=localStorage.getItem("TTS_Cookies")),r=this.createRequestOptions(i,t,n));const a=await F.requestUrl(r);return a.status!=200?(this.setError(e,a,null),null):(this.cookies=a.headers["set-cookie"]??[],this.cookieHeader=this.cookies.join("; ")+";",localStorage.setItem("TTS_Cookies",this.cookieHeader),a.json)}catch(r){return this.setError(e,null,r),y.error(r),null}}createLoginRequestOptions(e,t){const i={Accept:"*/*","x-device":this.deviceAgent,"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"};return{method:"POST",url:e,headers:i,contentType:"application/json",body:t?JSON.stringify(t):void 0,throw:!1}}createRequestOptions(e,t,i){let n={"Content-Type":"application/json","User-Agent":`${this.userAgent}`,"x-device":`${this.deviceAgent}`,Cookie:`t=${this.token};`+this.cookieHeader,t:`${this.token}`};return{method:e,url:t,headers:n,contentType:"application/json",body:i?JSON.stringify(i):void 0,throw:!1}}setError(e,t,i){if(t){const n=t.status;let r;if(n==429)r="Error: "+n+" TickTick reporting too many requests.",this._lastError={operation:e,statusCode:n,errorMessage:r};else{try{r=t.json}catch{y.debug("Bad JSON response"),y.debug("Trying Text.");try{r=this.extractTitleContent(t.text),y.error("Error: ",r)}catch{y.debug("Bad text response"),y.debug("No error message."),r="No Error message received."}}this._lastError={operation:e,statusCode:n,errorMessage:r}}}else{let n,r=666;i?n=i:n="Unknown Error",y.error(e,n),this._lastError={operation:e,statusCode:r,errorMessage:n}}}getPreviousCheckPoint(){let e=new Date;return e.setDate(e.getDate()-15),this._checkpoint=e.getTime(),y.debug("Checkpoint has been changed.",this._checkpoint),this._checkpoint}extractTitleContent(e){const t="<title>",i="</title>",n=e.indexOf(t)+t.length,r=e.indexOf(i);return e.substring(n,r)}getUserAgent(){return navigator.userAgent}getXDevice(){const e=this.generateRandomID(),t=6070;return _u.UAParser(navigator.userAgent),JSON.stringify({platform:"web",os:"Windows 10",device:"Firefox 117.0",name:"",version:t,id:e,channel:"website",campaign:"",websocket:""})}getPlatform(){if(F.Platform.isIosApp)return"ios";if(F.Platform.isAndroidApp)return"android";if(F.Platform.isMacOS)return"macOS";if(F.Platform.isWin)return"windows";if(F.Platform.isLinux)return"linux";if(F.Platform.isSafari)return"safari"}reset(){this._checkpoint=this.getPreviousCheckPoint()}generateRandomID(){let e=localStorage.getItem("TTS_UniqueID");if(e&&e.includes("-")&&(localStorage.removeItem("TTS_UniqueID"),e=null),!e){const t="66",n="0123456789abcdef";e=t;const r=24-t.length;for(let a=0;a<r;a++){const o=Math.floor(Math.random()*n.length);e+=n[o]}localStorage.setItem("TTS_UniqueID",e)}return e}generateRandomVersion(){let e;do e=Math.floor(Math.random()*4e3)+6e3;while(e<6e3||e>9999);return e}}const Xn={};async function lt(s,e){Xn[s]||(Xn[s]=[]);const t=Xn[s],i=t.length===0;let n=()=>{};const r=new Promise(a=>{n=a});t.push(r),i||await t[t.length-2];try{return await e()}catch(a){throw a}finally{t.splice(0,1),n()}}class Ro extends F.Modal{constructor(e,t,i,n){super(e),this.title="Task Deletion Confirmation",this.message="The following Task(s) will be deleted because: ",this.cancelLabel="Cancel",this.confirmLabel="Confirm Deletion",this.taskTitles=[],this.taskTitles=t,this.reason=i,this.onSubmit=n}onOpen(){const{titleEl:e,contentEl:t}=this;e.setText(this.title),t.createEl("p",{text:`${this.message}${this.reason}`});const i=t.createEl("ul");this.taskTitles.forEach(n=>{i.createEl("li",{text:n})}),new F.Setting(t).addButton(n=>{n.setClass("ts_button"),n.setButtonText(this.cancelLabel),n.onClick(()=>{this.result=!1,this.onSubmit(this.result),this.close()})}).addButton(n=>{n.setClass("ts_button"),n.setWarning(),n.setButtonText(this.confirmLabel),n.onClick(()=>{this.result=!0,this.onSubmit(this.result),this.close()})})}onClose(){this.titleEl.empty(),this.contentEl.empty(),super.onClose(),this.resolvePromise(this.result)}showModal(){return this.open(),new Promise(e=>this.resolvePromise=e)}}class $t{constructor(e,t,i){this.fileLines=[],this.app=e,this.plugin=t,this.file=i}addTask(e,t,i=-1){let n=this.fileLines.length;i>=0?n=i:e.parentId?n=this.getTaskEndLineByTaskID(e.parentId)+1:n=this.fileLines.length;let r=t.split(`
`);return this.fileLines.splice(n,0,...r),n}updateTask(e,t,i=!1){let n=this.getTaskIndex(e.id),r=0,a=0;n>=0?(r=this.getTaskEndLineByTaskID(e.id),a=r-n+1):n=0;let o={};e.childIds&&e.childIds.length>0&&(o=this.buildMoveMap(e.id,e.childIds,o));const l=t.split(`
`);if(this.fileLines.splice(n,a,...l),i){let c=0;e.parentId?c=this.getTaskIndex(e.parentId):c=n,n!=c&&this.moveTask(n,c),e.childIds&&e.childIds.length>0&&(o[e.id].tabs=this.plugin.taskParser.getTabs(t),this.fixUpChildren(o))}}deleteTask(e,t=!1){if(!t)this.deleteTaskAndLines(e);else{let i={};const n=this.plugin.taskParser.getTabs(this.fileLines[e]),r=this.findChildren(this.getTaskIndex(e),n);i=this.buildMoveMap(e,r,i),Object.entries(i).sort(([,o],[,l])=>o.depth-l.depth).forEach(([o,l])=>{this.deleteTaskAndLines(o)})}}getFileLines(){return this.fileLines.join(`
`)}getTaskRecord(e){return this.getTaskLines(e)}getNumParentTabs(e){return this.plugin.taskParser.getNumTabs(this.fileLines[this.getTaskIndex(e)])}getTaskItems(e){const t=this.getTaskIndex(e),i=[];for(let n=t+1;n<this.fileLines.length;n++){const r=this.fileLines[n];if(this.plugin.taskParser.isMarkdownTask(r)){if(this.plugin.taskParser.getTickTickId(r))break;this.plugin.taskParser.getLineItemId(r)&&i.push(r)}}return i}getFilePath(){return this.file.path}getTaskIndex(e){return this.fileLines.findIndex(t=>this.plugin.taskParser.isMarkdownTask(t)&&t.includes(e))}getTaskString(e){return this.fileLines[this.getTaskIndex(e)]}async init(e=null){let t;e?t=e:t=await this.app.vault.read(this.file),t&&(this.fileLines=t.split(`
`))}getTaskItemRecord(e){const t={},i=this.fileLines[this.getTaskIndex(e)];return t.parentId=this.getParentId(e),t.ID=this.plugin.taskParser.getLineItemId(i),t}getTaskItemRecordByLine(e){const t={},i=this.fileLines[e],n=this.getParentIDByIdx(e);return t.ID=this.plugin.taskParser.getLineItemId(i),t.parentId=n,t}async getTaskRecordByLine(e){let t={};const i=this.getParentIDByIdx(e);if(t=this.getTaskLinesByIdx(e,t),t.parentId=i,t.taskLines&&t.taskLines.length>0){this.fileLines.splice(e+1,t.taskLines.length-1);const n=this.fileLines.join(`
`);await this.app.vault.modify(this.file,n)}return t}markAllTasks(){var i,n,r,a,o,l;let e=!1;const t=this.fileLines;for(let c=0;c<t.length;c++){const f=t[c];if((i=this.plugin.taskParser)!=null&&i.isMarkdownTask(f)&&((n=this.plugin.taskParser)==null?void 0:n.getTaskContentFromLineText(f))!=""&&!((r=this.plugin.taskParser)!=null&&r.hasTickTickId(f))&&!((a=this.plugin.taskParser)!=null&&a.hasTickTickTag(f))&&!((o=this.plugin.taskParser)!=null&&o.getLineItemId(f))){let p=(l=this.plugin.taskParser)==null?void 0:l.addTickTickTag(f);t[c]=p,e=!0}}return e}modifyTask(e,t){this.fileLines[t]=e}fixChildTabs(e,t){let i=this.plugin.taskParser.getTabs(this.fileLines[t]);return i+="	",this.fixTabs(e,i)}deleteTaskAndLines(e){const t=this.getTaskIndex(e),i=this.getTaskEndLineByTaskID(e)-t+1;this.fileLines.splice(t,i)}getTaskEndLineByTaskID(e){const t=this.getTaskIndex(e);return this.getTaskEndLineByIdx(t)}getTaskEndLineByIdx(e){const t=this.plugin.taskParser.getTabs(this.fileLines[e]),i=t.length,n=t+"  ";for(let r=e+1;r<this.fileLines.length;r++){const a=this.fileLines[r],o=this.plugin.taskParser.getNumTabs(a);if(this.plugin.taskParser.isMarkdownTask(a)&&this.plugin.taskParser.hasTickTickId(a)||o<i)return r-1;if(!(this.plugin.taskParser.isMarkdownTask(a)&&this.plugin.taskParser.getLineItemId(a)||a.startsWith(n))&&(o<i||!a.startsWith(n)))return r-1}return this.fileLines.length-1}getTaskLines(e){let t={};const i=this.getTaskIndex(e);return t=this.getTaskLinesByIdx(i,t),t}getTaskLinesByIdx(e,t){const i=[],n=this.plugin.taskParser.getNumTabs(this.fileLines[e]);t.parentId=this.getParentIDByIdx(e);for(let r=e;r<this.fileLines.length;r++){const a=this.fileLines[r];if(r===e)t.task=a;else{const o=this.plugin.taskParser.getTabs(a),l=o.length,c=o+"  ";if(n===l&&!this.plugin.taskParser.isMarkdownTask(a)&&a.startsWith(c))i.push(a);else{n<l&&this.plugin.taskParser.isMarkdownTask(a)?this.plugin.taskParser.getLineItemId(a)?t.isNote=!1:this.plugin.taskParser.hasTickTickId(a)&&(t.isNote=!0):t.isNote=!0;break}}}return t.taskLines=i,i&&i.length>0&&t.isNote==null&&(t.isNote=!0),t}getParentId(e){const t=this.getTaskIndex(e);return this.getParentIDByIdx(t)}getParentIDByIdx(e){let t=this.plugin.taskParser.getNumTabs(this.fileLines[e]),i="";for(let n=e-1;n>=0;n--){const r=this.fileLines[n];if(this.plugin.taskParser.isMarkdownTask(r)){const a=this.plugin.taskParser.getNumTabs(this.fileLines[n]),o=this.plugin.taskParser.getTickTickId(r);if(a<t){i=o||"";break}}}return i}fixUpChildren(e){Object.entries(e).sort(([,i],[,n])=>i.depth-n.depth).forEach(([i,n])=>{n.depth==0&&n.tabs;const r=this.getTaskIndex(i);n.children.forEach(a=>{const o=this.getTaskIndex(a),l=this.fixChildTabs(a,r);this.fileLines.splice(o,l.length,...l),this.moveTask(o,r)})})}fixTabs(e,t){const i=this.getTaskIndex(e),n=this.getTaskEndLineByTaskID(e)+1,r=this.fileLines.slice(i,n);for(let a=0;a<r.length;a++){let o=t;this.plugin.taskParser.isMarkdownTask(r[a])&&a>0&&(o=t+"	"),r[a].startsWith("	")?r[a]=r[a].replace(/\t+/g,o):r[a]=o+r[a]}return r}moveTask(e,t){const i=this.getTaskEndLineByIdx(e)-e+1,n=this.plugin.taskParser.getTickTickId(this.fileLines[t]),r=this.fileLines.splice(e,i);n&&(t=this.getTaskEndLineByIdx(this.getTaskIndex(n))+1),this.fileLines.splice(t,0,...r)}findChildren(e,t){const i=[],n=t.length+1;for(let r=e+1;r<this.fileLines.length;r++){const a=this.fileLines[r],o=this.plugin.taskParser.getTickTickId(a);this.plugin.taskParser.getNumTabs(a)===n&&this.plugin.taskParser.isMarkdownTask(a)&&o&&i.push(o)}return i}buildMoveMap(e,t,i,n=0){const r=this.getTaskIndex(e),a=this.plugin.taskParser.getTabs(this.fileLines[r]),o=t;return i[e]={tabs:a,children:o,depth:n},o&&o.length>0&&o.forEach(l=>{const c=this.getTaskIndex(l),f=this.plugin.taskParser.getTabs(this.fileLines[c]),p=this.findChildren(c,f);this.buildMoveMap(l,p,i,n+1)}),i}}class Bu{constructor(e,t){this.app=e,this.plugin=t}async deletedTaskCheck(e){var l,c,f,p,d;let t,i,n,r;if(e){if(t=this.app.vault.getAbstractFileByPath(e),t&&t instanceof F.TFolder)return;r=e,t instanceof F.TFile&&(i=await this.app.vault.read(t))}else n=this.app.workspace.getActiveViewOfType(F.MarkdownView),t=this.app.workspace.getActiveFile(),r=t==null?void 0:t.path,i=n==null?void 0:n.data;let a=await((l=this.plugin.cacheOperation)==null?void 0:l.getFileMetadata(r,null));if(!a||!a.TickTickTasks)return;let o=a.TickTickTasks;if(i){const u=i.replace(/^---[\s\S]*?---\n/,""),g=await this.findMissingTaskIds(u,o,r);if(g.length>0){if(await this.deleteTasksByIds(g),a=await((c=this.plugin.cacheOperation)==null?void 0:c.getFileMetadata(r,null)),!a||!a.TickTickTasks)return;o=a.TickTickTasks}const m=[];for(const v of o)if(v.taskItems){for(const b of v.taskItems)u.includes(b)||m.push(b);if(m.length>0)try{let b=await((f=this.plugin.cacheOperation)==null?void 0:f.removeTaskItem(a,v.taskId,m));if(b){let w=this.plugin.taskParser.getObsidianUrlFromFilepath(r);w&&(b.title=b.title+" "+w);let k=await((p=this.plugin.tickTickRestAPI)==null?void 0:p.UpdateTask(b))}}catch(b){y.error("Task Item removal failed: ",b)}}}else{let u=o.map(g=>g.taskId);if(u.length>0){let g=[];for(const h of u){const m=(d=this.plugin.cacheOperation)==null?void 0:d.getFilepathForTask(h);m&&m!=r&&(y.debug("== found:",h,m),g.push(h))}u=u.filter(h=>!g.includes(h))}u.length>0&&(y.error("Content not readable.",i,r," file could open elsewhere or deleted."),new F.Notice(`All content from ${e} APPEARS to have been removed.
If this is correct, please confirm task deletion. Otherwise, cancel task deletion.`,0),await this.deleteTasksByIds(u))}}async findMissingTaskIds(e,t,i){var l;const n=/%%\[ticktick_id:: ([a-f0-9]{24})\]%%/g,r=e.matchAll(n),a=new Set([...r].map(c=>c[1]));let o=t.filter(c=>!a.has(c.taskId)).map(c=>c.taskId);if(o&&o.length>0){let c=[];for(const f of o){const p=(l=this.plugin.cacheOperation)==null?void 0:l.getFilepathForTask(f);p&&p!=i&&(y.debug("Task found in different file:",f,p),c.push(f))}o=o.filter(f=>!c.includes(f))}return o}async lineNewContentTaskCheck(e,t){var f;(f=t.file)==null||f.path;const i=t==null?void 0:t.data,n=e.getCursor(),r=n.line,a=e.getLine(r);let o=i==null?void 0:i.length;const l=new $t(this.app,this.plugin,t.file);await l.init(i),await this.addTask(a,r,e,n,l);let c=i==null?void 0:i.length;return o!=c}async addTask(e,t,i,n,r){var a,o,l,c,f,p,d,u;if(!(!e||e.length==0)&&!this.plugin.taskParser.hasTickTickId(e)&&this.plugin.taskParser.hasTickTickTag(e))try{const g=await this.plugin.taskParser.convertLineToTask(e,t,r.getFilePath(),r,null),h=await((a=this.plugin.tickTickRestAPI)==null?void 0:a.AddTask(g));if(g.parentId){let k=(o=this.plugin.cacheOperation)==null?void 0:o.loadTaskFromCacheID(g.parentId);k=this.plugin.taskParser.addChildToParent(k,g.parentId),k=await((l=this.plugin.tickTickRestAPI)==null?void 0:l.UpdateTask(k)),await((c=this.plugin.cacheOperation)==null?void 0:c.updateTaskToCache(k))}const m=h.id;new F.Notice(`new task ${h.title} id is ${h.id}`),g.status!=0&&(await((f=this.plugin.tickTickRestAPI)==null?void 0:f.CloseTask(h.id,h.projectId)),await((p=this.plugin.cacheOperation)==null?void 0:p.closeTaskToCacheByID(m))),h.dateHolder=g.dateHolder,await this.updateTaskLine(h,e,i,n,t,r);const v=r.getTaskRecord(h.id),w=v.task+this.plugin.taskParser.getNoteString(v,h.id).textContent;h.lineHash=await((d=this.plugin.taskParser)==null?void 0:d.getLineHash(w)),await((u=this.plugin.cacheOperation)==null?void 0:u.appendTaskToCache(h,r.getFilePath())),await this.plugin.saveSettings()}catch(g){y.error("Error adding task:",g),y.error(`The error occurred in file: ${r.getFilePath()}`)}}async fullTextNewTaskCheck(e){var o,l;let t,i=null,n=null;if(e){if(t=this.app.vault.getAbstractFileByPath(e),t&&t instanceof F.TFolder)return!1;if(!t)return y.error(`File: ${e} not found. Removing from Meta Data`),await((o=this.plugin.cacheOperation)==null?void 0:o.deleteFilepathFromMetadata(e)),!1}else throw new Error("No file path provided");const r=new $t(this.app,this.plugin,t);await r.init(),O().enableFullVaultSync&&await((l=this.plugin.fileOperation)==null?void 0:l.addTickTickTagToFile(r));const a=r.getFileLines().split(`
`);for(let c=0;c<a.length;c++){const f=a[c];await this.addTask(f,c,i,n,r)}return!0}async lineModifiedTaskCheck(e,t,i,n){var o,l,c,f,p,d,u,g,h,m,v,b,w,k,T,I,E,S,L,A,_,C,D,R,M,j,q,ee,oe,te,ue,ve;let r=!1;if(O().enableFullVaultSync){if(!await((o=this.plugin.cacheOperation)==null?void 0:o.getFileMetadata(e)))return!1;await this.plugin.saveSettings()}let a;if((l=this.plugin.taskParser)!=null&&l.hasTickTickId(t)&&((c=this.plugin.taskParser)!=null&&c.hasTickTickTag(t))){const se=this.plugin.taskParser.getTickTickId(t),me=n.getTaskRecord(se);if(!me)return y.error("Task Not Found in file map",n.file,e,se),!1;if(!me.task)return y.error("Task Not Found in file map",me,se),!1;let W="";me.taskLines&&me.taskLines.length>1&&(W=this.plugin.taskParser.getNoteString(me,se).textContent);const de=await((f=this.plugin.taskParser)==null?void 0:f.getLineHash(t+W)),B=(p=this.plugin.cacheOperation)==null?void 0:p.loadTaskFromCacheID(se);let ae=!1,ye="";if(B&&B.lineHash)if(de==B.lineHash){a=!1;const ne=await this.checkForMoves(se,e);ae=ne.projectMoved,ye=ne.oldFilePath;const Pe=(me.parentId?me.parentId:"")!=(B.parentId?B.parentId:"");if(!ae&&!Pe)return!1;y.debug("Task Moved.",{projectMoved:ae,parentChanged:Pe,taskrecordparentid:me.parentId,savedtaskparentid:B.parentId,lineText:t,savedTaskTitle:B.title,newHash:de,oldHash:B.lineHash})}else O().debugMode&&y.debug("Task Hash Changed.",`
`,t,`
`,B.title,`
`,de,`
`,B.lineHash),a=!0;const U=await((d=this.plugin.taskParser)==null?void 0:d.convertLineToTask(t,i,e,n,me));if(B)B.dateHolder||(B.dateHolder=(g=this.plugin.dateMan)==null?void 0:g.getEmptydateHolder(),await((h=this.plugin.cacheOperation)==null?void 0:h.updateTaskToCache(B,null))),B.lineHash||(B.lineHash=await((m=this.plugin.taskParser)==null?void 0:m.getLineHash(de)));else{y.error(`There is no task for ${t.substring(0,10)} in the local cache. It will be deleted from file ${e}`),new F.Notice(`There is no task ${this.plugin.taskParser.getTaskContentFromLineText(t)} in the local cache. It will be deleted`);const ne=this.plugin.app.vault.getAbstractFileByPath(e);return await((u=this.plugin.fileOperation)==null?void 0:u.deleteTaskFromSpecificFile(ne,U,!0)),!1}const Z=U.title,Oe=(v=this.plugin.taskParser)==null?void 0:v.isTitleChanged(U,B),Se=(b=this.plugin.taskParser)==null?void 0:b.isTagsChanged(U,B),je=(w=this.plugin.taskParser)==null?void 0:w.isStatusChanged(U,B),De=(k=this.plugin.dateMan)==null?void 0:k.areDatesChanged(U,B),Ne=(T=this.plugin.taskParser)==null?void 0:T.isParentIdChanged(U,B),Ce=U.priority!=B.priority,Le=this.plugin.taskParser.areItemsChanged(U.items,B.items);let Fe=!1;O().syncNotes&&(U.content?Fe=this.plugin.taskParser.areNotesChanged(U.content,B.content):U.desc&&(Fe=this.plugin.taskParser.areNotesChanged(U.desc,B.desc)));try{let ne=!1,Pe=!1,xe=!1,$e=!1,qe=!1,tt=!1,J=!1,Q=!1,H=!1;if(Oe&&(O().debugMode&&y.debug(`Title modified for task ${se}
"New:" ${U.title}
"Cached:" ${B.title}`),ne=!0),Se&&(O().debugMode&&y.debug(`Tags modified for task ${se}, , ${U.tags}, ${B.tags}`),Pe=!0),De&&(O().debugMode&&y.debug(`Dates modified for task ${se}`),qe=!0),U.timeZone=B.timeZone,ae){await((I=this.plugin.tickTickRestAPI)==null?void 0:I.moveTaskProject(U,B.projectId,U.projectId));let V="";O().debugMode&&y.debug("Project Moved"),V=`Task ${se}: ${this.plugin.taskParser.getTaskContentFromLineText(Z)} has moved from ${ye} to ${e} 
If any children were moved, they will be updated to ${O().baseURL} on the next Sync event`,new F.Notice(V,5e3),O().debugMode&&y.debug(V),xe=!0}if(Ne){let V=await((E=this.plugin.cacheOperation)==null?void 0:E.loadTaskFromCacheID(B.parentId)),Me=await((S=this.plugin.cacheOperation)==null?void 0:S.loadTaskFromCacheID(U.parentId)),it=`Task ${se}:
${(L=this.plugin.taskParser)==null?void 0:L.stripOBSUrl(Z).trim()}
used to be a child of:
${V?V.title.trim():"No old parent found"}
but is now a child of:
${Me?Me.title.trim():"No new parent found."}
If any children were moved, they will be updated to ${O().baseURL} on the next Sync event`;await((A=this.plugin.tickTickRestAPI)==null?void 0:A.moveTaskParent(se,B.parentId,U.parentId,U.projectId)),new F.Notice(it,5e3),O().debugMode&&y.debug(it),tt=!0}if(Ce&&(J=!0),Le&&(O().debugMode&&y.debug("Number of items changed: ",(_=U.items)==null?void 0:_.length,(C=B.items)==null?void 0:C.length),Q=!0),Fe&&(O().debugMode&&(U.content?y.debug("Notes changed: ",U.content,B.content):y.debug("Desc changed: ",U.desc,B.desc)),H=!0),ne||Pe||qe||xe||tt||J||tt||Q||H){B.modifiedTime=(D=this.plugin.dateMan)==null?void 0:D.formatDateToISO(new Date);const V=U.dateHolder,Me=await((R=this.plugin.tickTickRestAPI)==null?void 0:R.UpdateTask(U));Me.dateHolder=V,Me.lineHash=de,xe?await((j=this.plugin.cacheOperation)==null?void 0:j.updateTaskToCache(Me,e)):await((M=this.plugin.cacheOperation)==null?void 0:M.updateTaskToCache(Me,null)),r=!0}if(je&&(O().debugMode&&y.debug(`Status modified for task ${se}`),U.status!=0?(O().debugMode&&y.debug("task completed"),(q=this.plugin.tickTickRestAPI)==null||q.CloseTask(U.id,U.projectId),await((ee=this.plugin.cacheOperation)==null?void 0:ee.closeTaskToCacheByID(U.id))):(O().debugMode&&y.debug("task not completed"),(oe=this.plugin.tickTickRestAPI)==null||oe.OpenTask(U.id,U.projectId),await((te=this.plugin.cacheOperation)==null?void 0:te.reopenTaskToCacheByID(U.id))),$e=!0,new F.Notice(`Task Status for ${se} updated `)),ne||Pe||qe||xe||tt||J||tt||Q||H){await this.plugin.saveSettings();let V=`Task ${se} is updated.`;new F.Notice(V),ne&&(V+=`
Content was changed.`),$e&&(V+=`
Status was changed.`),qe&&(V+=`
Due date was changed.`),Pe&&(V+=`
Tags were changed.`),xe&&(V+=`
Project was changed.`),J&&(V+=`
Priority was changed.`),Ne&&(V+=`
Parent was changed.`),Q&&(V+=`
Task Items changed`),H&&(V+=`
Notes Changed`),O().debugMode&&y.debug("Task Changed: ",U.id,`
`,V)}}catch(ne){y.error("Error updating task:",ne)}if(!r&&a){const ne=await((ue=this.plugin.taskParser)==null?void 0:ue.getLineHash(t+W));U.lineHash=ne,await((ve=this.plugin.cacheOperation)==null?void 0:ve.updateTaskToCache(U,null)),await this.plugin.saveSettings(),y.debug(`Updated hash: ${ne}`)}}else this.plugin.taskParser.isMarkdownTask(t)&&(r=await this.handleTaskItem(t,n,i));return r}async deleteTaskItemCheck(e,t,i,n){var r,a,o,l,c,f,p,d,u,g,h;if(!((r=this.plugin.taskParser)!=null&&r.hasTickTickId(t))&&!((a=this.plugin.taskParser)!=null&&a.hasTickTickTag(t))&&((o=this.plugin.taskParser)!=null&&o.isMarkdownTask(t))){let m=!1;if(!((l=this.plugin.taskParser)!=null&&l.isMarkdownTask(t)))return;let v=(c=this.plugin.taskParser)==null?void 0:c.taskFromLine(t),b=v==null?void 0:v.indent,w=v==null?void 0:v.description;v==null||v.status;let k;if(b>0){const T=n.split(`
`);for(let I=i-1;I>=0;I--){const E=T[I];if((f=this.plugin.taskParser)!=null&&f.hasTickTickId(E)&&((p=this.plugin.taskParser)!=null&&p.hasTickTickTag(E))){const S=this.plugin.taskParser.getTickTickId(E);if(k=await((d=this.plugin.cacheOperation)==null?void 0:d.loadTaskFromCacheID(S)),k&&k.items){let L="",_=/%%(.*)%%/.exec(w);if(_){L=_[1],k.items.find(D=>D.id===L)&&(k.items=k.items.filter(D=>D.id!==L),m=!0);break}else{y.debug(`${L} Not found.`);break}}else break}}m&&(k.modifiedTime=(u=this.plugin.dateMan)==null?void 0:u.formatDateToISO(new Date),await((g=this.plugin.tickTickRestAPI)==null?void 0:g.UpdateTask(k)),await((h=this.plugin.cacheOperation)==null?void 0:h.updateTaskToCache(k)))}}}async fullTextModifiedTaskCheck(e){var t;try{let i,n,r;if(e){if(i=this.app.vault.getAbstractFileByPath(e),i&&i instanceof F.TFolder)return}else r=this.app.workspace.getActiveViewOfType(F.MarkdownView),i=this.app.workspace.getActiveFile(),e=i==null?void 0:i.path;let a=!1;const o=new $t(this.app,this.plugin,i);await o.init();const l=o.getFileLines().split(`
`);for(let c=0;c<l.length;c++){const f=l[c];if((t=this.plugin.taskParser)!=null&&t.isMarkdownTask(f))try{await this.lineModifiedTaskCheck(e,f,c,o),a=!0}catch(p){y.error("Error modifying task:",p)}}}catch(i){y.error("Error:",i)}}async closeTask(e){var t,i;try{let n=await((t=this.plugin.cacheOperation)==null?void 0:t.closeTaskToCacheByID(e));await((i=this.plugin.tickTickRestAPI)==null?void 0:i.CloseTask(e,n)),await this.plugin.saveSettings(),new F.Notice(`Task ${e} is closed.`)}catch(n){throw y.error("Error closing task:",n),n}}async reopenTask(e){var t,i;try{let n=await((t=this.plugin.cacheOperation)==null?void 0:t.reopenTaskToCacheByID(e));await((i=this.plugin.tickTickRestAPI)==null?void 0:i.OpenTask(e,n)),await this.plugin.fileOperation.uncompleteTaskInTheFile(e),await this.plugin.saveSettings(),new F.Notice(`Task ${e} is reopened.`)}catch(n){throw y.error("Error opening task:",n),n}}async deleteTasksByIds(e){var n,r,a;const t=[];if(!await this.confirmDeletion(e,"The tasks were removed from the file"))return new F.Notice("Tasks will not be deleted. Please rectify the issue before the next sync.",5e3),[];for(const o of e)try{let l,c=await((n=this.plugin.cacheOperation)==null?void 0:n.getProjectIdForTask(o));c&&(l=await((r=this.plugin.tickTickRestAPI)==null?void 0:r.deleteTask(o,c))),l&&new F.Notice(`Task ${o} is deleted.`),t.push(o)}catch(l){y.error(`Failed to delete task ${o}: ${l}`)}return t.length?(await((a=this.plugin.cacheOperation)==null?void 0:a.deleteTaskFromCacheByIDs(t)),await this.plugin.saveSettings(),t):(O().debugMode&&y.debug("Task not deleted:",t),[])}async syncCompletedTaskStatusToObsidian(e){var t,i;try{const n=[];for(const r of e)await this.plugin.fileOperation.completeTaskInTheFile(r.object_id),await((t=this.plugin.cacheOperation)==null?void 0:t.closeTaskToCacheByID(r.object_id)),new F.Notice(`Task ${r.object_id} is closed.`),n.push(r);await((i=this.plugin.cacheOperation)==null?void 0:i.appendTaskToCache(n)),await this.plugin.saveSettings()}catch(n){y.error("Error synchronizing task status:",n)}}async syncUncompletedTaskStatusToObsidian(e){var t,i;try{const n=[];for(const r of e)await this.plugin.fileOperation.uncompleteTaskInTheFile(r.object_id),await((t=this.plugin.cacheOperation)==null?void 0:t.reopenTaskToCacheByID(r.object_id)),new F.Notice(`Task ${r.object_id} is reopened.`),n.push(r);await((i=this.plugin.cacheOperation)==null?void 0:i.appendTaskToCache(n)),await this.plugin.saveSettings()}catch(n){y.error("Error synchronizing task status:",n)}}async syncTickTickToObsidian(){var e,t,i,n,r,a,o,l,c;try{if(!await this.plugin.saveProjectsToCache())return y.error("probable network connection error."),!1;let p=!1;const d=await((e=this.plugin.tickTickRestAPI)==null?void 0:e.getAllResources());if(!d)return y.error("probable network connection error."),!1;d.projectGroups&&Mo(d.projectGroups);const u=d.syncTaskBean;let g=u.update,h=u.delete,m=O().SyncTag;if(m&&(m.toLowerCase(),m.includes("/")&&(m=m.replace(/\//g,"-"))),m&&O().SyncProject)if(O().tagAndOr==1){let _;_=g.filter(C=>{var D;return _=(D=C.tags)==null?void 0:D.includes(m),_}),_&&(g=_.filter(C=>C.projectId===O().SyncProject))}else{let _=g.filter(D=>{var R;return(R=D.tags)==null?void 0:R.includes(m)}),C=g.filter(D=>D.projectId===O().SyncProject);g=[..._,...C].reduce((D,R)=>{const M=D.find(j=>j.id===R.id);return M?Object.assign(M,R):D.push(R),D},[])}else(m||O().SyncProject)&&(g=g.filter(A=>{var D;const _=(D=A.tags)==null?void 0:D.includes(m),C=A.projectId===O().SyncProject;return _||C}));let v=await((t=this.plugin.cacheOperation)==null?void 0:t.loadTasksFromCache());if(O().debugMode){if(g){y.debug("We have: ",g.length," recent tasks on "+((n=(i=this.plugin.tickTickRestAPI)==null?void 0:i.api)==null?void 0:n.apiUrl));const A=g.filter(C=>C.status!=0),_=g.filter(C=>C.status===0);y.debug("openTasks",_.length,"closedTasks",A.length)}else y.debug("No tasks found.");v?y.debug("There are: ",v.length," tasks in Cache."):y.debug("There are no tasks in cache.")}v?v=v.sort((A,_)=>A.id>_.id?1:_.id>A.id?-1:0):v=[],g?g=g.sort((A,_)=>A.id>_.id?1:_.id>A.id?-1:0):g=[];let b=[];Object.keys(O().fileMetadata).length===0?b=g:b=g.filter(A=>!v.some(_=>_.id===A.id)),b.length>0&&(b.forEach(_=>{var C;(C=this.plugin.dateMan)==null||C.addDateHolderToTask(_)}),await((r=this.plugin.fileOperation)==null?void 0:r.synchronizeToVault(b,!1))&&await new Promise(_=>setTimeout(_,1e3)),p=!0);const k=v.filter(A=>!g.some(_=>_.id===A.id)).filter(A=>h.some(_=>_.taskId===A.id));if(k.length>0){const A=k.map(C=>C.id);if(await this.confirmDeletion(A,"tasks deleted from TickTick")){k.sort((C,D)=>!C.parentId&&D.parentId?-1:C.parentId&&!D.parentId?1:0);for(const C of k){try{await((a=this.plugin.fileOperation)==null?void 0:a.deleteTaskFromFile(C))}catch(D){y.debug("Task deletion failed.",D)}try{await((o=this.plugin.cacheOperation)==null?void 0:o.deleteTaskFromCache(C.id)),p=!0}catch(D){y.debug("Task deletion failed.",D),p=!0}}}}const I=v.filter(A=>!g.some(_=>_.id===A.id)).filter(A=>k.some(_=>_.taskId===A.id));for(const A of I)await((l=this.plugin.tickTickRestAPI)==null?void 0:l.AddTask(A)),p=!0;const E=g.filter(A=>{const _=v.find(C=>C.id===A.id);return _&&new Date(_.modifiedTime)<new Date(A.modifiedTime)}),S=v.filter(A=>{const _=g.find(C=>C.id===A.id);return _&&new Date(_.modifiedTime)>new Date(A.modifiedTime)}),L=E.filter(A=>{const _=S.find(C=>C.id===A.id);return _&&_.modifiedTime===void 0?!0:_&&new Date(A.modifiedTime)>new Date(_.modifiedTime)});return L.length>0&&(await((c=this.plugin.fileOperation)==null?void 0:c.synchronizeToVault(L,!0))&&(await new Promise(_=>setTimeout(_,1e3)),p=!0),await this.plugin.saveSettings(),O().debugMode&&y.debug(p?"File System Modified.":"No synchronization changes.")),p}catch(f){y.error("An error occurred while synchronizing:",f)}return!1}dumpArray(e,t){y.debug(e,t)}async backupTickTickAllResources(){var e;try{let t=O().bkupFolder;t[t.length-1]!="/"&&(t+="/");const i=new Date,n=`${i.getFullYear()}${i.getMonth()+1}${i.getDate()}${i.getHours()}${i.getMinutes()}${i.getSeconds()}`,r=t+"ticktick-backup-"+n+".csv";y.debug("Creating Backup: ",r);const a=await((e=this.plugin.tickTickRestAPI)==null?void 0:e.exportData());a&&(await this.app.vault.create(r,a),new F.Notice(`TickTick backup data is saved in the path ${r}`))}catch(t){y.error("An error occurred while creating TickTick backup",t),new F.Notice("An error occurred while creating TickTick backup"+t,5e3)}}async updateTaskContent(e){var n,r,a,o,l,c;const t=await((n=this.plugin.cacheOperation)==null?void 0:n.getFileMetadata(e));if(!t||!t.TickTickTasks)return;const i=(r=this.plugin.taskParser)==null?void 0:r.getObsidianUrlFromFilepath(e);try{for(const f of t.TickTickTasks){const p=await((a=this.plugin.cacheOperation)==null?void 0:a.loadTaskFromCacheID(f.taskId));if(p){p.title=p.title+" "+i;const d=await((o=this.plugin.tickTickRestAPI)==null?void 0:o.UpdateTask(p));d.title=await((l=this.plugin.taskParser)==null?void 0:l.stripOBSUrl(d.title)),await((c=this.plugin.cacheOperation)==null?void 0:c.updateTaskToCache(d))}else{const d="Task: "+f+"from file: "+e+"not found.";throw new Error(d)}}}catch(f){y.error("An error occurred in updateTaskDescription:",f)}}async forceUpdates(e){var r,a,o,l,c,f,p;let t;if(e){if(t=this.app.vault.getAbstractFileByPath(e),t&&t instanceof F.TFolder)return!1;if(!t)return y.error(`File: ${e} not found. Removing from Meta Data`),await((r=this.plugin.cacheOperation)==null?void 0:r.deleteFilepathFromMetadata(e)),!1}else throw new Error("No file path provided");const i=new $t(this.app,this.plugin,t);await i.init();const n=i.getFileLines().split(`
`);for(let d=0;d<n.length;d++){const u=n[d];if((a=this.plugin.taskParser)!=null&&a.hasTickTickId(u)&&((o=this.plugin.taskParser)!=null&&o.hasTickTickTag(u))){const g=this.plugin.taskParser.getTickTickId(u),h=this.plugin.cacheOperation.loadTaskFromCacheID(g);if(g&&h){h.modifiedTime=(l=this.plugin.dateMan)==null?void 0:l.formatDateToISO(new Date);const m=i.getTaskRecord(g),v=await((c=this.plugin.taskParser)==null?void 0:c.convertLineToTask(u,0,i.getFilePath(),i,m)),b={...h,...v};Object.assign(v,b);const w=await((f=this.plugin.tickTickRestAPI)==null?void 0:f.UpdateTask(v));await((p=this.plugin.cacheOperation)==null?void 0:p.updateTaskToCache(w,null))}}}}async checkForMoves(e,t){let i=!1;const n=this.plugin.cacheOperation.getFilepathForTask(e);return n&&n!==t&&(i=!0),{projectMoved:i,oldFilePath:n}}async updateTaskLine(e,t,i,n,r,a){var f;let o={...e};o.items=[];const l=this.plugin.taskParser.getNumTabs(t);let c=await((f=this.plugin.taskParser)==null?void 0:f.convertTaskToLine(o,l));if(i&&n){const p={line:n.line,ch:0},d={line:n.line,ch:t.length};return i==null||i.replaceRange(c,p,d),c}else try{a.modifyTask(c,r);const p=this.app.vault.getAbstractFileByPath(a.getFilePath());await this.app.vault.modify(p,a.getFileLines())}catch(p){y.error(p)}}async confirmDeletion(e,t){var a;const i=await((a=this.plugin.cacheOperation)==null?void 0:a.getTaskTitles(e));return await new Ro(this.app,i,t,o=>{this.ret=o}).showModal()}async handleTaskItem(e,t,i){var d,u,g,h,m;let n=!1,r=!1;if(!((d=this.plugin.taskParser)!=null&&d.isMarkdownTask(e)))return!1;let a;const o=this.plugin.taskParser.getLineItemId(e);if(o?a=t.getTaskItemRecord(o):i&&(a=t.getTaskItemRecordByLine(i)),!a)return y.warn("Item not found in file map: ",e),!1;if(!a.parentId||a.parentId===""||a.parentId.length<1)return!1;const l=a.parentId,c=a.ID,f=(u=this.plugin.taskParser)==null?void 0:u.taskFromLine(e),p=(g=this.plugin.cacheOperation)==null?void 0:g.loadTaskFromCacheID(l);if(p&&p.items)if(c){const v=p.items.find(b=>b.id==c);v?v.title.trim()!=f.description.trim()&&(v.title=f==null?void 0:f.description.trim(),v.status=f!=null&&f.status?2:0,n=!0):(y.warn("",f,"not found in parent items. Forcibly adding..."),p.items.push({id:c,title:f==null?void 0:f.description,status:f!=null&&f.status?2:0}))}else{const b=os().toHexString();p.items.push({id:b,title:f==null?void 0:f.description,status:f!=null&&f.status?2:0});const w=`${e} %%${b}%%`;try{const k=this.app.workspace.getActiveViewOfType(F.MarkdownView),T=(h=k==null?void 0:k.app.workspace.activeEditor)==null?void 0:h.editor,I={line:i,ch:0},E={line:i,ch:w.length};T==null||T.setLine(i,w)}catch(k){y.error(`Error updating item: ${k}`)}r=!0}else O().debugMode;if((n||r)&&p){const v=t.getFilePath();n=await this.updateTask(p,v),n&&await((m=this.plugin.cacheOperation)==null?void 0:m.updateTaskToCache(p,v))}return n}async updateTask(e,t){var r,a,o,l;if(e.modifiedTime=(r=this.plugin.dateMan)==null?void 0:r.formatDateToISO(new Date),await((a=this.plugin.cacheOperation)==null?void 0:a.updateTaskToCache(e)),O().fileLinksInTickTick!=="noLink"){let c=(o=this.plugin.taskParser)==null?void 0:o.getObsidianUrlFromFilepath(t);O().fileLinksInTickTick==="taskLink"&&c&&(e.title=e.title+" "+c)}const n=!await((l=this.plugin.tickTickRestAPI)==null?void 0:l.UpdateTask(e));return new F.Notice(`Task ${e.title} modified.`),!n}findTaskOrItemByLineNumber(e,t){for(let i of e)if(t>=i.startLine&&t<=i.endLine)return i;return null}}class Uu extends F.Modal{constructor(e,t,i,n){super(e),this.title="Duplicate Projects/Lists found",this.cancelLabel="Cancel",this.confirmLabel="Abort Sync",this.projects=[],this.plugin=t,this.projects=i,this.message=`The following duplicate Projects/Lists were found. On ${O().baseURL},please either choose one of those to contain the tasks from both lists, or rename one of the lists.`,this.onSubmit=n}onOpen(){const{titleEl:e,contentEl:t}=this;e.setText(this.title),t.createEl("p",{text:`${this.message}`});const i=t.createEl("table","projects-table"),r=i.createEl("thead").createEl("tr"),a=r.createEl("th"),o=r.createEl("th");a.setText("Project Name"),o.setText("Project ID");const l=i.createEl("tbody");this.projects.forEach(c=>{const f=l.createEl("tr"),p=f.createEl("td","project-table-border"),d=f.createEl("td","project-table-border");p.setText(c.name),d.setText(c.id)}),new F.Setting(t).addButton(c=>{c.setClass("ts_button"),c.setWarning(),c.setButtonText(this.confirmLabel),c.onClick(()=>{this.result=!0,this.onSubmit(this.result),this.close()})})}onClose(){this.titleEl.empty(),this.contentEl.empty(),super.onClose(),this.resolvePromise(this.result)}showModal(){return this.open(),new Promise(e=>this.resolvePromise=e)}}const qu="[TickTickSync]",Hu=y.methodFactory,Ku={toString(){return`[${window.moment().format("YYYY-MM-DD-HH:mm:ss")}]`}};y.methodFactory=function(s,e,t){const i=s;return Hu(s,e,t).bind(console,`${qu}[${i}]%s:`,Ku)};y.rebuild();const Qn=".md";class Bo{constructor(e,t){this.app=e,this.plugin=t}async addTaskToMetadata(e,t){const i=await this.getFileMetadata(e,t.projectId);if(!i)return;const n={taskId:t.id,taskItems:[]};t.items&&t.items.length>0&&t.items.forEach(r=>{n.taskItems.push(r.id)}),i.TickTickTasks.push(n),i.TickTickCount=i.TickTickTasks.length}async addTaskItemToMetadata(e,t,i,n){const r=await this.getFileMetadata(e,n),a=r.TickTickTasks.find(o=>o.taskId===t);a==null||a.taskItems.push(i),r.TickTickCount=r.TickTickTasks.length}async removeTaskItem(e,t,i){if(!e)return;if(e.TickTickTasks.findIndex(r=>r.taskId===t)!==-1){const r=this.loadTaskFromCacheID(t);if(!r||!r.items)return;let a=r.items;return i.forEach(o=>{a=a.filter(l=>l.id!==o)}),r.items=a,await this.updateTaskToCache(r)}else y.warn(`Task '${t}' not found in metadata`)}async getFileMetadata(e,t){const i=O().fileMetadata[e];return i||await this.newEmptyFileMetadata(e,t)}getFileMetadatas(){return O().fileMetadata??null}async updateFileMetadata(e,t){const i=O().fileMetadata;i[e]||(i[e]={}),i[e].TickTickTasks=t.TickTickTasks,i[e].TickTickCount=t.TickTickCount,i[e].defaultProjectId=t.defaultProjectId,Ee({fileMetadata:i}),await this.plugin.saveSettings()}async deleteTaskIdFromMetadata(e,t){const i=await this.getFileMetadata(e),r=i.TickTickTasks.filter(o=>o.taskId!==t),a=r.length;i.TickTickTasks=r,i.TickTickCount=a,await this.updateFileMetadata(e,i)}async updateTaskMetadata(e,t){await this.deleteTaskIdFromMetadataByTaskId(e.id),await this.addTaskToMetadata(t,e)}async deleteTaskIdFromMetadataByTaskId(e){const t=this.getFileMetadatas();for(const i in t){const n=t[i].TickTickTasks;if(n&&n.find(r=>r.taskId===e)){await this.deleteTaskIdFromMetadata(i,e);break}}}async deleteFilepathFromMetadata(e){const t=O().fileMetadata,i={};for(const n in t)n!==e&&(i[n]=t[n]);return Ee({fileMetadata:i}),await this.plugin.saveSettings(),O().fileMetadata}checkForDuplicates(e){var n;if(!e)return;const t={},i={};for(const r in e)(n=e[r].TickTickTasks)==null||n.forEach(a=>{if(!t.hasOwnProperty(a.taskId)){t[a.taskId]=r;return}i.hasOwnProperty(a.taskId)||(i[a.taskId]=[]),i[a.taskId].push(r)});return{taskIds:t,duplicates:i}}async checkFileMetadata(){var t,i;const e=this.getFileMetadatas();for(const n in e){const r=e[n],a=this.app.vault.getAbstractFileByPath(n);if(!a&&(((t=r.TickTickTasks)==null?void 0:t.length)===0||!r.TickTickTasks)){y.error(`${n} does not exist and metadata is empty.`),await this.deleteFilepathFromMetadata(n);continue}if(!(((i=r.TickTickTasks)==null?void 0:i.length)===0||!r.TickTickTasks)&&!a){const o=r.TickTickTasks[0],l=await this.plugin.fileOperation.searchFilepathsByTaskidInVault(o.taskId);await this.updateRenamedFilePath(n,l),await this.plugin.saveSettings()}}return Object.keys(e).length}async getDefaultProjectNameForFilepath(e){const t=O().fileMetadata;if(!t[e]||t[e].defaultProjectId===void 0)return O().defaultProjectName;const i=t[e].defaultProjectId;return await this.getProjectNameByIdFromCache(i)}async getDefaultProjectIdForFilepath(e){const t=O().fileMetadata;if(!t[e]||!t[e].defaultProjectId){let i=O().defaultProjectId;return i||(i=O().inboxID),i}else{let i=t[e].defaultProjectId;return i||(i=O().inboxID),i}}filepathHasDefaultProjectID(e){const t=O().fileMetadata;return!!(!t[e]||t[e].defaultProjectId)}async getFilepathForProjectId(e){if(e||e!==""){const t=O().fileMetadata;for(const n in t)if(t[n].defaultProjectId===e)return n;const i=await this.getProjectNameByIdFromCache(e);if(i)return It()+"/"+i+Qn;{const n=`File path not found for ${e}, returning ${i} instead.`;throw y.warn(n),new Error(n)}}else return O().defaultProjectName?It()+"/"+O().defaultProjectName+Qn:It()+"/Inbox"+Qn}async setDefaultProjectIdForFilepath(e,t){const i=await this.getFileMetadata(e,t);i.defaultProjectId=t,(!i.TickTickTasks||!i.TickTickCount)&&(i.TickTickTasks=[],i.TickTickCount=0),await this.updateFileMetadata(e,i)}async loadTasksFromCache(){try{return ft()}catch(e){return y.error(`Error loading tasks from Cache: ${e}`),[]}}async saveTasksToCache(e){try{oi(e)}catch(t){return y.error(`Error saving tasks to Cache: ${t}`),!1}}async appendTaskToCache(e,t){try{if(e===null)return;const i=ft();e.title=this.plugin.taskParser.stripOBSUrl(e.title),i.push(e),oi(i),await this.addTaskToMetadata(t,e),await this.plugin.saveSettings()}catch(i){y.error(`Error appending task to Cache: ${i}`)}}loadTaskFromCacheID(e){if(e)try{return ft().find(i=>i.id===e)}catch(t){y.error("Error finding task from Cache:",t)}}async getTaskTitles(e){let i=ft().filter(n=>e.includes(n.id)).map(n=>n.title);return i=i.map(n=>this.plugin.taskParser.stripOBSUrl(n)),i}async updateTaskToCache(e,t=null){try{let i="";if(t)i=t;else if(i=this.getFilepathForTask(e.id),i||(i=await this.getFilepathForProjectId(e.projectId)),!i)throw new Error(`File not found for ${e.id} - ${e.title}`);return await this.deleteTaskFromCache(e.id),await this.appendTaskToCache(e,i),e}catch(i){return y.error(`Error updating task to Cache: ${i}`),[]}}getFilepathForTask(e){const t=this.getFileMetadatas();for(const i in t){const n=t[i];if(n.TickTickTasks&&n.TickTickTasks.find(r=>r.taskId===e))return i}return null}async getProjectIdForTask(e){const t=ft(),i=t.findIndex(n=>n.id===e);if(i!==-1)return t[i].projectId}async reopenTaskToCacheByID(e){let t=null;try{const i=ft(),n=i.findIndex(r=>r.id===e);return n>-1&&(i[n].status=0,t=i[n].projectId),oi(i),t}catch(i){throw y.error(`Error open task to Cache file: ${i}`),i}}async closeTaskToCacheByID(e){let t=null;try{const i=ft(),n=i.findIndex(r=>r.id===e);return n>-1&&(i[n].status=2,t=i[n].projectId),oi(i),t}catch(i){throw y.error(`Error close task to Cache file: ${i}`),i}}async deleteTaskFromCache(e){try{const i=ft().filter(n=>n.id!==e);oi(i),await this.deleteTaskIdFromMetadataByTaskId(e)}catch(t){y.error(`Error deleting task from Cache file: ${t}`)}}async deleteTaskFromCacheByIDs(e){try{const i=ft().filter(n=>!e.includes(n.id));oi(i),e.forEach(async n=>{await this.deleteTaskIdFromMetadataByTaskId(n)})}catch(t){y.error(`Error deleting task from Cache : ${t}`)}}async getProjectIdByNameFromCache(e){try{const i=pi().find(r=>r.name.toLowerCase()===e.toLowerCase());return i?i.id:null}catch(t){return y.error(`Error finding project from Cache file: ${t}`),!1}}async getProjectNameByIdFromCache(e){try{const i=pi().find(n=>n.id===e);return i?i.name:void 0}catch(t){y.error(`Error finding project from Cache file: ${t}`)}}async saveProjectsToCache(e){try{const t={id:O().inboxID,name:O().inboxName};e.push(t);const n=e.reduce((r,a,o,l)=>(l.findIndex(f=>f.name===a.name&&f.id!==a.id)!==-1&&!r.includes(a)&&r.push(a),r),[]).sort((r,a)=>r.name.localeCompare(a.name));if(n.length>0){const r=n.map(a=>`${a.id} ${a.name}`);return y.debug("Found duplicate lists: ",r),await this.showFoundDuplicatesModal(this.app,this.plugin,n),!1}for(const r of e)await this.checkProjectRename(r.id,r.name);return $o(e),await this.plugin.saveSettings(),!0}catch(t){y.error("Error on save projects: ",t),new F.Notice(`error on save projects: ${t}`)}return!1}async updateRenamedFilePath(e,t){try{const n=(await this.loadTasksFromCache()).map(a=>a.path===e?{...a,path:t}:a);await this.saveTasksToCache(n);const r=O().fileMetadata;r[t]=r[e],delete r[e],Ee({fileMetadata:r})}catch(i){y.error(`Error updating renamed file path to cache: ${i}`)}}findTaskInMetada(e,t){const i=O().fileMetadata;for(const n in i){if(y.debug("in file: :",n),n==t){y.debug("breaking");continue}const r=i[n].TickTickTasks;for(const a of r)if(a.taskId===e)return y.debug("found"),!0}return y.debug("not found"),!1}async newEmptyFileMetadata(e,t){if(e instanceof F.TAbstractFile&&e instanceof F.TFile&&(e=e.name),!e){y.error("Attempt to create undefined FileMetaData Entry: ",e);return}if(this.app.vault.getAbstractFileByPath(e)instanceof F.TFolder){y.error("Not adding ",e," to Metadata because it's a folder.");return}const n=O().fileMetadata;return n[e]?n[e]:(n[e]={TickTickTasks:[],TickTickCount:0,defaultProjectId:t},Ee({fileMetadata:n}),await this.plugin.saveSettings(),O().fileMetadata[e])}async findInFile(e,t){const n=(await this.app.vault.cachedRead(e)).split(`
`);return t.map(a=>a.position.start.line).map(a=>n[a]).map(a=>this.plugin.taskParser.getTickTickId(a)).filter(a=>a!==null)}async showFoundDuplicatesModal(e,t,i){return await new Uu(e,t,i,r=>{}).showModal()}async checkProjectRename(e,t){const i=this.getFileMetadatas();if(!i)return;const n=pi();if(!n||Object.keys(n).length==0)return;const r=n.find(a=>a.id===e);if(r&&(r==null?void 0:r.name)!==t){y.debug(`Project Name Changed from ${r==null?void 0:r.name} to ${t}`);const a=await this.getFilepathForProjectId(e),o=`${It()}/${t}.md`;if(y.debug(`Checking project rename for ${t}, which could be ${o}`),a!==o){y.debug(`Current project path is ${a}, which is not ${o}`);const l=this.app.vault.getAbstractFileByPath(a);l&&l instanceof F.TFile&&(y.debug(`Renaming ${a} to ${o}`),await this.app.vault.rename(l,o),y.debug(`Updating metadata key for ${a} to ${o}  === \\n ${i[a]}`),await this.updateFileMetadata(o,i[a]),y.debug(`Deleting ${a} from metadata`),await this.deleteFilepathFromMetadata(a))}}}}class Uo{constructor(e,t){this.app=e,this.plugin=t}async completeTaskInTheFile(e){var o,l,c;await((o=this.plugin.cacheOperation)==null?void 0:o.loadTaskFromCacheID(e));const t=(l=this.plugin.cacheOperation)==null?void 0:l.getFilepathForTask(e),i=this.app.vault.getAbstractFileByPath(t),r=(await this.app.vault.read(i)).split(`
`);let a=!1;for(let f=0;f<r.length;f++){const p=r[f];if(p.includes(e)&&((c=this.plugin.taskParser)!=null&&c.hasTickTickTag(p))){r[f]=p.replace("[ ]","[x]"),a=!0;break}}if(a){const f=r.join(`
`);await this.app.vault.modify(i,f)}}async uncompleteTaskInTheFile(e){var o,l,c;await((o=this.plugin.cacheOperation)==null?void 0:o.loadTaskFromCacheID(e));const t=(l=this.plugin.cacheOperation)==null?void 0:l.getFilepathForTask(e),i=this.app.vault.getAbstractFileByPath(t),r=(await this.app.vault.read(i)).split(`
`);let a=!1;for(let f=0;f<r.length;f++){const p=r[f];if(p.includes(e)&&((c=this.plugin.taskParser)!=null&&c.hasTickTickTag(p))){r[f]=p.replace(/- \[(x|X)\]/g,"- [ ]"),a=!0;break}}if(a){const f=r.join(`
`);await this.app.vault.modify(i,f)}}async addTickTickTagToFile(e){if(e.markAllTasks()){const t=e.getFileLines();await this.app.vault.modify(e.file,t),new F.Notice("New Tasks will be added to TickTick on next Sync.")}}async addTickTickLinkToFile(e){var a,o,l,c,f,p;const t=this.app.vault.getAbstractFileByPath(e);if(t&&t instanceof F.TFolder)return;const n=(await this.app.vault.read(t)).split(`
`);let r=!1;for(let d=0;d<n.length;d++){const u=n[d];if((a=this.plugin.taskParser)!=null&&a.hasTickTickId(u)&&((o=this.plugin.taskParser)!=null&&o.hasTickTickTag(u))){if((l=this.plugin.taskParser)!=null&&l.hasTickTickLink(u))return;const g=(c=this.plugin.taskParser)==null?void 0:c.getTickTickId(u),h=await((f=this.plugin.cacheOperation)==null?void 0:f.loadTaskFromCacheID(g)),m=(p=this.plugin.taskParser)==null?void 0:p.addTickTickLink(u,h.id,h.projectId);n[d]=m,r=!0}else continue}if(r){const d=n.join(`
`);await this.app.vault.modify(t,d)}}async synchronizeToVault(e,t){var n,r;if(!e)return y.error("No tasks to add."),!1;e.sort((a,o)=>a.projectId.localeCompare(o.projectId)||a.id.localeCompare(o.id));const i=[...new Set(e.map(a=>a.projectId))];for(const a of i){let o,l=null,c=e.filter(d=>d.projectId===a);const f=[],p=await((n=this.plugin.cacheOperation)==null?void 0:n.getFilepathForProjectId(O().defaultProjectId));for(const d of c)d.parentId&&d.parentId.length>0?l=this.plugin.cacheOperation.getFilepathForTask(d.parentId):l=this.plugin.cacheOperation.getFilepathForTask(d.id),y.debug("taskFile",l),l?(y.debug("adding to ",l),this.addTaskToTFF(f,l,d)):(l=await((r=this.plugin.cacheOperation)==null?void 0:r.getFilepathForProjectId(d.projectId)),l?(y.debug("adding to ",l),this.addTaskToTFF(f,l,d)):(y.debug("adding to ",p),this.addTaskToTFF(f,p,d)));for(const{file:d,tasks:u}of f)this.doTheSortMambo(u),o=await this.synchronizeToFile(d,u,t);if(o&&await new Promise(d=>setTimeout(d,1e3)),O().debugMode){let d="";t?d="updating":d="adding",y.debug("===",l,c,o?"Completed "+d+" task(s).":" Failed "+d+" task(s).")}}return!0}async getOrCreateDefaultFile(e){let t;try{let i=It();(!i||i==="")&&(i="/");let n=this.app.vault.getAbstractFileByPath(i);n instanceof F.TFolder||(y.warn(`Folder ${i} does not exit. It will be created`),n=await this.app.vault.createFolder(i)),new F.Notice(`Creating new file: ${e}`),y.warn(`Creating new file: ${e}`);const r=`${this.plugin.manifest.name} -- ${this.plugin.manifest.version}`;try{t=await this.app.vault.create(e,`== Added by ${r} == `)}catch(a){if(a.message.includes("File already exists")){if(y.info("Attempting to find existing file",e),t=this.app.vault.getAbstractFileByPath(e),!t){const o=e.split("/").pop();if(o){const l=this.app.vault.getMarkdownFiles();for(const c of l)if(y.debug("Checking file",c.path),c.path.toLowerCase()===o.toLowerCase()){y.debug("Found existing file",c.path),t=c;break}}}}else throw a}return t}catch(i){throw y.error("Error on create file: ",i),new Error(i)}}async checkForDuplicates(e,t){let i={},n={};if(!e)return;let r;try{for(const a in e){r=a;const o=this.app.vault.getAbstractFileByPath(a);if(!o){y.debug("Duplicate check Skipping ",a," because it's not found.");continue}if(o&&o instanceof F.TFolder){y.debug("Duplicate check Skipping ",a," because it's a folder.");continue}try{const l=await this.app.vault.read(o);for(let c in t)l.includes(c)&&(i[c]?(n[c]||(n[c]=[i[c]]),n[c].push(a)):i[c]=a)}catch{y.error("Duplicate check Skipping ",a," because it's not readable.");continue}}return n}catch(a){const o=`File [${r}] not found, or is locked. If file exists, Please try again later.`;throw y.error(a,o),new Error(o)}}async deleteTaskFromSpecificFile(e,t,i){if(i&&!await this.confirmDeletion(t.title+"in File: "+e))return new F.Notice("Tasks will not be deleted. Please rectify the issue before the next sync.",5e3),[];y.info("Task being deleted from file: ",t.id,e);const n=new $t(this.app,this.plugin,e);await n.init(),n.deleteTask(t.id);const r=n.getFileLines();await this.app.vault.modify(e,r),this.plugin.lastLines.set(e.path,r.length)}async deleteTaskFromFile(e){var r;const t=e.id,i=(r=this.plugin.cacheOperation)==null?void 0:r.getFilepathForTask(t),n=this.app.vault.getAbstractFileByPath(i);if(i)await this.deleteTaskFromSpecificFile(n,e,!1);else throw new Error(`File not found for ${e.title}. File path found is ${i}`)}async searchTickTickIdFromFilePath(e,t){const i=this.app.vault.getAbstractFileByPath(e),r=(await this.app.vault.read(i)).split(`
`);let a=null;for(let o=0;o<r.length;o++){const l=r[o];if(l.includes(t)){const c=/\[ticktick_id::\s*(\w+)\]/.exec(l);c&&(a=c[1]);break}}return a}async getAllFilesInTheVault(){return this.app.vault.getFiles()}async searchFilepathsByTaskidInVault(e){const i=(await this.getAllFilesInTheVault()).map(async a=>{if(!this.isMarkdownFile(a.path))return;if((await this.app.vault.cachedRead(a)).includes(e))return a.path});return(await Promise.all(i)).filter(a=>a!==void 0)[0]||null}isMarkdownFile(e){let t=e.split(".").pop();return t=t.toLowerCase(),t==="md"}async synchronizeToFile(e,t,i){let n,r;return e&&(n=this.app.vault.getAbstractFileByPath(e),n instanceof F.TFile||(n=await this.getOrCreateDefaultFile(e),y.debug("Creating new file: ",n.path))),t=this.doTheSortMambo(t),r=await this.syncTasks(n,t,i),r}async syncTasks(e,t,i){try{const n=await this.persistToFile(t,e,i);return await this.app.vault.process(e,r=>(r=n,r)),!0}catch(n){return y.error(`Could not ${i?"update":"add"} Tasks to file ${e.path} 
 Error: ${n}`),!1}}async persistToFile(e,t,i){var l,c,f,p,d,u,g,h,m,v,b,w,k,T,I;y.debug("Processing File: ",t.path);const n=new $t(this.app,this.plugin,t);await n.init();let r=!1;const a=[];for(const E of e){let S=0;const L=E.parentId;L&&(S=n.getNumParentTabs(L)+1);let A="",_="";if(i){const D=(f=this.plugin.cacheOperation)==null?void 0:f.loadTaskFromCacheID(E.id);if((p=this.plugin.dateMan)==null||p.addDateHolderToTask(E,D),A=await((d=this.plugin.taskParser)==null?void 0:d.convertTaskToLine(E,S)),D)if((u=this.plugin.taskParser)!=null&&u.isProjectIdChanged(D,E))y.debug("Moving Task: ",E.id,E.title," from Project: ",D.projectId," to Project: ",E.projectId),_=await this.handleTickTickStructureMove(E,D,A,n),r=!0;else{const R=(g=this.plugin.taskParser)==null?void 0:g.isParentIdChanged(D,E);n.updateTask(E,A,R)}else y.warn("No Old Task found for: ",E.id)}else if(A=await((l=this.plugin.taskParser)==null?void 0:l.convertTaskToLine(E,S)),n.getTaskIndex(E.id)!=-1){y.warn("A Task was being added but was already in file: ",E.id,E.title),n.updateTask(E,A),await((c=this.plugin.cacheOperation)==null?void 0:c.updateTaskToCache(E,t.path)),a.push(E.id);continue}else n.addTask(E,A);let C=(h=this.plugin.taskParser)==null?void 0:h.getAllTagsFromLineText(A);if(C&&(E.tags=C),O().fileLinksInTickTick!=="noLink"){let D="";r?D=(v=this.plugin.taskParser)==null?void 0:v.getObsidianUrlFromFilepath(_):D=(m=this.plugin.taskParser)==null?void 0:m.getObsidianUrlFromFilepath(t.path),D&&(E.title=E.title+" "+D)}if(i)if(!r)await((k=this.plugin.cacheOperation)==null?void 0:k.updateTaskToCache(E,t.path));else{let D=await((T=this.plugin.tickTickRestAPI)==null?void 0:T.UpdateTask(E));await((I=this.plugin.cacheOperation)==null?void 0:I.updateTaskToCache(D,_))}else{let D=await((b=this.plugin.tickTickRestAPI)==null?void 0:b.UpdateTask(E));await((w=this.plugin.cacheOperation)==null?void 0:w.appendTaskToCache(D,t.path))}}const o=n.getFileLines();return this.plugin.lastLines.set(t.path,o.length),o}hasChildren(e){var t;return e.childIds?((t=e.childIds)==null?void 0:t.length)>0:!1}async confirmDeletion(e){const t=[];t.push(e);const i="task not found in local cache.";return await new Ro(this.app,t,i,a=>{this.ret=a}).showModal()}async handleTickTickStructureMove(e,t,i,n){var p,d,u,g,h,m,v;y.debug("deleting old task: ",t.id,t.title," from file");let r=await((p=this.plugin.cacheOperation)==null?void 0:p.getFilepathForProjectId(e.projectId));if(!r){let b=`File not found for moved newTask:  ${e.id}, ${e.title}`;throw new Error(b)}const a=await this.plugin.fileOperation.getOrCreateDefaultFile(r);if(!a||!(a instanceof F.TFile)){let b=`File not found for moved newTask:  ${e.id}, ${e.title}, ${r}`;throw new Error(b)}if(y.debug("oldFilePath: ",n.getFilePath()),!n||!n.getFilePath()){let b=`File not found for moved newTask:  ${e.id}, ${e.title}`;throw new Error(b)}n.deleteTask(t.id),y.debug("deleted from: ",n.getFilePath()),await((d=this.plugin.cacheOperation)==null?void 0:d.deleteTaskFromCache(t.id));const o=new $t(this.app,this.plugin,a);await o.init(),y.debug("Adding Task: ",e.id,e.title," to new file: ",o.getFilePath()),o.addTask(e,i);const l=o.getFileLines();await this.app.vault.process(a,b=>(b=l,b));const c=(u=this.plugin.taskParser)==null?void 0:u.stripOBSUrl(e.title);let f="";if(e.projectId!=t.projectId){const b=await((g=this.plugin.cacheOperation)==null?void 0:g.getProjectNameByIdFromCache(e.projectId)),w=await((h=this.plugin.cacheOperation)==null?void 0:h.getProjectNameByIdFromCache(t.projectId));f=`Task Moved.
Task: `+c+`
was moved from
 `+w+`
to
`+b}else if(e.parentId){const b=await((m=this.plugin.cacheOperation)==null?void 0:m.loadTaskFromCacheID(e.parentId)),w=(v=this.plugin.taskParser)==null?void 0:v.stripOBSUrl(b.title);f=`Task has new Parent.
Task: `+c+`
is now a child of
 `+w}else f=`Task is now a top level task.
Task: `+c;return new F.Notice(f,5e3),r}async deleteTaskFromOldFile(e,t,i){var r;const n=(r=this.plugin.cacheOperation)==null?void 0:r.getFilepathForTask(e.id);if(y.debug("oldFilePath: ",n),!n){let a=`File not found for moved newTask:  ${t.id}, ${t.title}`;throw new Error(a)}return i.deleteTask(e.id),y.debug("deleted from: ",i.getFilePath()),n}async moveChildTasks(e,t,i){var n,r,a;for(const o of e.childIds){if(t.includes(o))continue;const l=await((n=this.plugin.cacheOperation)==null?void 0:n.loadTaskFromCacheID(o));if(l){l.parentId=e.id,l.projectId=e.projectId;const c=(r=l.items)==null?void 0:r.length;if(await this.moveTask(i,l,c,l.id,l.projectId),this.hasChildren(l)){const p=await((a=this.plugin.cacheOperation)==null?void 0:a.loadTaskFromCacheID(o));await this.moveChildTasks(p,t,i)}}else y.warn("Child not found: ",o)}}async moveTask(e,t,i,n,r){var c,f,p,d,u,g;const a=this.app.vault.getAbstractFileByPath(e);await this.deleteTaskFromSpecificFile(a,t,!1),await((c=this.plugin.cacheOperation)==null?void 0:c.deleteTaskFromCache(n)),await this.synchronizeToVault([t]);const o=(f=this.plugin.taskParser)==null?void 0:f.stripOBSUrl(t.title);let l="";if(t.projectId!=r){const h=await((p=this.plugin.cacheOperation)==null?void 0:p.getProjectNameByIdFromCache(t.projectId)),m=await((d=this.plugin.cacheOperation)==null?void 0:d.getProjectNameByIdFromCache(r));l=`Task Moved.
Task: `+o+`
was moved from
 `+m+`
to
`+h}else if(t.parentId){const h=await((u=this.plugin.cacheOperation)==null?void 0:u.loadTaskFromCacheID(t.parentId)),m=(g=this.plugin.taskParser)==null?void 0:g.stripOBSUrl(h.title);l=`Task has new Parent.
Task: `+o+`
is now a child of
 `+m}else l=`Task is now a top level task.
Task: `+o;new F.Notice(l,5e3)}compareTasks(e,t){return!e.parentId&&t.parentId?-1:e.parentId&&!t.parentId?1:e.parentId&&t.parentId?t.parentId.localeCompare(e.parentId):e.sortOrder-t.sortOrder}getParent(e,t){return t.find(i=>i.id===e)}sortChildrenfirst(e){const t=[],i=new Map;e.forEach(r=>i.set(r.id,r));const n=r=>{t.includes(r)||(r.childIds&&r.childIds.forEach(a=>{const o=i.get(a);o&&n(o)}),t.push(r))};return e.forEach(r=>{n(r)}),t}sortTasks(e){const t=new Map;e.forEach(r=>t.set(r.id,{...r,children:[]}));let i=[];e.forEach(r=>{r.parentId&&t.has(r.parentId)?t.get(r.parentId).children.push(t.get(r.id)):i.push(t.get(r.id))});function n(r,a=[]){for(const o of r)a.push(o),o.children.length&&n(o.children,a);return a}return n(i).map(({children:r,...a})=>a)}doTheSortMambo(e){const t=JSON.parse(JSON.stringify(e)),i=this.sortTasksByLevel(t);return i.map(n=>`${"  ".repeat(n.level-1)}${n.title} (Level: ${n.level})`).join(`
`),i}sortTasksByLevel(e){const t={};e.forEach(n=>{t[n.id]={...n,level:0}}),e.forEach(n=>{if(!("parentId"in n)||!n.parentId)t[n.id].level=1;else{let r=n.id,a=1;for(;t[r]&&"parentId"in t[r]&&t[r].parentId;){if(a++,a>6)throw y.debug("this is the issue: ",r," ",t[r].parentId,""),new F.Notice("A circular Parent-Child dependency was found. Please fix in TickTick by checking parent-child relationships."),new Error("Circular Parent-Child dependency was found.");r=t[r].parentId}t[n.id].level=a}});const i=Object.values(t);return i.sort((n,r)=>n.level!==r.level?n.level-r.level:n.sortOrder-r.sortOrder),i}addTaskToTFF(e,t,i){let n=e.find(r=>r.file===t);n||(n={file:t,tasks:[]},e.push(n)),n.tasks.push(i)}}const ct="LOCK_TASKS";class Vu{constructor(e){this.initialized=!1,this.plugin=e}initialize(){try{const e=O().token;return e?(O().inboxID.length===0&&y.warn("Something is wrong with your inbox ID."),this.api=new pr({baseUrl:O().baseURL,token:e,checkPoint:O().checkPoint}),this.cacheOperation=new Bo(this.plugin.app,this.plugin),this.fileOperation=new Uo(this.plugin.app,this.plugin),this.tickTickSync=new Bu(this.plugin.app,this.plugin),this.initialized=!0,!0):(y.debug("Please login from settings."),!1)}catch(e){y.error("Error on initialization: ",e)}return!1}backup(){var e;(e=this.tickTickSync)==null||e.backupTickTickAllResources()}async login(e,t,i){try{const n=new pr({username:t,password:i,baseUrl:e,token:"",checkPoint:0}),r=await n.login();let a;if(!r){a=n.lastError;const c="Login Failed. "+JSON.stringify(a.errorMessage,null,4);throw new F.Notice(c,5e3),y.error("Login Fail!: ",c),new Error(a.errorMessage)}const o=O().defaultProjectId,l=O().defaultProjectName;return(!o||o==""||l=="Inbox"&&o!=r.inboxId)&&Ee({defaultProjectId:r.inboxId}),Ee({checkPoint:0}),await this.plugin.saveSettings(),r}catch(n){y.error("Error on login: ",n)}return null}async synchronization(){try{if(await lt(ct,async()=>await this.syncTickTickToObsidian()))return;await this.syncFiles(!1)}catch(e){y.error("Error on synchronization: ",e)}}async saveProjectsToCache(){var t;const e=await((t=this.api)==null?void 0:t.getProjects());return e?this.cacheOperation.saveProjectsToCache(e):!1}async getProjects(){return pi()}async getTasks(e){return y.debug("getTasks",e),ft()}async deletedTaskCheck(e){return await lt(ct,async()=>{var t;return(t=this.tickTickSync)==null?void 0:t.deletedTaskCheck(e)})}async deletedFileCheck(e){var i;const t=await((i=this.cacheOperation)==null?void 0:i.getFileMetadata(e,null));return!t||!t.TickTickTasks?!1:(await lt(ct,async()=>{await this.tickTickSync.deletedTaskCheck(e),await this.cacheOperation.deleteFilepathFromMetadata(e)}),!0)}async renamedFileCheck(e,t){var n;const i=await((n=this.cacheOperation)==null?void 0:n.getFileMetadata(t,null));return!i||!i.TickTickTasks?!1:(await lt(ct,async()=>{await this.tickTickSync.updateTaskContent(e),await this.cacheOperation.updateRenamedFilePath(t,e)}),!0)}async fullTextNewTaskCheck(e){await lt(ct,async()=>{var t;await((t=this.tickTickSync)==null?void 0:t.fullTextNewTaskCheck(e))})}async lineNewContentTaskCheck(e,t){return await lt(ct,async()=>{var i;await((i=this.tickTickSync)==null?void 0:i.lineNewContentTaskCheck(e,t))})}async lineModifiedTaskCheck(e,t,i){return await lt(ct,async()=>{var a;const n=this.plugin.app.vault.getAbstractFileByPath(e),r=new $t(this.plugin.app,this.plugin,n);return await r.init(),(a=this.tickTickSync)==null?void 0:a.lineModifiedTaskCheck(e,t,i,r)})}async checkDataBase(){var n,r;const e=this.plugin.app.vault,t=await((n=this.plugin.cacheOperation)==null?void 0:n.checkFileMetadata());y.debug(`checking metadata for ${t} files`),(!t||t<1)&&(y.debug("File Metadata rebuild."),e.getMarkdownFiles().forEach(o=>{var l;(l=this.tickTickSync)==null||l.fullTextModifiedTaskCheck(o.path)})),await this.plugin.saveSettings();const i=await((r=this.cacheOperation)==null?void 0:r.getFileMetadatas());y.debug("checking deleted tasks"),await lt(ct,async()=>{var a,o,l,c,f,p,d,u;for(const g in i){const h=i[g];for(const m of h.TickTickTasks){let v;try{v=(a=this.plugin.cacheOperation)==null?void 0:a.loadTaskFromCacheID(m.taskId)}catch(b){y.error("An error occurred while loading task cache: ",b)}if(!v)try{v=await((o=this.plugin.tickTickRestAPI)==null?void 0:o.getTaskById(m.taskId)),v&&v.deleted===1&&await((l=this.plugin.cacheOperation)==null?void 0:l.deleteTaskIdFromMetadata(g,m.taskId))}catch(b){if(b.message.includes("404")){await((c=this.plugin.cacheOperation)==null?void 0:c.deleteTaskIdFromMetadata(g,m.taskId));continue}else{y.error("An error occurred while loading task from api: ",b);continue}}}}await this.plugin.saveSettings(),y.debug("checking renamed files -- This operation takes a while, please be patient.");try{for(const g in i){y.debug("Checking Renamed: ",g);const h=i[g],m=this.plugin.taskParser.getObsidianUrlFromFilepath(g);for(const v of h.TickTickTasks){let b;try{b=(f=this.plugin.cacheOperation)==null?void 0:f.loadTaskFromCacheID(v.taskId)}catch(k){y.warn(`An error occurred while loading task ${v.taskId} from cache:`,k)}if(!b){y.warn(`Task ${v.id}: ${v.title} is not found.`);continue}if(!((b==null?void 0:b.title)??"").includes(m))try{await((p=this.tickTickSync)==null?void 0:p.updateTaskContent(g))}catch(k){y.warn("An error occurred while updating task description:",k)}}}y.debug("Done File Rename check.");try{y.debug("checking unsynced tasks");const g=e.getFiles();for(const h of g)if(h.extension=="md")try{if(y.debug(`Scanning file ${h.path}`),O().taskLinksInObsidian==="taskLink"&&await((d=this.plugin.fileOperation)==null?void 0:d.addTickTickLinkToFile(h.path)),O().enableFullVaultSync){const m=new $t(this.plugin.app,this.plugin,h);await m.init(),await((u=this.plugin.fileOperation)==null?void 0:u.addTickTickTagToFile(m))}}catch(m){y.error(`An error occurred while check new tasks in the file: ${h.path}`,m)}}catch(g){y.error("An error occurred while checking for unsynced tasks.:",g);return}new F.Notice("All files have been scanned.")}catch(g){y.warn("An error occurred while scanning the vault.:",g)}}),y.debug("Done checking data.")}async closeTask(e){await this.tickTickSync.closeTask(e)}async openTask(e){await this.tickTickSync.reopenTask(e)}async syncTickTickToObsidian(){return this.tickTickSync.syncTickTickToObsidian()}async syncFiles(e){var n,r,a;const t=O().fileMetadata;if(!t){y.warn("No sync files found.");return}let i=t;O().SyncProject&&(i=Object.fromEntries(Object.entries(t).filter(([o,l])=>l.defaultProjectId===O().SyncProject)));try{const o=(n=this.cacheOperation)==null?void 0:n.checkForDuplicates(i);if(o!=null&&o.duplicates&&JSON.stringify(o.duplicates)!="{}"){let c="";for(const p in o.duplicates)c+="Task: "+p+`
in files: 
`,o.duplicates[p].forEach(d=>{c+=d+`
`});const f=`Found duplicates in MetaData.

${c}
Please fix manually. This causes unpredictable results
Please open an issue in the TickTickSync repository if you continue to see this issue.

To prevent data corruption. Sync is aborted.`;y.error("Metadata Duplicates: ",o.duplicates),new F.Notice(f,5e3);return}const l=await((r=this.fileOperation)==null?void 0:r.checkForDuplicates(t,o==null?void 0:o.taskIds));if(l&&JSON.stringify(l)!="{}"){let c="";for(let p in l)c+="Task: "+p+`
Found in Files: 
`,l[p].forEach(d=>{c+=d+`
`});const f=document.createDocumentFragment();f.appendChild(document.createTextNode("Found duplicates in Files.                                                             ")),f.appendChild(document.createElement("br")),f.appendChild(document.createTextNode(`${c}`)),f.appendChild(document.createElement("br")),f.appendChild(document.createTextNode("Please fix manually to avoid unpredictable results.")),f.appendChild(document.createElement("br")),f.appendChild(document.createElement("br")),f.appendChild(document.createTextNode("Please open an issue in the TickTickSync repository if you continue to see this issue.")),f.appendChild(document.createElement("br")),f.appendChild(document.createElement("br")),f.appendChild(document.createTextNode("Sync is aborted to prevent data corruption.")),new F.Notice(f,0),y.error("Duplicates in file: ",c);return}}catch(o){y.error(o),new F.Notice(`Duplicate check failed:  ${Error}`,5e3);return}y.debug("New Files: ",i);for(const o in i)if(!this.plugin.app.vault.getAbstractFileByPath(o)){y.debug("File ",o," was deleted before last sync."),await((a=this.cacheOperation)==null?void 0:a.deleteFilepathFromMetadata(o));const c=i.findIndex(o);i.splice(c,1)}for(const o in i)O().debugMode&&y.debug(o),e&&await lt(ct,async()=>{var l;try{await((l=this.tickTickSync)==null?void 0:l.forceUpdates(o))}catch(c){y.error("An error occurred in fullTextNewTaskCheck:",c)}}),await lt(ct,async()=>{var l;try{await((l=this.tickTickSync)==null?void 0:l.fullTextNewTaskCheck(o))}catch(c){y.error("An error occurred in fullTextNewTaskCheck:",c)}}),await lt(ct,async()=>{var l;try{await((l=this.tickTickSync)==null?void 0:l.fullTextModifiedTaskCheck(o))}catch(c){y.error("An error occurred in fullTextModifiedTaskCheck:",c)}}),await lt(ct,async()=>{var l;try{await((l=this.tickTickSync)==null?void 0:l.deletedTaskCheck(o))}catch(c){y.error("An error occurred in deletedTaskCheck:",c)}})}}class zu{constructor(e,t,i){if(this.app=e,this.plugin=t,this.token=O().token,this.baseURL=O().baseURL,!this.token||this.token==="")throw new F.Notice("Please login from Settings.",5e3),this.api=null,y.error("No Token"),new Error("API Not Initialized.");O().debugMode&&y.debug(JSON.stringify({baseUrl:this.baseURL,token:"["+this.token.substring(0,10)+"...] len: "+this.token.length})),i?this.api=i:(this.api=new pr({baseUrl:O().baseURL,token:this.token,checkPoint:O().checkPoint}),this.api.inboxProperties={id:O().inboxID,sortOrder:0})}async initializeAPI(){var t,i,n,r,a;if(this.api===null||this.api===void 0)throw new Error("API Not Initialized. Please restart Obsidian.");let e=O().token;if(!e)try{if(await((t=this.api)==null?void 0:t.getUserSettings())){e=!0,await((i=this.api)==null?void 0:i.getInboxProperties());let l=!1;O().inboxID!=((n=this.api)==null?void 0:n.inboxId)&&(l=!0),O().defaultProjectId||Ee({defaultProjectId:(r=this.api)==null?void 0:r.inboxId,defaultProjectName:"Inbox"}),l&&await this.plugin.saveSettings()}else y.error((a=this.api)==null?void 0:a.lastError);e?O().debugMode&&y.debug(`Logged In: ${e}`):(new F.Notice("Login failed, please login through settings."),y.error("Login failed! "))}catch(o){y.error("Login failed! ",o),new F.Notice(`Login failed: ${o}
Please login again`)}finally{await this.plugin.saveSettings()}}async AddTask(e){var t;await this.initializeAPI();try{return await((t=this.api)==null?void 0:t.addTask(e))}catch(i){throw new Error(`Error adding task: ${i.message}`)}}async deleteTask(e,t){var i;await this.initializeAPI();try{return await((i=this.api)==null?void 0:i.deleteTask(e,t))}catch(n){throw new Error(`Error deleting task: ${n.message}`)}}async getProjectSections(e){var t;await this.initializeAPI();try{return await((t=this.api)==null?void 0:t.getProjectSections(e))}catch(i){throw new Error(`Error getting Sections: ${i.message}`)}}async GetActiveTasks(){var e;await this.initializeAPI();try{return await((e=this.api)==null?void 0:e.getTasks())}catch(t){throw new Error(`Error get active tasks: ${t.message}`)}}async UpdateTask(e){var t,i,n;await this.initializeAPI();try{let r={};const a=e.dateHolder,o=await((t=this.api)==null?void 0:t.updateTask(e));if(!o){y.error("Error","Update Failed.",(i=this.api)==null?void 0:i.lastError,e);const l="Error updating task: "+((n=this.api)==null?void 0:n.lastError);throw new Error(l)}return JSON.stringify(o.id2error)==="{}"&&(r=await this.getTaskById(e.id,e.projectId),r?r.dateHolder=a:y.error("Didn't get back the updated Task")),r}catch(r){throw new Error(`Error updating task: ${r.message}`)}}async modifyTaskStatus(e,t,i){var n,r;await this.initializeAPI();try{let a=await((n=this.api)==null?void 0:n.getTask(e,t));return a?(a.status=i,await((r=this.api)==null?void 0:r.updateTask(a))):!1}catch(a){y.error("Error modifying task:",a);return}}async OpenTask(e,t){await this.initializeAPI();try{this.modifyTaskStatus(e,t,0)}catch(i){y.error("Error open a task:",i);return}}async CloseTask(e,t){await this.initializeAPI();try{return this.modifyTaskStatus(e,t,2)}catch(i){throw y.error("Error closing task:",i),i}}async getTaskById(e,t){var i;if(await this.initializeAPI(),!e)throw new Error("taskId is required");try{return await((i=this.api)==null?void 0:i.getTask(e,t))}catch(n){if(n.response&&n.response.status){const r=n.response.status;throw new Error(`Error retrieving task. Status code: ${r}`)}else throw new Error(`Error retrieving task: ${n.message}`)}}async getTaskDueById(e){var t;if(await this.initializeAPI(),!e)throw new Error("taskId is required");try{const i=await((t=this.api)==null?void 0:t.getTask(e,null));return(i==null?void 0:i.dueDate)??null}catch(i){throw new Error(`Error get Task Due By ID: ${i.message}`)}}async GetAllProjects(){var e;await this.initializeAPI();try{return await((e=this.api)==null?void 0:e.getProjects())??[]}catch(t){return y.error("Error get all projects",t),[]}}async GetProjectGroups(){var e,t,i,n;await this.initializeAPI();try{const r=await((e=this.api)==null?void 0:e.getProjectGroups());if((r==null?void 0:r.length)==0&&((t=this.api)!=null&&t.lastError)&&((i=this.api)==null?void 0:i.lastError.statusCode)!=200){let a=(n=this.api)==null?void 0:n.lastError;throw y.error("Error: ",a.operation,a.statusCode,a.errorMessage),new Error(a.errorMessage)}return r}catch(r){return y.error("Error get project groups",r),new F.Notice("Unable to get project groups: "+r,5e3),!1}}async getUserResources(){var e;await this.initializeAPI();try{return await((e=this.api)==null?void 0:e.getUserSettings())}catch(t){return y.error("Error get user resources",t),[]}}async getAllCompletedItems(){var e;await this.initializeAPI();try{return await((e=this.api)==null?void 0:e.getAllCompletedItems())}catch(t){return y.error("Error get all completed items",t),[]}}async getAllResources(){var e;if(await this.initializeAPI(),!this.api)return y.error("getAllResources No API."),null;try{const t=await this.api.getAllResources();if(!t||this.api.lastError&&this.api.lastError.statusCode!=200)throw new Error("getAllResources No Results.");return O().checkPoint!=t.checkPoint&&(this.api.checkpoint=t.checkPoint,O().checkPoint=(e=this.api)==null?void 0:e.checkpoint,await this.plugin.saveSettings()),t}catch(t){y.error("Error get all resources",t)}return null}async getAllTasks(){var e,t;await this.initializeAPI();try{const i=await((e=this.api)==null?void 0:e.getTaskDetails());if(!i||i.length===0&&((t=this.api)==null?void 0:t.lastError.statusCode)!=200)throw new Error("No Results.");return i}catch(i){return y.error("Error get all Tasks",i),[]}}async exportData(){var t,i;await this.initializeAPI();const e=await((t=this.api)==null?void 0:t.exportData());if(!e){let n=JSON.stringify((i=this.api)==null?void 0:i.lastError);throw n=n.replace(/{/g,`
`).replace(/,/g,`
`),new Error(`Back up failed ${n}`)}return e}async moveTaskProject(e,t,i){var r,a,o;await this.initializeAPI(),await((r=this.api)==null?void 0:r.projectMove(e.id,t,i))||y.error("Project Moved Failed: ",(a=this.api)==null?void 0:a.lastError),await((o=this.api)==null?void 0:o.updateTask(e))}async moveTaskParent(e,t,i,n){var r,a;if(t){const o=this.plugin.cacheOperation.loadTaskFromCacheID(t);o!=null&&o.childIds&&o.childIds.length>0&&(o.childIds=o.childIds.filter(l=>l!==e)),await((r=this.api)==null?void 0:r.updateTask(o))}await((a=this.api)==null?void 0:a.parentMove(e,i,n))}}const Gu=s=>{const e=new DataView(s);let t="";for(let i=0;i<e.byteLength;i+=4)t+=e.getUint32(i).toString(16).padStart(8,"0");return t},Wu=s=>async(e,{outputFormat:t="hex"}={})=>{typeof e=="string"&&(e=new globalThis.TextEncoder().encode(e));const i=await globalThis.crypto.subtle.digest(s,e);return t==="hex"?Gu(i):i},Yu=Wu("SHA-256"),is={Highest:"",High:"",Medium:"",Low:"",Lowest:""},ls={TickTick_TAG:"#ticktick"},Sa=[{ticktick:0,obsidian:null},{ticktick:0,obsidian:""},{ticktick:1,obsidian:""},{ticktick:3,obsidian:""},{ticktick:5,obsidian:""},{ticktick:5,obsidian:""}],Pa=new RegExp("(?<=^|\\s)(#(?=[^\\s#.',;!?:]*[^\\d\\s#.',;!?:])[^\\s#.',;!?:]+)(?=[.,;!?:'\\s]|$)|(?<!`)```(?!`)","g"),Ju="^\\s*(-|\\*)\\s+\\[(x| )\\]\\s",Xu=/^([\s\t>]*)/,Qu=/([-*+]|[0-9]+\.)/,Zu=/\[(.)\]/u,ed=/ *(.*)/u,td=/ %%(.*)%%/u,Ea=new RegExp(Xu.source+Qu.source+" +"+Zu.source+ed.source,"u"),be={TickTick_TAG:new RegExp(`^[\\s]*[-] \\[[x ]\\] [\\s\\S]*${ls.TickTick_TAG}[\\s\\S]*$`,"i"),TickTick_ID:/\[ticktick_id::\s*[\d\S]+\]/,TickTick_ID_NUM:/\[ticktick_id::\s*(.*?)\]/,TickTick_ID_DV_NUM:/ticktick_id(.*?)%/,TickTick_LINK:/\[link\]\(.*?\)/,PROJECT_NAME:/\[project::\s*(.*?)\]/,TASK_CONTENT:{REMOVE_PRIORITY:/[]/ug,REMOVE_TAGS:Pa,REMOVE_SPACE:/^\s+|\s+$/g,REMOVE_INLINE_METADATA:/%%\[\w+::\s*\w+\]%%/,REMOVE_CHECKBOX:/^(-|\*)\s+\[(x|X| )\]\s/,REMOVE_CHECKBOX_WITH_INDENTATION:/^([ \t]*)?(-|\*)\s+\[(x|X| )\]\s/,REMOVE_TickTick_LINK:/\[link\]\(.*?\)/},ALL_TAGS:Pa,TASK_CHECKBOX_CHECKED:/- \[(x|X)\] /,TASK_INDENTATION:/^(\s{2,}|\t)(-|\*)\s+\[(x|X| )\]/,TAB_INDENTATION:/^(\t+)/,priorityRegex:/^.*([]).*$/u,BLANK_LINE:/^\s*$/,ITEM_LINE:/\[(.*?)\]\s*(.*?)\s*%%(.*?)%%/,LINE_ITEM_ID:/%%(?!\[ticktick_id::\s)[a-f0-9]{24}%%/g};class id{constructor(e,t){this.app=e,this.plugin=t}async convertTaskToLine(e,t){var r,a;let n="	".repeat(t);return e.title=this.stripOBSUrl(e.title),n+=`- [${e.status>0?"x":" "}] ${e.title}`,e.tags&&(n=this.addTagsToLine(n,e.tags)),n=this.addTickTickTag(n),O().taskLinksInObsidian==="taskLink"&&(n=this.addTickTickLink(n,e.id,e.projectId)),n=this.addTickTickId(n,e.id),n=this.addPriorityToLine(n,e),n=(r=this.plugin.dateMan)==null?void 0:r.addDatesToLine(n,e),(O().syncNotes||O().taskLinksInObsidian==="noteLink")&&((a=this.plugin.cacheOperation)==null||a.getFilepathForTask(e.id),this.plugin.taskParser.hasDescription(e)?n=this.addNote(n,e.desc,t,"Description",e.id,e.projectId):this.plugin.taskParser.hasNote(e)?n=this.addNote(n,e.content,t,"Note",e.id,e.projectId):O().taskLinksInObsidian==="noteLink"&&(n=this.addNote(n,e.content,t,"Note",e.id,e.projectId))),this.plugin.taskParser.hasItems(e)&&(n=this.addItems(n,e.items,t)),n}stripOBSUrl(e){let t=e;if(t){let i=e.lastIndexOf(".md)"),n=0;if(i>0){for(let r=i;r>0;r--)if(e[r]==="["){n=r;break}n>0&&(t=e.substring(0,n),t=t+e.substring(i+4))}}return t.trim()}getTaskContentFromLineText(e){var i;let t=e.replace(be.TASK_CONTENT.REMOVE_INLINE_METADATA,"").replace(be.TASK_CONTENT.REMOVE_TickTick_LINK,"").replace(be.TASK_CONTENT.REMOVE_PRIORITY,"").replace(be.TASK_CONTENT.REMOVE_TAGS,"").replace(be.TASK_CONTENT.REMOVE_CHECKBOX,"").replace(be.TASK_CONTENT.REMOVE_CHECKBOX_WITH_INDENTATION,"").replace(be.TASK_CONTENT.REMOVE_SPACE,"");return t=this.stripOBSUrl(t),t=(i=this.plugin.dateMan)==null?void 0:i.stripDatesFromLine(t),t}stripLineItemId(e){return e.replace(be.LINE_ITEM_ID,"")}addTagsToLine(e,t){const i=new RegExp(ls.TickTick_TAG.substring(1),"i");return t.forEach(n=>{n.match(i)||(n.includes("-")&&(n=n.replace(/-/g,"/")),e=e+" #"+n)}),e}async convertLineToTask(e,t,i,n,r){var D,R,M,j,q,ee,oe;let a=!1,o=null,l=null,c=[];const f=this.getNumTabs(e);let p=this.removeTaskIndentation(e);const d=this.getTickTickId(p),u=(D=this.plugin.dateMan)==null?void 0:D.parseDates(p);let g;r?g=r:d?g=n.getTaskRecord(d):g=await n.getTaskRecordByLine(t);let h=null,m=null,v="",b="",w="";O().fileLinksInTickTick!=="noLink"&&i&&(w=this.plugin.taskParser.getObsidianUrlFromFilepath(i)),O().fileLinksInTickTick==="taskLink"&&(v=w),O().fileLinksInTickTick==="noteLink"&&(b=w+`
`),f>0&&(o=g.parentId,a=!0,l=(R=this.plugin.cacheOperation)==null?void 0:R.loadTaskFromCacheID(o));const k=n.getTaskItems(d);if(k&&k.length>0)for(const te in k)c.push(this.getItemFromLine(k[te]));if(g)if(g.taskLines.length>1){const te=this.getNoteString(g,d);let ue=b+te.textContent;te.isNote?m=ue:h=ue}else b&&(c.length>0?h=b:m=b);let T=Intl.DateTimeFormat().resolvedOptions().timeZone;const I=this.getAllTagsFromLineText(p);let E=await((M=this.plugin.cacheOperation)==null?void 0:M.getDefaultProjectIdForFilepath(i));if(a)l&&(E=l.projectId);else if(I)for(const te of I){let ue=te.replace(/#/g,"");ue=ue.replace(/_/g," ");let ve=await((j=this.plugin.cacheOperation)==null?void 0:j.getProjectIdByNameFromCache(ue));if(ve){E=ve;break}}const S=this.getTaskContentFromLineText(p);O().debugMode&&!E&&y.error("Converting line to Object, could not find project Id: ",S);const L=this.isTaskCheckboxChecked(p),A=this.getTaskPriority(p);let _=u!=null&&u.startDate?u==null?void 0:u.startDate.isoDate:u!=null&&u.scheduled_date?u==null?void 0:u.scheduled_date.isoDate:u!=null&&u.dueDate?u==null?void 0:u.dueDate.isoDate:"";return{id:d||"",projectId:E,title:S.trim()+" "+v,content:m||"",desc:h||"",items:c||[],parentId:o||"",dueDate:((q=u==null?void 0:u.dueDate)==null?void 0:q.isoDate)||"",startDate:_||"",completedTime:((ee=u==null?void 0:u.completedTime)==null?void 0:ee.isoDate)||"",isAllDay:(u==null?void 0:u.isAllDay)||!1,tags:I||[],priority:Number(A),modifiedTime:((oe=this.plugin.dateMan)==null?void 0:oe.formatDateToISO(new Date))||"",status:L?2:0,timeZone:T,dateHolder:u}}escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}getNoteString(e,t){let i="";if(e.taskLines){let n=[...e.taskLines];n.splice(0,1),n.splice(n.length-1,1);let r;if(t){const a=new RegExp(`\\[link\\]\\(.*${this.escapeRegExp(t)}.*\\)`,"i");r=n.filter(o=>!a.test(o))}r?(r=r.map(a=>a.replace(/^\t*\s{2}|^\s{2}/g,"")),i=r.length>0?r.join(`
`):""):(n=n.map(a=>a.replace(/^\t*\s{2}|^\s{2}/g,"")),i=n.length>0?n.join(`
`):"")}return{isNote:e.isNote,textContent:i}}hasTickTickTag(e){return this.isMarkdownTask(e)?be.TickTick_TAG.test(e):!1}hasTickTickId(e){let t=be.TickTick_ID.test(e);return t||(t=be.TickTick_ID_DV_NUM.test(e)),t}getLineItemId(e){if(!e){y.error("No Text passed to getLineItemId");return}let t=e.match(be.LINE_ITEM_ID),i;return t&&(i=t[0].slice(2,-2)),i}isTickTickTask(e){return this.hasTickTickId(e)}addTickTickId(e,t){return e=`${e} %%[ticktick_id:: ${t}]%%`,e}addChildToParent(e,t){return e.childIds||(e.childIds=[]),e.childIds.push(t),e}getProjectNameFromLineText(e){const t=be.PROJECT_NAME.exec(e);return t?t[1]:null}getTickTickId(e){let t=be.TickTick_ID_NUM.exec(e);return t||(t=be.TickTick_ID_DV_NUM.exec(e)),t?t[1]:void 0}isTaskOpen(e){let t=new RegExp(Ju,"gmi").exec(e);if(t)return t[2].search(/[xX]/)<0;throw new Error(`Status not found in line: ${e}`)}getAllTagsFromLineText(e){let i=[...e.matchAll(be.ALL_TAGS)].map(n=>n[0].replace("#",""));return i=i.map(n=>n.replace(/\//g,"-")),i}isTaskCheckboxChecked(e){return be.TASK_CHECKBOX_CHECKED.test(e)}isTitleChanged(e,t){const i=this.stripOBSUrl(e.title),n=this.stripOBSUrl(t.title);return!(i.trim()===n.trim())}isTagsChanged(e,t){const i=e.tags?e.tags:[],n=t.tags?t.tags:[];return!i&&!n?!1:i&&!n||!i&&n?!0:!(i.length===n.length&&i.sort().every((a,o)=>a===n.sort()[o]))}isStatusChanged(e,t){return!(e.status===t.status)}isParentIdChanged(e,t){let i=e.parentId?e.parentId:"",n=t.parentId?t.parentId:"";return i!=n}isChildrenChanged(e,t){return!e.childIds&&!t.childIds?!1:!e.childIds&&t.childIds||e.childIds&&!t.childIds?!0:(e==null?void 0:e.childIds.length)!=(t==null?void 0:t.childIds.length)}isProjectIdChanged(e,t){if(e.projectId!==t.projectId){y.debug("Project ID changed: ",e.projectId,t.projectId);const i=this.plugin.cacheOperation.getFilepathForTask(t.id);if(i)return y.debug("Task file: ",i),this.plugin.cacheOperation.filepathHasDefaultProjectID(i)?!0:(y.debug("Task file does not have a default project: ",i),new F.Notice(`Task ${t.title} was moved in TickTick, but is in ${i}. Assuming that this is intentional and not moving it.`,1e4),!1)}else return!1}isIndentedTask(e){return be.TASK_INDENTATION.test(e)}getNumTabs(e){const t=be.TAB_INDENTATION.exec(e);return t?t[1].length:0}getTabs(e){const t=this.getNumTabs(e);let i="";for(let n=0;n<t;n++)i=i+"	";return i}getTaskPriority(e){let t="0";const i=e.match(be.priorityRegex);return i!==null&&(t=this.parsePriority(i[1])),t}removeTaskIndentation(e){const t=/^([ \t]*)?- \[(x| )\] /;return e.replace(t,"- [$2] ")}isLineBlank(e){return be.BLANK_LINE.test(e)}isMarkdownTask(e){return e?Ea.test(e):!1}addTickTickTag(e){return e.charAt(e.length-1)===" "?e=e+`${ls.TickTick_TAG}`:e=e+` ${ls.TickTick_TAG} `,e}getObsidianUrlFromFilepath(e){const t=encodeURI(`obsidian://open?vault=${this.app.vault.getName()}&file=${e}`);return`[${e}](${t})`}addTickTickLink(e,t,i){let n=this.createURL(t,i);const r=new RegExp(`${ls.TickTick_TAG}`,"gi"),a=` [link](${n})`;return e.replace(r,a+" $&")}hasTickTickLink(e){return be.TickTick_LINK.test(e)}createURL(e,t){y.debug("createURL",O().baseURL);let i="";return t?i=`https://${O().baseURL}/webapp/#p/${t}/tasks/${e}`:i=`https://${O().baseURL}/webapp/#q/all/tasks/${e}`,i}translateTickTickToObsidian(e){const t=Sa.find(i=>i.ticktick===e);return t?t.obsidian:null}translateObsidianToTickTick(e){const t=Sa.find(i=>i.obsidian===e);return t?t.ticktick:null}taskFromLine(e){let t=Ea.exec(e);if(!t)return null;const n=(t[3]||"")=="x";let r=t[4]||"";r=r.replace(td,"");let a=t[1]?t[1].length:0;return{line:e,status:n,description:r,indent:a}}getAllTags(){}async getLineHash(e){try{return await Yu(e)}catch(t){y.error("Hashing error.",t)}}hasNote(e){return e.content&&e.content.length>0}hasDescription(e){return e.desc&&e.desc.length>0}hasItems(e){return e.items&&e.items.length>0}areNotesChanged(e,t){if(e.length!==t.length)return!0;const i=e.split(`
`),n=t.split(`
`);for(let r=0;r<i.length;r++)if(i[r]!==n[r])return!0;return!1}areItemsChanged(e,t){if((e==null?void 0:e.length)!=(t==null?void 0:t.length))return!0;e.sort((i,n)=>i.id.localeCompare(n.id)),t.sort((i,n)=>i.id.localeCompare(n.id));for(let i=0;i<e.length;i++)if(e[i].id!==e[i].id||e[i].status!==e[i].status||e[i].title!==e[i].title)return!0}parsePriority(e){switch(e){case is.Lowest:return"0";case is.Low:return"1";case is.Medium:return"3";case is.High:return"5";case is.Highest:return"5";default:return"0"}}addItems(e,t,i){return t.forEach(n=>{let r=n.status>0?"- [x]":"- [ ]";const a="	".repeat(i+1);e=`${e} 
${a}${r} ${n.title} `,e=`${e} %%${n.id}%%`}),e}addNote(e,t,i,n,r,a){y.debug();const o=`
`+"	".repeat(i)+"  ",l=O().noteDelimiter;if(l.length>0&&(e=`${e}${o}${l}`),O().taskLinksInObsidian==="noteLink"){const p=`[link](${this.createURL(r,a)})`;e=`${e}${o}${p}`}let c;t.length>0?(c=t.split(`
`),c.length>0&&c[c.length-1].length===0&&c.pop()):c=[];const f=new RegExp("\\[.*\\]\\(obsidian://open\\?vault=.*&file=.*\\)","giu");return c.forEach(p=>{p.search(f)<0&&(e=`${e}${o}${p}`)}),l.length>0&&(e=`${e}${o}${l}`),e}getItemFromLine(e){const t=be.ITEM_LINE.exec(e);let i={};if(t){const n=t[1],r=t[2];i={id:t[3],title:r,status:n?0:2}}return i}addPriorityToLine(e,t){let i=this.translateTickTickToObsidian(t.priority);return i!=null&&(e=`${e} ${i}`),e}}class sd extends F.Modal{constructor(e,t,i){super(e),this.filepath=i,this.plugin=t,this.open()}async onOpen(){const{contentEl:e}=this;e.empty(),e.createEl("h5",{text:"Set default project for TickTick tasks in the current file"}),this.defaultProjectId=await this.plugin.cacheOperation.getDefaultProjectIdForFilepath(this.filepath),this.defaultProjectName=await this.plugin.cacheOperation.getProjectNameByIdFromCache(this.defaultProjectId);const t=O().fileMetadata,i=Object.values(t).map(a=>a.defaultProjectId),r=pi().filter(a=>!i.includes(a.id)).reduce((a,o)=>(a[o.id]=o.name,a),{});new F.Setting(e).setName("Default project").addDropdown(a=>a.addOption(this.defaultProjectId,this.defaultProjectName).addOption("","").addOptions(r).onChange(async o=>{var l;await((l=this.plugin.cacheOperation)==null?void 0:l.setDefaultProjectIdForFilepath(this.filepath,o)),await this.plugin.setStatusBarText(),this.close()}))}onClose(){const{contentEl:e}=this;e.empty()}}class nd extends F.Modal{constructor(e,t,i){super(e),this.title="TicTickSync -- Latest Changes.",this.cancelLabel="Cancel",this.confirmLabel="Got it.",this.message="",this.intro="<p>The following are user experience affecting changes from prior versions of TickTickSync.</p><p><strong>Strongly</strong> recommend that you take a backup ASAP.</p>",this.notableChanges=t,this.onSubmit=i}onOpen(){const e="https://github.com/thesamim/TickTickSync/wiki/Notable-Changes#";let{titleEl:t,contentEl:i}=this;t.setText(this.title);let n=i.createEl("p");n.innerHTML=`${this.intro}`,n=i.createEl("ol"),this.notableChanges.forEach(r=>{let a=n.createEl("li");a.createEl("a",{href:`${e}${r[2]}`,text:`${r[0]}`});let o=a.createEl("ol");r[1].split(`
`).forEach(c=>{o.createEl("div",{text:`${c}`})})}),new F.Setting(i).addButton(r=>{r.setClass("ts_button"),r.setWarning(),r.setButtonText(this.confirmLabel),r.onClick(()=>{this.result=!0,this.onSubmit(this.result),this.close()})})}onClose(){this.titleEl.empty(),this.contentEl.empty(),super.onClose(),this.resolvePromise(this.result)}showModal(){return this.open(),new Promise(e=>this.resolvePromise=e)}}function Kt(s,e){const t=s.split("."),i=e.split(".");for(let n=0;n<Math.max(t.length,i.length);n++){const r=parseInt(t[n]||"0"),a=parseInt(i[n]||"0");if(r<a)return!0;if(r>a)return!1}return!1}const rd="5";var Xa;typeof window<"u"&&((Xa=window.__svelte??(window.__svelte={})).v??(Xa.v=new Set)).add(rd);mc();var ad=X("<option> </option>"),od=X('<div class="access-control"><div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">TickTick/Dida</div> <div class="setting-item-description">Select home server</div></div> <div class="setting-item-control"><select></select></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Username</div> <div class="setting-item-description">Your TickTick/Dida account username</div></div> <div class="setting-item-control"><input type="text" placeholder="Username"/></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Password</div> <div class="setting-item-description">Your TickTick/Dida account password</div></div> <div class="setting-item-control"><input type="password" placeholder="Password"/></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Login</div> <div class="setting-item-description"> </div></div> <div class="setting-item-control"><button class="mod-cta ts_login_button">Login</button></div></div></div>');function ld(s,e){Ze(e,!1);const[t,i]=Ns(),n=()=>As(Ae,"$settingsStore",t);let r=ke(e,"plugin",12);const a={"ticktick.com":"TickTick","dida365.com":"Dida365"};let o=z(),l=z(),c=z(),f=z(!1),p=z(!1);async function d(){if(x(f,!0),!n().baseURL||!P(o)||!P(l)){new F.Notice("Please fill in both Username and Password"),x(f,!1);return}const M=await r().service.login(P(c),P(o),P(l));if(!M){new F.Notice("Login Failed. "),x(f,!1);return}const j=n().inboxID;j.length>0&&j!=M.inboxId&&new F.Notice("You are logged in with a different user ID."),Ae.update(q=>({...q,token:M.token,inboxID:M.inboxId,checkPoint:0})),Ee({token:M.token,inboxID:M.inboxId,inboxName:"Inbox",checkPoint:0}),x(p,!!n().token),r().tickTickRestAPI&&r().tickTickRestAPI.api&&r(r().tickTickRestAPI.api.checkpoint=0,!0),await r().saveProjectsToCache(),await r().saveSettings(!0),x(f,!1)}Wi(async()=>{x(p,!!n().token)}),ot();var u=od(),g=N(u),h=$(N(g),2),m=N(h);const v=ti(()=>O().baseURL);Fr(m,()=>P(v));var b;St(m,5,()=>Object.entries(a),_t,(M,j)=>{var q=ei(()=>Zt(P(j),2));let ee=()=>P(q)[0],oe=()=>P(q)[1];var te=ad(),ue={},ve=N(te);ie(()=>{ue!==(ue=ee())&&(te.value=(te.__value=ee())??""),ce(ve,oe())}),K(M,te)});var w=$(g,2),k=$(N(w),2),T=N(k),I=$(w,2),E=$(N(I),2),S=N(E),L=$(I,2),A=N(L),_=$(N(A),2),C=N(_),D=$(A,2),R=N(D);ie(()=>{b!==(b=P(v))&&(m.value=(m.__value=P(v))??"",ks(m,P(v))),ce(C,P(p)?"You are logged in. You can re-login here.":"Please login here."),R.disabled=P(f)}),re("change",m,async M=>{x(c,M.target.value),pu(Ae,Qe(n).baseURL=P(c),Qe(n)),Ee({baseURL:P(c)}),await r().saveSettings()}),xi(T,()=>P(o),M=>x(o,M)),xi(S,()=>P(l),M=>x(l,M)),re("click",R,d),K(s,u),et(),i()}var Ye="top",yt="bottom",wt="right",Je="left",$r="auto",Ds=[Ye,yt,wt,Je],$i="start",ws="end",cd="clippingParents",qo="viewport",ss="popper",ud="reference",Oa=Ds.reduce(function(s,e){return s.concat([e+"-"+$i,e+"-"+ws])},[]),Ho=[].concat(Ds,[$r]).reduce(function(s,e){return s.concat([e,e+"-"+$i,e+"-"+ws])},[]),dd="beforeRead",fd="read",hd="afterRead",pd="beforeMain",gd="main",md="afterMain",vd="beforeWrite",kd="write",yd="afterWrite",wd=[dd,fd,hd,pd,gd,md,vd,kd,yd];function Dt(s){return s?(s.nodeName||"").toLowerCase():null}function at(s){if(s==null)return window;if(s.toString()!=="[object Window]"){var e=s.ownerDocument;return e&&e.defaultView||window}return s}function vi(s){var e=at(s).Element;return s instanceof e||s instanceof Element}function ht(s){var e=at(s).HTMLElement;return s instanceof e||s instanceof HTMLElement}function Mr(s){if(typeof ShadowRoot>"u")return!1;var e=at(s).ShadowRoot;return s instanceof e||s instanceof ShadowRoot}function bd(s){var e=s.state;Object.keys(e.elements).forEach(function(t){var i=e.styles[t]||{},n=e.attributes[t]||{},r=e.elements[t];!ht(r)||!Dt(r)||(Object.assign(r.style,i),Object.keys(n).forEach(function(a){var o=n[a];o===!1?r.removeAttribute(a):r.setAttribute(a,o===!0?"":o)}))})}function Td(s){var e=s.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(i){var n=e.elements[i],r=e.attributes[i]||{},a=Object.keys(e.styles.hasOwnProperty(i)?e.styles[i]:t[i]),o=a.reduce(function(l,c){return l[c]="",l},{});!ht(n)||!Dt(n)||(Object.assign(n.style,o),Object.keys(r).forEach(function(l){n.removeAttribute(l)}))})}}const Id={name:"applyStyles",enabled:!0,phase:"write",fn:bd,effect:Td,requires:["computeStyles"]};function Ct(s){return s.split("-")[0]}var gi=Math.max,pn=Math.min,Mi=Math.round;function gr(){var s=navigator.userAgentData;return s!=null&&s.brands&&Array.isArray(s.brands)?s.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Ko(){return!/^((?!chrome|android).)*safari/i.test(gr())}function ji(s,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var i=s.getBoundingClientRect(),n=1,r=1;e&&ht(s)&&(n=s.offsetWidth>0&&Mi(i.width)/s.offsetWidth||1,r=s.offsetHeight>0&&Mi(i.height)/s.offsetHeight||1);var a=vi(s)?at(s):window,o=a.visualViewport,l=!Ko()&&t,c=(i.left+(l&&o?o.offsetLeft:0))/n,f=(i.top+(l&&o?o.offsetTop:0))/r,p=i.width/n,d=i.height/r;return{width:p,height:d,top:f,right:c+p,bottom:f+d,left:c,x:c,y:f}}function jr(s){var e=ji(s),t=s.offsetWidth,i=s.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-i)<=1&&(i=e.height),{x:s.offsetLeft,y:s.offsetTop,width:t,height:i}}function Vo(s,e){var t=e.getRootNode&&e.getRootNode();if(s.contains(e))return!0;if(t&&Mr(t)){var i=e;do{if(i&&s.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function Ut(s){return at(s).getComputedStyle(s)}function _d(s){return["table","td","th"].indexOf(Dt(s))>=0}function ri(s){return((vi(s)?s.ownerDocument:s.document)||window.document).documentElement}function En(s){return Dt(s)==="html"?s:s.assignedSlot||s.parentNode||(Mr(s)?s.host:null)||ri(s)}function Ca(s){return!ht(s)||Ut(s).position==="fixed"?null:s.offsetParent}function Sd(s){var e=/firefox/i.test(gr()),t=/Trident/i.test(gr());if(t&&ht(s)){var i=Ut(s);if(i.position==="fixed")return null}var n=En(s);for(Mr(n)&&(n=n.host);ht(n)&&["html","body"].indexOf(Dt(n))<0;){var r=Ut(n);if(r.transform!=="none"||r.perspective!=="none"||r.contain==="paint"||["transform","perspective"].indexOf(r.willChange)!==-1||e&&r.willChange==="filter"||e&&r.filter&&r.filter!=="none")return n;n=n.parentNode}return null}function Fs(s){for(var e=at(s),t=Ca(s);t&&_d(t)&&Ut(t).position==="static";)t=Ca(t);return t&&(Dt(t)==="html"||Dt(t)==="body"&&Ut(t).position==="static")?e:t||Sd(s)||e}function Rr(s){return["top","bottom"].indexOf(s)>=0?"x":"y"}function fs(s,e,t){return gi(s,pn(e,t))}function Pd(s,e,t){var i=fs(s,e,t);return i>t?t:i}function zo(){return{top:0,right:0,bottom:0,left:0}}function Go(s){return Object.assign({},zo(),s)}function Wo(s,e){return e.reduce(function(t,i){return t[i]=s,t},{})}var Ed=function(e,t){return e=typeof e=="function"?e(Object.assign({},t.rects,{placement:t.placement})):e,Go(typeof e!="number"?e:Wo(e,Ds))};function Od(s){var e,t=s.state,i=s.name,n=s.options,r=t.elements.arrow,a=t.modifiersData.popperOffsets,o=Ct(t.placement),l=Rr(o),c=[Je,wt].indexOf(o)>=0,f=c?"height":"width";if(!(!r||!a)){var p=Ed(n.padding,t),d=jr(r),u=l==="y"?Ye:Je,g=l==="y"?yt:wt,h=t.rects.reference[f]+t.rects.reference[l]-a[l]-t.rects.popper[f],m=a[l]-t.rects.reference[l],v=Fs(r),b=v?l==="y"?v.clientHeight||0:v.clientWidth||0:0,w=h/2-m/2,k=p[u],T=b-d[f]-p[g],I=b/2-d[f]/2+w,E=fs(k,I,T),S=l;t.modifiersData[i]=(e={},e[S]=E,e.centerOffset=E-I,e)}}function Cd(s){var e=s.state,t=s.options,i=t.element,n=i===void 0?"[data-popper-arrow]":i;n!=null&&(typeof n=="string"&&(n=e.elements.popper.querySelector(n),!n)||Vo(e.elements.popper,n)&&(e.elements.arrow=n))}const Ad={name:"arrow",enabled:!0,phase:"main",fn:Od,effect:Cd,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Ri(s){return s.split("-")[1]}var Nd={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Ld(s,e){var t=s.x,i=s.y,n=e.devicePixelRatio||1;return{x:Mi(t*n)/n||0,y:Mi(i*n)/n||0}}function Aa(s){var e,t=s.popper,i=s.popperRect,n=s.placement,r=s.variation,a=s.offsets,o=s.position,l=s.gpuAcceleration,c=s.adaptive,f=s.roundOffsets,p=s.isFixed,d=a.x,u=d===void 0?0:d,g=a.y,h=g===void 0?0:g,m=typeof f=="function"?f({x:u,y:h}):{x:u,y:h};u=m.x,h=m.y;var v=a.hasOwnProperty("x"),b=a.hasOwnProperty("y"),w=Je,k=Ye,T=window;if(c){var I=Fs(t),E="clientHeight",S="clientWidth";if(I===at(t)&&(I=ri(t),Ut(I).position!=="static"&&o==="absolute"&&(E="scrollHeight",S="scrollWidth")),I=I,n===Ye||(n===Je||n===wt)&&r===ws){k=yt;var L=p&&I===T&&T.visualViewport?T.visualViewport.height:I[E];h-=L-i.height,h*=l?1:-1}if(n===Je||(n===Ye||n===yt)&&r===ws){w=wt;var A=p&&I===T&&T.visualViewport?T.visualViewport.width:I[S];u-=A-i.width,u*=l?1:-1}}var _=Object.assign({position:o},c&&Nd),C=f===!0?Ld({x:u,y:h},at(t)):{x:u,y:h};if(u=C.x,h=C.y,l){var D;return Object.assign({},_,(D={},D[k]=b?"0":"",D[w]=v?"0":"",D.transform=(T.devicePixelRatio||1)<=1?"translate("+u+"px, "+h+"px)":"translate3d("+u+"px, "+h+"px, 0)",D))}return Object.assign({},_,(e={},e[k]=b?h+"px":"",e[w]=v?u+"px":"",e.transform="",e))}function Dd(s){var e=s.state,t=s.options,i=t.gpuAcceleration,n=i===void 0?!0:i,r=t.adaptive,a=r===void 0?!0:r,o=t.roundOffsets,l=o===void 0?!0:o,c={placement:Ct(e.placement),variation:Ri(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:n,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,Aa(Object.assign({},c,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:a,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,Aa(Object.assign({},c,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const Fd={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:Dd,data:{}};var Hs={passive:!0};function xd(s){var e=s.state,t=s.instance,i=s.options,n=i.scroll,r=n===void 0?!0:n,a=i.resize,o=a===void 0?!0:a,l=at(e.elements.popper),c=[].concat(e.scrollParents.reference,e.scrollParents.popper);return r&&c.forEach(function(f){f.addEventListener("scroll",t.update,Hs)}),o&&l.addEventListener("resize",t.update,Hs),function(){r&&c.forEach(function(f){f.removeEventListener("scroll",t.update,Hs)}),o&&l.removeEventListener("resize",t.update,Hs)}}const $d={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:xd,data:{}};var Md={left:"right",right:"left",bottom:"top",top:"bottom"};function Qs(s){return s.replace(/left|right|bottom|top/g,function(e){return Md[e]})}var jd={start:"end",end:"start"};function Na(s){return s.replace(/start|end/g,function(e){return jd[e]})}function Br(s){var e=at(s),t=e.pageXOffset,i=e.pageYOffset;return{scrollLeft:t,scrollTop:i}}function Ur(s){return ji(ri(s)).left+Br(s).scrollLeft}function Rd(s,e){var t=at(s),i=ri(s),n=t.visualViewport,r=i.clientWidth,a=i.clientHeight,o=0,l=0;if(n){r=n.width,a=n.height;var c=Ko();(c||!c&&e==="fixed")&&(o=n.offsetLeft,l=n.offsetTop)}return{width:r,height:a,x:o+Ur(s),y:l}}function Bd(s){var e,t=ri(s),i=Br(s),n=(e=s.ownerDocument)==null?void 0:e.body,r=gi(t.scrollWidth,t.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),a=gi(t.scrollHeight,t.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),o=-i.scrollLeft+Ur(s),l=-i.scrollTop;return Ut(n||t).direction==="rtl"&&(o+=gi(t.clientWidth,n?n.clientWidth:0)-r),{width:r,height:a,x:o,y:l}}function qr(s){var e=Ut(s),t=e.overflow,i=e.overflowX,n=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+n+i)}function Yo(s){return["html","body","#document"].indexOf(Dt(s))>=0?s.ownerDocument.body:ht(s)&&qr(s)?s:Yo(En(s))}function hs(s,e){var t;e===void 0&&(e=[]);var i=Yo(s),n=i===((t=s.ownerDocument)==null?void 0:t.body),r=at(i),a=n?[r].concat(r.visualViewport||[],qr(i)?i:[]):i,o=e.concat(a);return n?o:o.concat(hs(En(a)))}function mr(s){return Object.assign({},s,{left:s.x,top:s.y,right:s.x+s.width,bottom:s.y+s.height})}function Ud(s,e){var t=ji(s,!1,e==="fixed");return t.top=t.top+s.clientTop,t.left=t.left+s.clientLeft,t.bottom=t.top+s.clientHeight,t.right=t.left+s.clientWidth,t.width=s.clientWidth,t.height=s.clientHeight,t.x=t.left,t.y=t.top,t}function La(s,e,t){return e===qo?mr(Rd(s,t)):vi(e)?Ud(e,t):mr(Bd(ri(s)))}function qd(s){var e=hs(En(s)),t=["absolute","fixed"].indexOf(Ut(s).position)>=0,i=t&&ht(s)?Fs(s):s;return vi(i)?e.filter(function(n){return vi(n)&&Vo(n,i)&&Dt(n)!=="body"}):[]}function Hd(s,e,t,i){var n=e==="clippingParents"?qd(s):[].concat(e),r=[].concat(n,[t]),a=r[0],o=r.reduce(function(l,c){var f=La(s,c,i);return l.top=gi(f.top,l.top),l.right=pn(f.right,l.right),l.bottom=pn(f.bottom,l.bottom),l.left=gi(f.left,l.left),l},La(s,a,i));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function Jo(s){var e=s.reference,t=s.element,i=s.placement,n=i?Ct(i):null,r=i?Ri(i):null,a=e.x+e.width/2-t.width/2,o=e.y+e.height/2-t.height/2,l;switch(n){case Ye:l={x:a,y:e.y-t.height};break;case yt:l={x:a,y:e.y+e.height};break;case wt:l={x:e.x+e.width,y:o};break;case Je:l={x:e.x-t.width,y:o};break;default:l={x:e.x,y:e.y}}var c=n?Rr(n):null;if(c!=null){var f=c==="y"?"height":"width";switch(r){case $i:l[c]=l[c]-(e[f]/2-t[f]/2);break;case ws:l[c]=l[c]+(e[f]/2-t[f]/2);break}}return l}function bs(s,e){e===void 0&&(e={});var t=e,i=t.placement,n=i===void 0?s.placement:i,r=t.strategy,a=r===void 0?s.strategy:r,o=t.boundary,l=o===void 0?cd:o,c=t.rootBoundary,f=c===void 0?qo:c,p=t.elementContext,d=p===void 0?ss:p,u=t.altBoundary,g=u===void 0?!1:u,h=t.padding,m=h===void 0?0:h,v=Go(typeof m!="number"?m:Wo(m,Ds)),b=d===ss?ud:ss,w=s.rects.popper,k=s.elements[g?b:d],T=Hd(vi(k)?k:k.contextElement||ri(s.elements.popper),l,f,a),I=ji(s.elements.reference),E=Jo({reference:I,element:w,placement:n}),S=mr(Object.assign({},w,E)),L=d===ss?S:I,A={top:T.top-L.top+v.top,bottom:L.bottom-T.bottom+v.bottom,left:T.left-L.left+v.left,right:L.right-T.right+v.right},_=s.modifiersData.offset;if(d===ss&&_){var C=_[n];Object.keys(A).forEach(function(D){var R=[wt,yt].indexOf(D)>=0?1:-1,M=[Ye,yt].indexOf(D)>=0?"y":"x";A[D]+=C[M]*R})}return A}function Kd(s,e){e===void 0&&(e={});var t=e,i=t.placement,n=t.boundary,r=t.rootBoundary,a=t.padding,o=t.flipVariations,l=t.allowedAutoPlacements,c=l===void 0?Ho:l,f=Ri(i),p=f?o?Oa:Oa.filter(function(g){return Ri(g)===f}):Ds,d=p.filter(function(g){return c.indexOf(g)>=0});d.length===0&&(d=p);var u=d.reduce(function(g,h){return g[h]=bs(s,{placement:h,boundary:n,rootBoundary:r,padding:a})[Ct(h)],g},{});return Object.keys(u).sort(function(g,h){return u[g]-u[h]})}function Vd(s){if(Ct(s)===$r)return[];var e=Qs(s);return[Na(s),e,Na(e)]}function zd(s){var e=s.state,t=s.options,i=s.name;if(!e.modifiersData[i]._skip){for(var n=t.mainAxis,r=n===void 0?!0:n,a=t.altAxis,o=a===void 0?!0:a,l=t.fallbackPlacements,c=t.padding,f=t.boundary,p=t.rootBoundary,d=t.altBoundary,u=t.flipVariations,g=u===void 0?!0:u,h=t.allowedAutoPlacements,m=e.options.placement,v=Ct(m),b=v===m,w=l||(b||!g?[Qs(m)]:Vd(m)),k=[m].concat(w).reduce(function(me,W){return me.concat(Ct(W)===$r?Kd(e,{placement:W,boundary:f,rootBoundary:p,padding:c,flipVariations:g,allowedAutoPlacements:h}):W)},[]),T=e.rects.reference,I=e.rects.popper,E=new Map,S=!0,L=k[0],A=0;A<k.length;A++){var _=k[A],C=Ct(_),D=Ri(_)===$i,R=[Ye,yt].indexOf(C)>=0,M=R?"width":"height",j=bs(e,{placement:_,boundary:f,rootBoundary:p,altBoundary:d,padding:c}),q=R?D?wt:Je:D?yt:Ye;T[M]>I[M]&&(q=Qs(q));var ee=Qs(q),oe=[];if(r&&oe.push(j[C]<=0),o&&oe.push(j[q]<=0,j[ee]<=0),oe.every(function(me){return me})){L=_,S=!1;break}E.set(_,oe)}if(S)for(var te=g?3:1,ue=function(W){var de=k.find(function(B){var ae=E.get(B);if(ae)return ae.slice(0,W).every(function(ye){return ye})});if(de)return L=de,"break"},ve=te;ve>0;ve--){var se=ue(ve);if(se==="break")break}e.placement!==L&&(e.modifiersData[i]._skip=!0,e.placement=L,e.reset=!0)}}const Gd={name:"flip",enabled:!0,phase:"main",fn:zd,requiresIfExists:["offset"],data:{_skip:!1}};function Da(s,e,t){return t===void 0&&(t={x:0,y:0}),{top:s.top-e.height-t.y,right:s.right-e.width+t.x,bottom:s.bottom-e.height+t.y,left:s.left-e.width-t.x}}function Fa(s){return[Ye,wt,yt,Je].some(function(e){return s[e]>=0})}function Wd(s){var e=s.state,t=s.name,i=e.rects.reference,n=e.rects.popper,r=e.modifiersData.preventOverflow,a=bs(e,{elementContext:"reference"}),o=bs(e,{altBoundary:!0}),l=Da(a,i),c=Da(o,n,r),f=Fa(l),p=Fa(c);e.modifiersData[t]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:f,hasPopperEscaped:p},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":f,"data-popper-escaped":p})}const Yd={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Wd};function Jd(s,e,t){var i=Ct(s),n=[Je,Ye].indexOf(i)>=0?-1:1,r=typeof t=="function"?t(Object.assign({},e,{placement:s})):t,a=r[0],o=r[1];return a=a||0,o=(o||0)*n,[Je,wt].indexOf(i)>=0?{x:o,y:a}:{x:a,y:o}}function Xd(s){var e=s.state,t=s.options,i=s.name,n=t.offset,r=n===void 0?[0,0]:n,a=Ho.reduce(function(f,p){return f[p]=Jd(p,e.rects,r),f},{}),o=a[e.placement],l=o.x,c=o.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=c),e.modifiersData[i]=a}const Qd={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Xd};function Zd(s){var e=s.state,t=s.name;e.modifiersData[t]=Jo({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const ef={name:"popperOffsets",enabled:!0,phase:"read",fn:Zd,data:{}};function tf(s){return s==="x"?"y":"x"}function sf(s){var e=s.state,t=s.options,i=s.name,n=t.mainAxis,r=n===void 0?!0:n,a=t.altAxis,o=a===void 0?!1:a,l=t.boundary,c=t.rootBoundary,f=t.altBoundary,p=t.padding,d=t.tether,u=d===void 0?!0:d,g=t.tetherOffset,h=g===void 0?0:g,m=bs(e,{boundary:l,rootBoundary:c,padding:p,altBoundary:f}),v=Ct(e.placement),b=Ri(e.placement),w=!b,k=Rr(v),T=tf(k),I=e.modifiersData.popperOffsets,E=e.rects.reference,S=e.rects.popper,L=typeof h=="function"?h(Object.assign({},e.rects,{placement:e.placement})):h,A=typeof L=="number"?{mainAxis:L,altAxis:L}:Object.assign({mainAxis:0,altAxis:0},L),_=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,C={x:0,y:0};if(I){if(r){var D,R=k==="y"?Ye:Je,M=k==="y"?yt:wt,j=k==="y"?"height":"width",q=I[k],ee=q+m[R],oe=q-m[M],te=u?-S[j]/2:0,ue=b===$i?E[j]:S[j],ve=b===$i?-S[j]:-E[j],se=e.elements.arrow,me=u&&se?jr(se):{width:0,height:0},W=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:zo(),de=W[R],B=W[M],ae=fs(0,E[j],me[j]),ye=w?E[j]/2-te-ae-de-A.mainAxis:ue-ae-de-A.mainAxis,U=w?-E[j]/2+te+ae+B+A.mainAxis:ve+ae+B+A.mainAxis,Z=e.elements.arrow&&Fs(e.elements.arrow),Oe=Z?k==="y"?Z.clientTop||0:Z.clientLeft||0:0,Se=(D=_==null?void 0:_[k])!=null?D:0,je=q+ye-Se-Oe,De=q+U-Se,Ne=fs(u?pn(ee,je):ee,q,u?gi(oe,De):oe);I[k]=Ne,C[k]=Ne-q}if(o){var Ce,Le=k==="x"?Ye:Je,Fe=k==="x"?yt:wt,ne=I[T],Pe=T==="y"?"height":"width",xe=ne+m[Le],$e=ne-m[Fe],qe=[Ye,Je].indexOf(v)!==-1,tt=(Ce=_==null?void 0:_[T])!=null?Ce:0,J=qe?xe:ne-E[Pe]-S[Pe]-tt+A.altAxis,Q=qe?ne+E[Pe]+S[Pe]-tt-A.altAxis:$e,H=u&&qe?Pd(J,ne,Q):fs(u?J:xe,ne,u?Q:$e);I[T]=H,C[T]=H-ne}e.modifiersData[i]=C}}const nf={name:"preventOverflow",enabled:!0,phase:"main",fn:sf,requiresIfExists:["offset"]};function rf(s){return{scrollLeft:s.scrollLeft,scrollTop:s.scrollTop}}function af(s){return s===at(s)||!ht(s)?Br(s):rf(s)}function of(s){var e=s.getBoundingClientRect(),t=Mi(e.width)/s.offsetWidth||1,i=Mi(e.height)/s.offsetHeight||1;return t!==1||i!==1}function lf(s,e,t){t===void 0&&(t=!1);var i=ht(e),n=ht(e)&&of(e),r=ri(e),a=ji(s,n,t),o={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(i||!i&&!t)&&((Dt(e)!=="body"||qr(r))&&(o=af(e)),ht(e)?(l=ji(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):r&&(l.x=Ur(r))),{x:a.left+o.scrollLeft-l.x,y:a.top+o.scrollTop-l.y,width:a.width,height:a.height}}function cf(s){var e=new Map,t=new Set,i=[];s.forEach(function(r){e.set(r.name,r)});function n(r){t.add(r.name);var a=[].concat(r.requires||[],r.requiresIfExists||[]);a.forEach(function(o){if(!t.has(o)){var l=e.get(o);l&&n(l)}}),i.push(r)}return s.forEach(function(r){t.has(r.name)||n(r)}),i}function uf(s){var e=cf(s);return wd.reduce(function(t,i){return t.concat(e.filter(function(n){return n.phase===i}))},[])}function df(s){var e;return function(){return e||(e=new Promise(function(t){Promise.resolve().then(function(){e=void 0,t(s())})})),e}}function ff(s){var e=s.reduce(function(t,i){var n=t[i.name];return t[i.name]=n?Object.assign({},n,i,{options:Object.assign({},n.options,i.options),data:Object.assign({},n.data,i.data)}):i,t},{});return Object.keys(e).map(function(t){return e[t]})}var xa={placement:"bottom",modifiers:[],strategy:"absolute"};function $a(){for(var s=arguments.length,e=new Array(s),t=0;t<s;t++)e[t]=arguments[t];return!e.some(function(i){return!(i&&typeof i.getBoundingClientRect=="function")})}function hf(s){s===void 0&&(s={});var e=s,t=e.defaultModifiers,i=t===void 0?[]:t,n=e.defaultOptions,r=n===void 0?xa:n;return function(o,l,c){c===void 0&&(c=r);var f={placement:"bottom",orderedModifiers:[],options:Object.assign({},xa,r),modifiersData:{},elements:{reference:o,popper:l},attributes:{},styles:{}},p=[],d=!1,u={state:f,setOptions:function(v){var b=typeof v=="function"?v(f.options):v;h(),f.options=Object.assign({},r,f.options,b),f.scrollParents={reference:vi(o)?hs(o):o.contextElement?hs(o.contextElement):[],popper:hs(l)};var w=uf(ff([].concat(i,f.options.modifiers)));return f.orderedModifiers=w.filter(function(k){return k.enabled}),g(),u.update()},forceUpdate:function(){if(!d){var v=f.elements,b=v.reference,w=v.popper;if($a(b,w)){f.rects={reference:lf(b,Fs(w),f.options.strategy==="fixed"),popper:jr(w)},f.reset=!1,f.placement=f.options.placement,f.orderedModifiers.forEach(function(A){return f.modifiersData[A.name]=Object.assign({},A.data)});for(var k=0;k<f.orderedModifiers.length;k++){if(f.reset===!0){f.reset=!1,k=-1;continue}var T=f.orderedModifiers[k],I=T.fn,E=T.options,S=E===void 0?{}:E,L=T.name;typeof I=="function"&&(f=I({state:f,options:S,name:L,instance:u})||f)}}}},update:df(function(){return new Promise(function(m){u.forceUpdate(),m(f)})}),destroy:function(){h(),d=!0}};if(!$a(o,l))return u;u.setOptions(c).then(function(m){!d&&c.onFirstUpdate&&c.onFirstUpdate(m)});function g(){f.orderedModifiers.forEach(function(m){var v=m.name,b=m.options,w=b===void 0?{}:b,k=m.effect;if(typeof k=="function"){var T=k({state:f,name:v,instance:u,options:w}),I=function(){};p.push(T||I)}})}function h(){p.forEach(function(m){return m()}),p=[]}return u}}var pf=[$d,ef,Fd,Id,Qd,Gd,nf,Ad,Yd],gf=hf({defaultModifiers:pf});const mf=(s,e)=>(s%e+e)%e;class vf{constructor(e,t,i){this.owner=e,this.containerEl=t,t.on("click",".suggestion-item",this.onSuggestionClick.bind(this)),t.on("mousemove",".suggestion-item",this.onSuggestionMouseover.bind(this)),i.register([],"ArrowUp",n=>{if(!n.isComposing)return this.setSelectedItem(this.selectedItem-1,!0),!1}),i.register([],"ArrowDown",n=>{if(!n.isComposing)return this.setSelectedItem(this.selectedItem+1,!0),!1}),i.register([],"Enter",n=>{if(!n.isComposing)return this.useSelectedItem(n),!1})}onSuggestionClick(e,t){e.preventDefault();const i=this.suggestions.indexOf(t);this.setSelectedItem(i,!1),this.useSelectedItem(e)}onSuggestionMouseover(e,t){const i=this.suggestions.indexOf(t);this.setSelectedItem(i,!1)}setSuggestions(e){this.containerEl.empty();const t=[];e.forEach(i=>{const n=this.containerEl.createDiv("suggestion-item");this.owner.renderSuggestion(i,n),t.push(n)}),this.values=e,this.suggestions=t,this.setSelectedItem(0,!1)}useSelectedItem(e){const t=this.values[this.selectedItem];t&&this.owner.selectSuggestion(t,e)}setSelectedItem(e,t){const i=mf(e,this.suggestions.length),n=this.suggestions[this.selectedItem],r=this.suggestions[i];n==null||n.removeClass("is-selected"),r==null||r.addClass("is-selected"),this.selectedItem=i,t&&r.scrollIntoView(!1)}}class kf{constructor(e){this.inputEl=e,this.scope=new F.Scope,this.suggestEl=createDiv("suggestion-container");const t=this.suggestEl.createDiv("suggestion");this.suggest=new vf(this,t,this.scope),this.scope.register([],"Escape",this.close.bind(this)),this.inputEl.addEventListener("input",this.onInputChanged.bind(this)),this.inputEl.addEventListener("focus",this.onInputChanged.bind(this)),this.inputEl.addEventListener("blur",this.close.bind(this)),this.suggestEl.on("mousedown",".suggestion-container",i=>{i.preventDefault()})}onInputChanged(){const e=this.inputEl.value,t=this.getSuggestions(e);if(!t){this.close();return}t.length>0?(this.suggest.setSuggestions(t),this.open(app.dom.appContainerEl,this.inputEl)):this.close()}open(e,t){app.keymap.pushScope(this.scope),e.appendChild(this.suggestEl),this.popper=gf(t,this.suggestEl,{placement:"bottom-start",modifiers:[{name:"sameWidth",enabled:!0,fn:({state:i,instance:n})=>{const r=`${i.rects.reference.width}px`;i.styles.popper.width!==r&&(i.styles.popper.width=r,n.update())},phase:"beforeWrite",requires:["computeStyles"]}]})}close(){app.keymap.popScope(this.scope),this.suggest.setSuggestions([]),this.popper&&this.popper.destroy(),this.suggestEl.detach()}}class Xo extends kf{constructor(e,t){super(e),this.inputEl=e,this.app=t}getSuggestions(e){const t=this.app.vault.getAllLoadedFiles(),i=[],n=e.toLowerCase();return t.forEach(r=>{r instanceof F.TFolder&&r.path.toLowerCase().contains(n)&&i.push(r)}),i}renderSuggestion(e,t){t.setText(e.path)}selectSuggestion(e){this.inputEl.value=e.path,this.inputEl.trigger("input"),this.close()}}async function Qo(s,e){if(!s)return null;s.length>1&&/^[/\\]/.test(s)&&(s=s.substring(1));let t=app.vault.getAbstractFileByPath(s);if(!t)try{t=await app.vault.createFolder(s),new F.Notice(`New folder ${t.path} created.`)}catch(i){return new F.Notice(`Folder ${s} creation failed: ${i}. Please correct and try again.`,5e3),null}return t instanceof F.TFolder?(new F.Notice(`${e} folder is now ${t.path}.`),t.path):null}var yf=X(`<div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Manual sync</div> <div class="setting-item-description">Manually perform a synchronization task</div></div> <div class="setting-item-control"><button class="mod-cta">Sync</button></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Check database</div> <div class="setting-item-description">Check for possible issues: sync error, file renaming not updated, or missed tasks not synchronized</div></div> <div class="setting-item-control"><button class="mod-cta">Check Database</button></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Backup TickTick data</div> <div class="setting-item-description">Click to backup TickTick data. The backed-up files will be stored in the selected directory of the
					Obsidian vault</div></div> <div class="setting-item-control"><button class="mod-cta">Backup</button></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Skip backup</div> <div class="setting-item-description">Skip backup on startup</div></div> <div class="setting-item-control"><label class="toggle-switch"><input type="checkbox"/> <span class="slider"></span></label></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Backup folder</div> <div class="setting-item-description">Choose the folder to store the backup files.</div></div> <div class="setting-item-control flex-container"><div class="modal-form remove-padding remove-border fix-suggest"></div></div></div>`,1),wf=X('<div class="manual-operations"><!></div>');function bf(s,e){Ze(e,!1);let t=ke(e,"plugin",8),i={};async function n(){if(!O().token){new F.Notice("Please log in from settings first");return}try{await t().scheduledSynchronization(),new F.Notice("Sync completed.")}catch(p){new F.Notice(`An error occurred while syncing: ${p}`)}}let r;function a(p){new F.Setting(p).addSearch(d=>{d.setPlaceholder("Select or Create folder").setValue(O().bkupFolder),d.setValue(i[O().bkupFolder]),new Xo(d.inputEl,app),d.onChange(u=>{r&&clearTimeout(r),r=setTimeout(async()=>{const g=await Qo(u,"Backup");g&&(Ee({bkupFolder:g}),await t().saveSettings())},700)})})}function o(){const p=app.vault.getAllFolders(!0),d={};for(const u of p)d[u.path]=u.name;return d}Wi(async()=>{i=o()}),ot();var l=wf(),c=N(l);{var f=p=>{var d=yf(),u=mt(d),g=$(N(u),2),h=N(g),m=$(u,2),v=$(N(m),2),b=N(v),w=$(m,2),k=$(N(w),2),T=N(k),I=$(w,2),E=$(N(I),2),S=N(E),L=N(S),A=$(I,2),_=$(N(A),2),C=N(_);No(C,D=>a==null?void 0:a(D)),ie(D=>fr(L,D),[()=>O().skipBackup],ti),re("click",h,n),re("click",b,()=>t().service.checkDataBase()),re("click",T,()=>t().service.backup()),re("change",L,async D=>{Ee({skipBackup:D.target.checked}),await t().saveSettings()}),K(p,d)};Te(c,p=>{O().token&&p(f)})}K(s,l),et()}const Tf={1:"AND",2:"OR"},If={trace:"trace",debug:"debug",info:"info",warn:"warn",error:"error"},Ks={noLink:"No Link",taskLink:"Link in Task",noteLink:"Link in Description"};var _f=X("<option> </option>"),Sf=X('<div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Log Level</div> <div class="setting-item-description">Determine log level</div></div> <div class="TTS-setting-item-control"><select></select></div></div>'),Pf=X("<span> </span>"),Ef=X('<div style="margin-top: 1em;"><textarea readonly="" rows="10" style="width:100%;"></textarea> <div style="display:flex; align-items:center; gap: 1em; margin-top: 0.5em;"><button>Copy to clipboard</button> <!></div></div>'),Of=X('<div class="debug-options"><div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Debug mode</div> <div class="setting-item-description">Allow access to developer settings</div></div> <div class="setting-item-control"><label class="toggle-switch"><input type="checkbox"/> <span class="slider"></span></label></div></div> <!> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Generate Debug Info.</div> <div class="setting-item-description">Click to report settings for a bug.</div></div> <div class="setting-item-control"><button class="mod-cta">Generate</button></div></div> <!></div>');function Cf(s,e){Ze(e,!1);let t=ke(e,"plugin",8),i=z(!1),n=z(!1),r=z(""),a=z("");Wi(async()=>{x(i,O().debugMode)});function o(){const I=O(),E=O().fileMetadata,S=[];for(const A in E){const _=E[A].TickTickTasks?E[A].TickTickTasks.length:"TickTickTasks not found";S.push(`${A}, ${_}`)}return{general:{version:I.version,baseURL:I.baseURL,enableFullVaultSync:I.enableFullVaultSync,debugMode:I.debugMode,logLevel:I.logLevel,fileLinksInTickTick:I.fileLinksInTickTick,taskLinksInObsidian:I.taskLinksInObsidian,bkupFolder:I.bkupFolder,skipBackup:I.skipBackup,numProjects:I.TickTickTasksData.projects.length,fileTasks:S},defaults:{defaultProjectName:I.defaultProjectName,defaultProjectId:I.defaultProjectId,TickTickTasksFilePath:I.TickTickTasksFilePath},syncControl:{SyncProject:I.SyncProject,tagAndOr:I.tagAndOr,SyncTag:I.SyncTag},noteSetting:{syncNotes:I.syncNotes,noteDelimiter:I.noteDelimiter}}}async function l(){let I=o();x(r,"```\n"+JSON.stringify(I,null,2)+"\n```"),x(n,!0),console.log(P(r))}async function c(){try{await navigator.clipboard.writeText(P(r)),x(a,"Copied!"),setTimeout(()=>x(a,""),1500)}catch{x(a,"Copy failed"),setTimeout(()=>x(a,""),1500)}}ot();var f=Of(),p=N(f),d=$(N(p),2),u=N(d),g=N(u),h=$(p,2);{var m=I=>{var E=Sf(),S=$(N(E),2),L=N(S);const A=ti(()=>O().logLevel);Fr(L,()=>P(A));var _;St(L,5,()=>Object.entries(If),_t,(C,D)=>{var R=ei(()=>Zt(P(D),2));let M=()=>P(R)[0],j=()=>P(R)[1];var q=_f(),ee={},oe=N(q);ie(()=>{ee!==(ee=M())&&(q.value=(q.__value=M())??""),ce(oe,j())}),K(C,q)}),ie(()=>{_!==(_=P(A))&&(L.value=(L.__value=P(A))??"",ks(L,P(A)))}),re("change",L,async C=>{Ee({logLevel:C.target.value}),await t().saveSettings(!0),y.setLevel(C.target.value)}),K(I,E)};Te(h,I=>{P(i)&&I(m)})}var v=$(h,2),b=$(N(v),2),w=N(b),k=$(v,2);{var T=I=>{var E=Ef(),S=N(E),L=$(S,2),A=N(L),_=$(A,2);{var C=D=>{var R=Pf(),M=N(R);ie(()=>ce(M,P(a))),K(D,R)};Te(_,D=>{P(a)&&D(C)})}xi(S,()=>P(r),D=>x(r,D)),re("click",A,c),K(I,E)};Te(k,I=>{P(n)&&I(T)})}xr(g,()=>P(i),I=>x(i,I)),re("change",g,async I=>{const E=I.target.checked;x(i,E),Ee({debugMode:E}),await t().saveSettings()}),re("click",w,l),K(s,f),et()}function Af(s,e){const t=O().TickTickTasksData.tasks;for(const i of t)i.modifiedTime=e;Ee({TickTickTasksData:{...O().TickTickTasksData,tasks:t}}),s.tickTickRestAPI&&s.tickTickRestAPI.api&&(s.tickTickRestAPI.api.checkpoint=0)}async function Nf(s){await s.service.syncFiles(!0)}async function Lf(s,e){e==null||e(!0),Ee({checkPoint:0}),y.debug("reset from OBS to TT"),await Nf(s),await s.saveSettings(),await s.scheduledSynchronization(),y.debug("reset from TT to OBS"),Af(s,"1970-01-01T00:00:00.000Z"),await s.saveSettings(),await s.scheduledSynchronization(),e==null||e(!1)}var Df=X('<div class="local-modal-backdrop"></div> <div class="local-modal-dialog" role="dialog" aria-modal="true"><div class="local-modal-content"><h2>Confirm Reset</h2> <p>Do you <strong>REALLY</strong> </p> <p style="color:var(--text-warning);"><em>This will sync everything and can take a while.</em></p> <div class="local-modal-actions"><button class="mod-cta"> </button> <button style="margin-left:1em;">No, cancel</button></div></div></div>',1),Ff=X('<div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Reset Tasks</div> <div class="setting-item-description"> <br/> <em>Caution: This will take some time and update Tasks from TickTick to Obsidian and Obsidian to TickTick.</em></div></div> <div class="setting-item-control"><button class="mod-cta">Reset Tasks.</button></div></div> <!>',1);function Zo(s,e){Ze(e,!1);let t=ke(e,"isWorking",8),i=ke(e,"resetTasksText",8),n=ke(e,"plugin",8),r=ke(e,"setIsWorking",8),a=z(!1),o=z(!1);async function l(){x(a,!0),x(o,!1)}function c(){P(o)||x(a,!1)}async function f(){x(o,!0);try{await Lf(n(),r())}finally{x(a,!1),x(o,!1)}}ot();var p=Ff(),d=mt(p),u=N(d),g=$(N(u),2),h=N(g),m=$(u,2),v=N(m),b=$(d,2);{var w=k=>{var T=Df(),I=mt(T),E=$(I,2),S=N(E),L=$(N(S),2),A=$(N(L),2),_=$(L,4),C=N(_),D=N(C),R=$(C,2);ie(()=>{ga(I,P(o)?"cursor: wait;":""),ga(E,P(o)?"cursor: wait;":""),ce(A,` want to ${i()??""}?`),C.disabled=P(o),ce(D,P(o)?"Resetting...":"Yes, reset"),R.disabled=P(o)}),re("click",I,function(...M){var j;(j=P(o)?void 0:c)==null||j.apply(this,M)}),re("click",C,f),re("click",R,c),K(k,T)};Te(b,k=>{P(a)&&k(w)})}ie(()=>{ce(h,`Do you want to ${i()??""} `),v.disabled=t()}),re("click",v,l),K(s,p),et()}var xf=X('<input type="text" placeholder="Enter delimiter (e.g., ---)" style="margin-left:0.5em; width:10em"/>'),$f=X(`<div>Notes will be synchronized.</div> <br/> <div class="setting-item delimiter-settings"><div class="setting-item-info"><div class="setting-item-name">Note Delimiter</div> <div class="setting-item-description">Choose how Notes are separated from a Task. <br/>Changes will be applied on next update from
						TickTick.</div></div> <div class="setting-item-control"><div class="note-delimiter-row"><div class="delimiter-radio-group"><label><input type="radio" name="delimiterOption" value="none"/> No delimiter</label> <label><input type="radio" name="delimiterOption" value="custom"/> Custom</label></div> <!> <div class="delimiter-preview"><p>Preview:</p> <span><pre> </pre></span></div></div></div></div>`,1),Mf=X("<div>Notes will be not synchronized.</div> <br/>",1),jf=X('<div><div class="notes-settings "><div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Sync Notes</div> <div class="setting-item-description">Synchronize Notes</div></div> <div class="setting-item-control"><label class="toggle-switch"><input type="checkbox"/> <span class="slider"></span></label></div></div> <!> <br/> <!></div></div>');function Rf(s,e){Ze(e,!1);const[t,i]=Ns(),n=()=>As(Ae,"$settingsStore",t);let r=ke(e,"plugin",8),a=z(!1),o=z(!1),l=z("");function c(_){x(a,_)}let f=z("none"),p=z(""),d=z("");n().defaultFolderPath,Wi(()=>{x(o,n().syncNotes),n().noteDelimiter===""||n().noteDelimiter==null?(x(f,"none"),x(p,"")):(x(f,"custom"),x(p,n().noteDelimiter)),m()});function u(_){x(f,_),_==="none"?(x(p,""),g("")):P(p)||(x(p,"---"),g(P(p))),m()}async function g(_){Ae.update(C=>({...C,noteDelimiter:_})),await r().saveSettings()}function h(_){const C=_.target;x(p,C.value),g(P(p)),m()}function m(){x(d,P(f)==="none"?` Task Title 
   Note 1
   Note 2`:` Task Title 
   ${P(p)}
   Note 1
   Note 2
   ${P(p)}`)}Ge(()=>P(o),()=>{x(l,P(o)?"Get all Notes from TickTick?":"Remove all Notes from Obsidian? (This will not delete Notes in TickTick)")}),Es(),ot();var v=jf(),b=N(v),w=N(b),k=$(N(w),2),T=N(k),I=N(T),E=$(w,2);{var S=_=>{var C=$f(),D=$(mt(C),4),R=$(N(D),2),M=N(R),j=N(M),q=N(j),ee=N(q),oe=$(q,2),te=N(oe),ue=$(j,2);{var ve=B=>{var ae=xf();fu(ae,"maxlength",61),xi(ae,()=>P(p),ye=>x(p,ye)),re("input",ae,h),K(B,ae)};Te(ue,B=>{P(f)==="custom"&&B(ve)})}var se=$(ue,2),me=$(N(se),2),W=N(me),de=N(W);ie(()=>{fr(ee,P(f)==="none"),fr(te,P(f)==="custom"),ce(de,P(d))}),re("change",ee,()=>u("none")),re("change",te,()=>u("custom")),K(_,C)},L=_=>{var C=Mf();K(_,C)};Te(E,_=>{P(o)?_(S):_(L,!1)})}var A=$(E,4);Zo(A,{get isWorking(){return P(a)},get resetTasksText(){return P(l)},get plugin(){return r()},setIsWorking:c}),ie(()=>Dr(v,1,P(a)?"wait-cursor":"default-cursor")),xr(I,()=>P(o),_=>x(o,_)),re("change",I,async _=>{const C=_.target.checked;x(o,C),Ae.update(D=>({...D,syncNotes:C})),await r().saveSettings()}),K(s,v),et(),i()}var Bf=X('<div class="collapsible-body"><!></div>'),Uf=X('<div class="short-desc"> </div>'),qf=X('<div class="collapsible-section"><div class="collapsible-header"><span> </span> </div> <!></div>');function On(s,e){Ze(e,!1);let t=ke(e,"title",8),i=ke(e,"open",8,!1),n=ke(e,"shortDesc",8,"");const r=Ls();function a(){r("headerClick")}ot();var o=qf(),l=N(o),c=N(l),f=N(c),p=$(c,1,!0),d=$(l,2);{var u=h=>{var m=Bf(),v=N(m);au(v,e,"default",{}),K(h,m)},g=(h,m)=>{{var v=b=>{var w=Uf(),k=N(w);ie(()=>ce(k,n())),K(b,w)};Te(h,b=>{n()&&b(v)},m)}};Te(d,h=>{i()?h(u):h(g,!1)})}ie(()=>{ce(f,i()?"":""),ce(p,t())}),re("click",l,a),K(s,o),et()}var Hf=X("<option> </option>"),Kf=X('will be created <strong><span class="setting-item-name">after you hit  ENTER</span></strong>',1),Vf=X('<div class="local-modal-backdrop"></div> <div class="local-modal-dialog"><div class="local-modal-content"><h2>Update the World</h2> <p>Do you <strong>REALLY</strong> want to move existing files to <strong> </strong>?</p> <div class="local-modal-actions"><button class="mod-cta">Yes, update it!</button> <button style="margin-left:1em;">No, cancel</button></div></div></div>',1),zf=X(`<div class="sync-control"><div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Default Project</div> <div class="setting-item-description"><div>Tasks are added to the default project associated with a file.</div> <div>If tasks are added to a file with no default project association</div> <div>they will be added to the <span class="setting-item-name"> </span> project.</div></div></div> <div class="setting-item-control"><select class="dropdown" id="sync-project"><option>(none)</option><!></select></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Default folder location</div> <div class="setting-item-description"><div>Folder where TickTick tasks are stored.</div> Default Project File <span class="setting-item-name"> </span> <!></div></div> <div class="setting-item-control flex-container"><div class="local-modal-form remove-padding remove-border fix-suggest"></div></div></div></div> <div style="margin-top: 2em; text-align: right;"><button class="mod-cta">Move Existing Files.</button></div> <!> <style>/* Modal basic styles */
		.local-modal-backdrop {
			position: fixed;
			top: 0;
			left: 0;
			width: 100vw;
			height: 100vh;
			background: rgba(0, 0, 0, 0.4);
			z-index: 99;
		}

		.local-modal-dialog {
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			z-index: 100;
			background: var(--background-secondary); /* matches settings panel */
			border: 1.5px solid var(--background-modifier-border); /* matches panel border */
			border-radius: 8px;
			box-shadow: 0 2px 24px #0003;
			min-width: 300px;
			max-width: 95vw;
			color: var(--text-normal); /* make text readable in all themes */
			display: inline-flex;
			flex-direction: column;
		}

		.local-modal-content {
			padding: 2em;
			display: inline-flex;
			flex-direction: column;
		}

		.local-modal-content h2 {
			margin: 0 0 1.2em 0;
		}

		.local-modal-content p {
			margin: 0 0 2em 0;
		}

		.local-modal-actions {
			margin-top: 2.2em;
			display: flex;
			justify-content: flex-end;
		}</style>`,1);function Gf(s,e){Ze(e,!1);let t=ke(e,"open",8,!1),i=ke(e,"plugin",8),n=z(""),r=z(),a=z(!1),o=z(!1),l=z(!1);const c=Ls();function f(){c("toggle")}let p=[],d=z({});async function u(){const k=It(),T=O().defaultProjectName;if(y.debug("default project folder: ",k,"default project",T),T){const I=T+".md",E=app.vault.getMarkdownFiles();for(const S of E)if(S.path.includes(O().defaultProjectName)){if(S.path!==k+"/"+I){try{await app.vault.rename(S,k+"/"+I)}catch(L){y.error(`File rename failed. ${L}`),alert(`File rename failed. ${L}`)}y.debug("default project file renamed",k+"/"+I)}else y.debug("default project file NOT renamed",await app.vault.getAbstractFileByPath(k+"/"+I));break}}x(r,It()+"/"+O().defaultProjectName)}function g(k){new F.Setting(k).addSearch(T=>{T.setPlaceholder("Select or Create folder").setValue(It()),T.setValue(P(d)),new Xo(T.inputEl,app),T.onChange(I=>{x(r,I+"/"+O().defaultProjectName),x(l,!0)}),T.inputEl.addEventListener("keydown",async I=>{if(I.key==="Enter"){const E=T.inputEl.value,S=await Qo(E,"Default");y.debug("new folder: ",S),S&&(Ee({TickTickTasksFilePath:S}),await u(),await i().saveSettings(),x(o,!0),x(l,!1))}})})}function h(){return p.reduce((k,T)=>(k[T.id]=T.name,k),{})}async function m(k){var T;(!k||k=="")&&(k=O().inboxID),k&&k!==""&&(Ee({defaultProjectName:await((T=i().cacheOperation)==null?void 0:T.getProjectNameByIdFromCache(k))}),Ee({defaultProjectId:k}),await u(),await i().saveSettings())}Wi(async()=>{var k,T;p=await((T=(k=i().service).getProjects)==null?void 0:T.call(k))??[],x(d,h()),x(n,O().defaultProjectId??""),x(r,It()+"/"+O().defaultProjectName)});function v(){x(a,!0),x(o,!1)}function b(){x(a,!1),x(o,!1)}async function w(){x(a,!1);const k=It();O().defaultProjectName;const T=app.vault.getMarkdownFiles();for(const I of T)if(!I.path.includes(O().defaultProjectName)){try{await app.vault.rename(I,k+"/"+I.name)}catch(E){y.error(`File rename failed. ${E}`),alert(`File rename failed. ${E}`)}y.debug("File Moved",k+"/"+I.name)}}ot(),On(s,{title:"Defaults",shortDesc:"Default Folder and Project settings",get open(){return t()},$$events:{headerClick:f},children:(k,T)=>{var I=zf(),E=mt(I),S=N(E),L=N(S),A=$(N(L),2),_=$(N(A),4),C=$(N(_)),D=N(C),R=$(L,2),M=N(R);ie(()=>{P(n),vs(()=>{P(d)})});var j=N(M);j.value=j.__value="";var q=$(j);St(q,1,()=>Object.entries(P(d)),_t,(Z,Oe)=>{var Se=ei(()=>Zt(P(Oe),2));let je=()=>P(Se)[0],De=()=>P(Se)[1];var Ne=Hf(),Ce={},Le=N(Ne);ie(()=>{Ce!==(Ce=je())&&(Ne.value=(Ne.__value=je())??""),ce(Le,De())}),K(Z,Ne)});var ee=$(S,2),oe=N(ee),te=$(N(oe),2),ue=$(N(te),2),ve=N(ue),se=$(ue,2);{var me=Z=>{var Oe=Kf();K(Z,Oe)};Te(se,Z=>{P(l)&&Z(me)})}var W=$(oe,2),de=N(W);No(de,Z=>g==null?void 0:g(Z));var B=$(E,2),ae=N(B),ye=$(B,2);{var U=Z=>{var Oe=Vf(),Se=mt(Oe),je=$(Se,2),De=N(je),Ne=$(N(De),2),Ce=$(N(Ne),3),Le=N(Ce),Fe=$(Ne,2),ne=N(Fe),Pe=$(ne,2);ie(xe=>ce(Le,`/${xe??""}`),[It],ti),re("click",Se,b),re("click",ne,w),re("click",Pe,b),K(Z,Oe)};Te(ye,Z=>{P(a)&&Z(U)})}ie(Z=>{ce(D,Z),ce(ve,`${P(r)??""}.md`),ae.disabled=!P(o)},[()=>O().defaultProjectName],ti),ys(M,()=>P(n),Z=>x(n,Z)),re("change",M,Z=>m(Z.target.value)),re("click",ae,v),K(k,I)},$$slots:{default:!0}}),et()}var Wf=X("<option> </option>"),Yf=X("<option> </option>"),Jf=X("<p>No limitation.</p>"),Xf=X("<p>Only Tasks in <b> </b> will be synchronized</p>"),Qf=X("<p>Only Tasks tagged with <b> </b> tag will be synchronized</p>"),Zf=X(`<p>Only tasks in <b> </b> AND tagged with <b> </b> tag
				will be synchronized</p>`),eh=X("<p>All tasks in <b> </b> will be synchronized. All tasks tagged with <b> </b> tag will be synchronized</p>"),th=X(`<div class="setting-item-description">To limit the tasks TickTickSync will synchronize from TickTick to
		Obsidian select a tag and/or project(list) below. If a tag is entered, only tasks with that tag will be
		synchronized. If a project(list) is selected, only tasks in that project will be synchronized. If
		both are chosen the behavior will be determined by your settings. See result below.</div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Project</div> <div class="setting-item-description">Only tasks in this project will be synchronized.</div></div> <div class="setting-item-control"><select class="dropdown" id="sync-project"><option>(none)</option><!></select></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Tag Behavior</div> <div class="setting-item-description">Determine how Tags will be handled.</div></div> <div class="setting-item-control"><select class="dropdown" id="tag-and-or"></select></div></div> <div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Tag</div> <div class="setting-item-description">Tag value, no "#".</div></div> <div class="setting-item-control"><input id="sync-tag" type="text" placeholder="Only tasks with this tag will be synced"/></div></div> <div class="sync-explanation"><!></div>`,1);function ih(s,e){Ze(e,!1);const[t,i]=Ns(),n=()=>As(Ae,"$settingsStore",t),r=z();let a=ke(e,"open",8,!1),o=ke(e,"plugin",8),l=[],c=z({}),f=z(""),p=z(""),d=z(1),u=z(""),g;const h=Ls();function m(){h("toggle")}async function v(E){var A;Ae.update(_=>({..._,SyncProject:E})),x(f,E);const S=n().fileMetadata;if(!Object.values(S).find(_=>_.defaultProjectId===E)){const _=`Did not find a default Project File for Project ${(A=P(c))==null?void 0:A[E]}. Please create a file and set its default to this project, or select a file to be the default for this project.`;new F.Notice(_,5e3)}await o().saveSettings()}async function b(E){const S=parseInt(E);Ae.update(L=>({...L,tagAndOr:S})),x(d,S),await o().saveSettings()}let w=z({});function k(E){const S=E[n().SyncProject],L=n().SyncTag,A=S&&L?n().tagAndOr==1:void 0;x(w,{project:S,tag:L,andOr:A})}function T(){return l.reduce((E,S)=>(E[S.id]=S.name,E),{})}function I(E){x(u,E),Ae.update(S=>({...S,SyncTag:E})),g&&clearTimeout(g),g=setTimeout(async()=>{await o().saveSettings()},800)}Wi(async()=>{var E,S;l=await((S=(E=o().service).getProjects)==null?void 0:S.call(E))??[],x(c,T()),x(f,n().SyncProject??""),x(p,n().defaultProjectId??""),x(d,n().tagAndOr??1),x(u,n().SyncTag??""),k(P(c))}),Ge(()=>n(),()=>{x(d,n().tagAndOr??1)}),Ge(()=>P(d),()=>{x(r,P(d).toString())}),Ge(()=>n(),()=>{x(f,n().SyncProject??"")}),Ge(()=>n(),()=>{x(p,n().defaultProjectId??"")}),Ge(()=>n(),()=>{x(u,n().SyncTag??"")}),Ge(()=>P(c),()=>{k(P(c))}),Es(),ot(),On(s,{title:"Limit synchronization",shortDesc:"Synchronization settings added for effect",get open(){return a()},$$events:{headerClick:m},children:(E,S)=>{var L=th(),A=$(mt(L),2),_=$(N(A),2),C=N(_);ie(()=>{P(f),vs(()=>{P(c)})});var D=N(C);D.value=D.__value="";var R=$(D);St(R,1,()=>Object.entries(P(c)),_t,(W,de)=>{var B=ei(()=>Zt(P(de),2));let ae=()=>P(B)[0],ye=()=>P(B)[1];var U=Wf(),Z={},Oe=N(U);ie(()=>{Z!==(Z=ae())&&(U.value=(U.__value=ae())??""),ce(Oe,ye())}),K(W,U)});var M=$(A,2),j=$(N(M),2),q=N(j);ie(()=>{P(r),vs(()=>{P(c)})}),St(q,5,()=>Object.entries(Tf),_t,(W,de)=>{var B=ei(()=>Zt(P(de),2));let ae=()=>P(B)[0],ye=()=>P(B)[1];var U=Yf(),Z={},Oe=N(U);ie(()=>{Z!==(Z=ae())&&(U.value=(U.__value=ae())??""),ce(Oe,ye())}),K(W,U)});var ee=$(M,2),oe=$(N(ee),2),te=N(oe),ue=$(ee,2),ve=N(ue);{var se=W=>{var de=Jf();K(W,de)},me=(W,de)=>{{var B=ye=>{var U=Xf(),Z=$(N(U)),Oe=N(Z);ie(()=>ce(Oe,P(w).project)),K(ye,U)},ae=(ye,U)=>{{var Z=Se=>{var je=Qf(),De=$(N(je)),Ne=N(De);ie(()=>ce(Ne,`#${P(w).tag??""}`)),K(Se,je)},Oe=(Se,je)=>{{var De=Ce=>{var Le=Zf(),Fe=$(N(Le)),ne=N(Fe),Pe=$(Fe,2),xe=N(Pe);ie(()=>{ce(ne,P(w).project),ce(xe,`#${P(w).tag??""}`)}),K(Ce,Le)},Ne=Ce=>{var Le=eh(),Fe=$(N(Le)),ne=N(Fe),Pe=$(Fe,2),xe=N(Pe);ie(()=>{ce(ne,P(w).project),ce(xe,`#${P(w).tag??""}`)}),K(Ce,Le)};Te(Se,Ce=>{P(w).andOr?Ce(De):Ce(Ne,!1)},je)}};Te(ye,Se=>{!P(w).project&&P(w).tag?Se(Z):Se(Oe,!1)},U)}};Te(W,ye=>{P(w).project&&!P(w).tag?ye(B):ye(ae,!1)},de)}};Te(ve,W=>{!P(w).project&&!P(w).tag?W(se):W(me,!1)})}ys(C,()=>P(f),W=>x(f,W)),re("change",C,W=>{v(W.target.value),k(P(c))}),ys(q,()=>P(r),W=>x(r,W)),re("change",q,W=>{b(W.target.value),k(P(c))}),xi(te,()=>P(u),W=>x(u,W)),re("input",te,W=>{I(W.target.value),k(P(c))}),K(E,L)},$$slots:{default:!0}}),et(),i()}var sh=X(`<div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Automatic sync interval time</div> <div class="setting-item-description">Please specify the desired interval time, with seconds as the default
				unit. 0 for manual sync. The default setting is 300 seconds, which corresponds to syncing once every 5
				minutes. You can customize it, but it cannot be lower than 20 seconds.</div></div> <div class="setting-item-control"><input id="sync-tag" type="text" Placeholder="Sync interval"/></div></div>`);function nh(s,e){Ze(e,!1);const t=z();let i=ke(e,"open",8,!1),n=ke(e,"plugin",8),r=z(O().automaticSynchronizationInterval),a=z();const o=Ls();function l(){o("toggle")}async function c(f){const p=Number(f);if(isNaN(p)||!Number.isInteger(p)){new F.Notice("Wrong type, please enter a integer.");return}if(p!==0&&p<20){new F.Notice("The synchronization interval time cannot be less than 20 seconds.");return}Ee({automaticSynchronizationInterval:p}),await n().saveSettings(),n().reloadInterval(),new F.Notice("Settings have been updated.")}Ge(()=>P(r),()=>{x(t,P(r).toString())}),Es(),ot(),On(s,{title:"Automatic sync interval time",shortDesc:"Sync interval setting",get open(){return i()},$$events:{headerClick:l},children:(f,p)=>{var d=sh(),u=$(N(d),2),g=N(u);xi(g,()=>P(r),h=>x(r,h)),re("input",g,h=>{P(a)&&clearTimeout(P(a)),x(a,setTimeout(async()=>{const m=h.target;await c(m.value)},900))}),K(f,d)},$$slots:{default:!0}}),et()}let rh=class extends F.Modal{constructor(e,t){super(e),this.title="Full Vault Task Sync Confirmation",this.message=`Are you sure you want to Sync ALL tasks? 
Indented Tasks created in Obsidian will be created as subtasks in TickTick
 Task Items created in TickTick will still be Task Items. This is the only way to create Task Items when Full Vault Sync is enabled.
Tasks that are currently "Items" of tasks MAY be converted to "Sub Tasks" of the containing Tasks.
The "Items" will not be deleted.
Please proceed with Caution.`,this.cancelLabel="Cancel",this.confirmLabel="Confirm Full Vault Task Sync",this.onSubmit=t}onOpen(){const{titleEl:e,contentEl:t}=this;e.setText(this.title),this.message.split(`
`).forEach(n=>{t.createEl("p",{text:n})}),new F.Setting(t).addButton(n=>{n.setClass("ts_button"),n.setButtonText(this.cancelLabel),n.onClick(()=>{this.result=!1,this.onSubmit(this.result),this.close()})}).addButton(n=>{n.setClass("ts_button"),n.setWarning(),n.setButtonText(this.confirmLabel),n.onClick(()=>{this.result=!0,this.onSubmit(this.result),this.close()})})}onClose(){this.titleEl.empty(),this.contentEl.empty(),super.onClose(),this.resolvePromise(this.result)}showModal(){return this.open(),new Promise(e=>this.resolvePromise=e)}};var ah=X(`<div class="Full vault sync"><div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Full vault sync</div> <div class="setting-item-description">By default, only tasks marked with #TickTick are synchronized. If this option is turned on, all
					tasks in
					the vault will be synchronized. <p><b>NOTE: This includes all tasks that are currently Items of a task.</b></p></div></div> <div class="setting-item-control"><label class="toggle-switch"><input type="checkbox"/> <span class="slider"></span></label></div></div></div>`);function oh(s,e){Ze(e,!1);const[t,i]=Ns(),n=()=>As(Ae,"$settingsStore",t);let r=ke(e,"open",8,!1),a=ke(e,"plugin",8),o=z(!1);const l=Ls();function c(){l("toggle")}async function f(){return await new rh(app,()=>{}).showModal()}async function p(d){let u;n().enableFullVaultSync?(Ae.update(g=>({...g,enableFullVaultSync:!1})),u="Full vault sync is disabled."):await f()?(Ae.update(h=>({...h,enableFullVaultSync:!0})),u="Full vault sync is enabled."):(Ae.update(h=>({...h,enableFullVaultSync:!1})),u="Full vault sync not enabled."),new Notice(u),await a().saveSettings()}Ge(()=>n(),()=>{x(o,n().enableFullVaultSync)}),Es(),ot(),On(s,{title:"Full vault sync",shortDesc:"Full vault settings",get open(){return r()},$$events:{headerClick:c},children:(d,u)=>{var g=ah(),h=N(g),m=$(N(h),2),v=N(m),b=N(v);xr(b,()=>P(o),w=>x(o,w)),re("change",b,async w=>{w.target.checked,await p()}),K(d,g)},$$slots:{default:!0}}),et(),i()}function lh(s,e){let t=ke(e,"plugin",8);const i=[{key:"defaults",component:Gf},{key:"limit",component:ih},{key:"auto",component:nh},{key:"full",component:oh}];let n=z("defaults");function r(l){x(n,P(n)===l?"":l)}var a=ur(),o=mt(a);St(o,1,()=>i,_t,(l,c)=>{var f=ur(),p=mt(f);const d=ti(()=>P(n)===P(c).key);ou(p,()=>P(c).component,(u,g)=>{g(u,{get plugin(){return t()},get open(){return P(d)},$$events:{toggle:()=>r(P(c).key)}})}),K(l,f)}),K(s,a)}var ch=X('<div class="setting-item-info"><hr/> <div class="setting-item-name">Notice:</div> <p>Note syncing is disabled. Links can only be added to the Task text or not added at all.</p> <hr/></div>'),uh=X("<option> </option>"),dh=X("<option> </option>"),fh=X('<div><!> <div class="task-settings "><div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Task link handling in Obsidian</div> <div class="setting-item-description">Add TickTick task link to Tasks in Obsidian</div></div> <div class="setting-item-control"><select class="dropdown" id="sync-project"></select></div></div></div> <div class="task-settings "><div class="setting-item"><div class="setting-item-info"><div class="setting-item-name">Task link handling in TickTick</div> <div class="setting-item-description">Add Obsidian file link to Tasks in TickTick</div></div> <div class="setting-item-control"><select class="dropdown" id="sync-project"></select></div></div> <br/> <!></div></div>');function hh(s,e){Ze(e,!1);const[t,i]=Ns(),n=()=>As(Ae,"$settingsStore",t);let r=ke(e,"plugin",8),a=z(!1),o=z(),l=z(),c=z(),f=z(Ks);function p(_){x(a,_)}let d=z("");async function u(_){Ae.update(C=>({...C,taskLinksInObsidian:_})),await r().saveSettings()}async function g(_){Ae.update(C=>({...C,fileLinksInTickTick:_})),await r().saveSettings()}Ge(()=>{},()=>{x(d,"Update Tasks in TickTick and Obsidian?")}),Ge(()=>n(),()=>{x(o,n().fileLinksInTickTick)}),Ge(()=>n(),()=>{x(l,n().taskLinksInObsidian)}),Ge(()=>n(),()=>{x(c,n().syncNotes)}),Ge(()=>(P(c),Ks),()=>{if(P(c))x(f,Ks);else{const _={...Ks};delete _.noteLink,x(f,_)}}),Es(),ot();var h=fh(),m=N(h);{var v=_=>{var C=ch();K(_,C)};Te(m,_=>{P(c)||_(v)})}var b=$(m,2),w=N(b),k=$(N(w),2),T=N(k);ie(()=>{P(l),vs(()=>{P(f)})}),St(T,5,()=>Object.entries(P(f)),_t,(_,C)=>{var D=ei(()=>Zt(P(C),2));let R=()=>P(D)[0],M=()=>P(D)[1];var j=uh(),q={},ee=N(j);ie(()=>{q!==(q=R())&&(j.value=(j.__value=R())??""),ce(ee,M())}),K(_,j)});var I=$(b,2),E=N(I),S=$(N(E),2),L=N(S);ie(()=>{P(o),vs(()=>{P(f)})}),St(L,5,()=>Object.entries(P(f)),_t,(_,C)=>{var D=ei(()=>Zt(P(C),2));let R=()=>P(D)[0],M=()=>P(D)[1];var j=dh(),q={},ee=N(j);ie(()=>{q!==(q=R())&&(j.value=(j.__value=R())??""),ce(ee,M())}),K(_,j)});var A=$(E,4);Zo(A,{get isWorking(){return P(a)},get resetTasksText(){return P(d)},get plugin(){return r()},setIsWorking:p}),ie(()=>Dr(h,1,P(a)?"wait-cursor":"default-cursor")),ys(T,()=>P(l),_=>x(l,_)),re("change",T,_=>u(_.target.value)),ys(L,()=>P(o),_=>x(o,_)),re("change",L,_=>g(_.target.value)),K(s,h),et(),i()}var ph=X("<button> </button>"),gh=X('<div class="ticktick-settings"> </div> <div class="ticktick-settings"><nav class="settings-tabs"></nav> <div class="TTS-tab-content"><!></div></div>',1);function mh(s,e){Ze(e,!1);let t=ke(e,"app",8),i=ke(e,"plugin",8);const n=t().vault.getName(),r=O().version;let a=z("access");const o={access:"Access Control",sync:"Sync Control",manual:"Manual Operations",debug:"Debug Options",tasks:"Task Links",notes:"Notes"};ot();var l=gh(),c=mt(l),f=N(c),p=$(c,2),d=N(p);St(d,5,()=>Object.entries(o),_t,(v,b)=>{var w=ei(()=>Zt(P(b),2));let k=()=>P(w)[0],T=()=>P(w)[1];var I=ph(),E=N(I);ie(()=>{Dr(I,1,`tab-button ${P(a)===k()?"active":""}`),ce(E,T())}),re("click",I,()=>x(a,k())),K(v,I)});var u=$(d,2),g=N(u);{var h=v=>{ld(v,{get plugin(){return i()}})},m=(v,b)=>{{var w=T=>{lh(T,{get plugin(){return i()},get app(){return t()}})},k=(T,I)=>{{var E=L=>{bf(L,{get plugin(){return i()}})},S=(L,A)=>{{var _=D=>{Cf(D,{get plugin(){return i()}})},C=(D,R)=>{{var M=q=>{Rf(q,{get plugin(){return i()}})},j=(q,ee)=>{{var oe=te=>{hh(te,{get plugin(){return i()}})};Te(q,te=>{P(a)==="tasks"&&te(oe)},ee)}};Te(D,q=>{P(a)==="notes"?q(M):q(j,!1)},R)}};Te(L,D=>{P(a)==="debug"?D(_):D(C,!1)},A)}};Te(T,L=>{P(a)==="manual"?L(E):L(S,!1)},I)}};Te(v,T=>{P(a)==="sync"?T(w):T(k,!1)},b)}};Te(g,v=>{P(a)==="access"?v(h):v(m,!1)})}ie(()=>ce(f,`${n??""} -- ${r??""}`)),K(s,l),et()}class vh extends F.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t,yu(t)}async display(){const{containerEl:e}=this;e.empty(),this.settingsComponent=Co(mh,{target:e,props:{app:this.app,plugin:this.plugin}})}async hide(){super.hide(),await Ao(this.settingsComponent)}getProjectTagText(e){const t=e[O().SyncProject],i=O().SyncTag,n=O().tagAndOr;return!t&&!i?"No limitation.":t&&!i?`Only Tasks in <b>${t}</b> will be synchronized`:!t&&i?`Only Tasks tagged with <b>#${i}</b> tag will be synchronized`:n==1?`Only tasks in <b>${t}</b> AND tagged with <b>#${i}</b> tag will be synchronized`:`All tasks in <b>${t}</b> will be synchronized. All tasks tagged with <b>#${i}</b> tag will be synchronized`}async confirmFullSync(){return await new ConfirmFullSyncModal(this.app,()=>{}).showModal()}}var kh=X('<div class="break-words number svelte-1bzi045"><h1>Error in Query</h1> <p></p></div>');function yh(s){var e=kh();$(N(e),2),K(s,e)}const wh=Fo(),el={service:wh};var bh=X(" <br/>",1),Th=X("<p> </p>"),Ih=X('<div class="warning"><h2>Warnings</h2> <!></div>'),_h=X('<div class="break-words"><h1>Tasks</h1> <p><!></p> <!></div>');function Sh(s,e){Ze(e,!1);let t=ke(e,"query",8),i=ke(e,"warnings",8),n;el.service.subscribe(d=>n=d);let r=a(t());async function a(d){return n.getTasks(d.filter)}ot();var o=_h(),l=$(N(o),2),c=N(l);tu(c,()=>r,d=>{var u=ha("Loading tasks...");K(d,u)},(d,u)=>{var g=ur(),h=mt(g);St(h,1,()=>P(u),_t,(m,v)=>{var b=bh(),w=mt(b);ie(()=>ce(w,P(v).title)),K(m,b)}),K(d,g)},(d,u)=>{var g=ha();ie(()=>ce(g,`System error: ${P(u).message??""}.`)),K(d,g)});var f=$(l,2);{var p=d=>{var u=Ih(),g=$(N(u),2);St(g,1,i,_t,(h,m)=>{var v=Th(),b=N(v);ie(()=>ce(b,P(m))),K(h,v)}),K(d,u)};Te(f,d=>{i().length>0&&d(p)})}K(s,o),et()}var ut=(s=>(s[s.Priority=0]="Priority",s[s.PriorityAscending=1]="PriorityAscending",s[s.Date=2]="Date",s[s.DateDescending=3]="DateDescending",s[s.Order=4]="Order",s[s.DateAdded=5]="DateAdded",s[s.DateAddedDescending=6]="DateAddedDescending",s))(ut||{}),Si=(s=>(s[s.Due=0]="Due",s[s.Project=1]="Project",s[s.Labels=2]="Labels",s[s.Description=3]="Description",s))(Si||{}),xt=(s=>(s[s.None=0]="None",s[s.Project=1]="Project",s[s.Section=2]="Section",s[s.Priority=3]="Priority",s[s.Date=4]="Date",s[s.Label=5]="Label",s))(xt||{});const Hr=Symbol.for("yaml.alias"),vr=Symbol.for("yaml.document"),Qt=Symbol.for("yaml.map"),tl=Symbol.for("yaml.pair"),Ft=Symbol.for("yaml.scalar"),Yi=Symbol.for("yaml.seq"),bt=Symbol.for("yaml.node.type"),ai=s=>!!s&&typeof s=="object"&&s[bt]===Hr,yi=s=>!!s&&typeof s=="object"&&s[bt]===vr,Ji=s=>!!s&&typeof s=="object"&&s[bt]===Qt,we=s=>!!s&&typeof s=="object"&&s[bt]===tl,ge=s=>!!s&&typeof s=="object"&&s[bt]===Ft,Xi=s=>!!s&&typeof s=="object"&&s[bt]===Yi;function Ie(s){if(s&&typeof s=="object")switch(s[bt]){case Qt:case Yi:return!0}return!1}function _e(s){if(s&&typeof s=="object")switch(s[bt]){case Hr:case Qt:case Ft:case Yi:return!0}return!1}const il=s=>(ge(s)||Ie(s))&&!!s.anchor,We=Symbol("break visit"),sl=Symbol("skip children"),At=Symbol("remove node");function wi(s,e){const t=nl(e);yi(s)?Pi(null,s.contents,t,Object.freeze([s]))===At&&(s.contents=null):Pi(null,s,t,Object.freeze([]))}wi.BREAK=We;wi.SKIP=sl;wi.REMOVE=At;function Pi(s,e,t,i){const n=rl(s,e,t,i);if(_e(n)||we(n))return al(s,i,n),Pi(s,n,t,i);if(typeof n!="symbol"){if(Ie(e)){i=Object.freeze(i.concat(e));for(let r=0;r<e.items.length;++r){const a=Pi(r,e.items[r],t,i);if(typeof a=="number")r=a-1;else{if(a===We)return We;a===At&&(e.items.splice(r,1),r-=1)}}}else if(we(e)){i=Object.freeze(i.concat(e));const r=Pi("key",e.key,t,i);if(r===We)return We;r===At&&(e.key=null);const a=Pi("value",e.value,t,i);if(a===We)return We;a===At&&(e.value=null)}}return n}async function Cn(s,e){const t=nl(e);yi(s)?await Ei(null,s.contents,t,Object.freeze([s]))===At&&(s.contents=null):await Ei(null,s,t,Object.freeze([]))}Cn.BREAK=We;Cn.SKIP=sl;Cn.REMOVE=At;async function Ei(s,e,t,i){const n=await rl(s,e,t,i);if(_e(n)||we(n))return al(s,i,n),Ei(s,n,t,i);if(typeof n!="symbol"){if(Ie(e)){i=Object.freeze(i.concat(e));for(let r=0;r<e.items.length;++r){const a=await Ei(r,e.items[r],t,i);if(typeof a=="number")r=a-1;else{if(a===We)return We;a===At&&(e.items.splice(r,1),r-=1)}}}else if(we(e)){i=Object.freeze(i.concat(e));const r=await Ei("key",e.key,t,i);if(r===We)return We;r===At&&(e.key=null);const a=await Ei("value",e.value,t,i);if(a===We)return We;a===At&&(e.value=null)}}return n}function nl(s){return typeof s=="object"&&(s.Collection||s.Node||s.Value)?Object.assign({Alias:s.Node,Map:s.Node,Scalar:s.Node,Seq:s.Node},s.Value&&{Map:s.Value,Scalar:s.Value,Seq:s.Value},s.Collection&&{Map:s.Collection,Seq:s.Collection},s):s}function rl(s,e,t,i){var n,r,a,o,l;if(typeof t=="function")return t(s,e,i);if(Ji(e))return(n=t.Map)==null?void 0:n.call(t,s,e,i);if(Xi(e))return(r=t.Seq)==null?void 0:r.call(t,s,e,i);if(we(e))return(a=t.Pair)==null?void 0:a.call(t,s,e,i);if(ge(e))return(o=t.Scalar)==null?void 0:o.call(t,s,e,i);if(ai(e))return(l=t.Alias)==null?void 0:l.call(t,s,e,i)}function al(s,e,t){const i=e[e.length-1];if(Ie(i))i.items[s]=t;else if(we(i))s==="key"?i.key=t:i.value=t;else if(yi(i))i.contents=t;else{const n=ai(i)?"alias":"scalar";throw new Error(`Cannot replace node with ${n} parent`)}}const Ph={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},Eh=s=>s.replace(/[!,[\]{}]/g,e=>Ph[e]);class Ke{constructor(e,t){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},Ke.defaultYaml,e),this.tags=Object.assign({},Ke.defaultTags,t)}clone(){const e=new Ke(this.yaml,this.tags);return e.docStart=this.docStart,e}atDocument(){const e=new Ke(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:Ke.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},Ke.defaultTags);break}return e}add(e,t){this.atNextDocument&&(this.yaml={explicit:Ke.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},Ke.defaultTags),this.atNextDocument=!1);const i=e.trim().split(/[ \t]+/),n=i.shift();switch(n){case"%TAG":{if(i.length!==2&&(t(0,"%TAG directive should contain exactly two parts"),i.length<2))return!1;const[r,a]=i;return this.tags[r]=a,!0}case"%YAML":{if(this.yaml.explicit=!0,i.length!==1)return t(0,"%YAML directive should contain exactly one part"),!1;const[r]=i;if(r==="1.1"||r==="1.2")return this.yaml.version=r,!0;{const a=/^\d+\.\d+$/.test(r);return t(6,`Unsupported YAML version ${r}`,a),!1}}default:return t(0,`Unknown directive ${n}`,!0),!1}}tagName(e,t){if(e==="!")return"!";if(e[0]!=="!")return t(`Not a valid tag: ${e}`),null;if(e[1]==="<"){const a=e.slice(2,-1);return a==="!"||a==="!!"?(t(`Verbatim tags aren't resolved, so ${e} is invalid.`),null):(e[e.length-1]!==">"&&t("Verbatim tags must end with a >"),a)}const[,i,n]=e.match(/^(.*!)([^!]*)$/s);n||t(`The ${e} tag has no suffix`);const r=this.tags[i];if(r)try{return r+decodeURIComponent(n)}catch(a){return t(String(a)),null}return i==="!"?e:(t(`Could not resolve tag: ${e}`),null)}tagString(e){for(const[t,i]of Object.entries(this.tags))if(e.startsWith(i))return t+Eh(e.substring(i.length));return e[0]==="!"?e:`!<${e}>`}toString(e){const t=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],i=Object.entries(this.tags);let n;if(e&&i.length>0&&_e(e.contents)){const r={};wi(e.contents,(a,o)=>{_e(o)&&o.tag&&(r[o.tag]=!0)}),n=Object.keys(r)}else n=[];for(const[r,a]of i)r==="!!"&&a==="tag:yaml.org,2002:"||(!e||n.some(o=>o.startsWith(a)))&&t.push(`%TAG ${r} ${a}`);return t.join(`
`)}}Ke.defaultYaml={explicit:!1,version:"1.2"};Ke.defaultTags={"!!":"tag:yaml.org,2002:"};function ol(s){if(/[\x00-\x19\s,[\]{}]/.test(s)){const t=`Anchor must not contain whitespace or control characters: ${JSON.stringify(s)}`;throw new Error(t)}return!0}function ll(s){const e=new Set;return wi(s,{Value(t,i){i.anchor&&e.add(i.anchor)}}),e}function cl(s,e){for(let t=1;;++t){const i=`${s}${t}`;if(!e.has(i))return i}}function Oh(s,e){const t=[],i=new Map;let n=null;return{onAnchor:r=>{t.push(r),n??(n=ll(s));const a=cl(e,n);return n.add(a),a},setAnchors:()=>{for(const r of t){const a=i.get(r);if(typeof a=="object"&&a.anchor&&(ge(a.node)||Ie(a.node)))a.node.anchor=a.anchor;else{const o=new Error("Failed to resolve repeated object (this should not happen)");throw o.source=r,o}}},sourceObjects:i}}function Oi(s,e,t,i){if(i&&typeof i=="object")if(Array.isArray(i))for(let n=0,r=i.length;n<r;++n){const a=i[n],o=Oi(s,i,String(n),a);o===void 0?delete i[n]:o!==a&&(i[n]=o)}else if(i instanceof Map)for(const n of Array.from(i.keys())){const r=i.get(n),a=Oi(s,i,n,r);a===void 0?i.delete(n):a!==r&&i.set(n,a)}else if(i instanceof Set)for(const n of Array.from(i)){const r=Oi(s,i,n,n);r===void 0?i.delete(n):r!==n&&(i.delete(n),i.add(r))}else for(const[n,r]of Object.entries(i)){const a=Oi(s,i,n,r);a===void 0?delete i[n]:a!==r&&(i[n]=a)}return s.call(e,t,i)}function pt(s,e,t){if(Array.isArray(s))return s.map((i,n)=>pt(i,String(n),t));if(s&&typeof s.toJSON=="function"){if(!t||!il(s))return s.toJSON(e,t);const i={aliasCount:0,count:1,res:void 0};t.anchors.set(s,i),t.onCreate=r=>{i.res=r,delete t.onCreate};const n=s.toJSON(e,t);return t.onCreate&&t.onCreate(n),n}return typeof s=="bigint"&&!(t!=null&&t.keep)?Number(s):s}class Kr{constructor(e){Object.defineProperty(this,bt,{value:e})}clone(){const e=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(e.range=this.range.slice()),e}toJS(e,{mapAsMap:t,maxAliasCount:i,onAnchor:n,reviver:r}={}){if(!yi(e))throw new TypeError("A document argument is required");const a={anchors:new Map,doc:e,keep:!0,mapAsMap:t===!0,mapKeyWarned:!1,maxAliasCount:typeof i=="number"?i:100},o=pt(this,"",a);if(typeof n=="function")for(const{count:l,res:c}of a.anchors.values())n(c,l);return typeof r=="function"?Oi(r,{"":o},"",o):o}}class An extends Kr{constructor(e){super(Hr),this.source=e,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(e,t){let i;t!=null&&t.aliasResolveCache?i=t.aliasResolveCache:(i=[],wi(e,{Node:(r,a)=>{(ai(a)||il(a))&&i.push(a)}}),t&&(t.aliasResolveCache=i));let n;for(const r of i){if(r===this)break;r.anchor===this.source&&(n=r)}return n}toJSON(e,t){if(!t)return{source:this.source};const{anchors:i,doc:n,maxAliasCount:r}=t,a=this.resolve(n,t);if(!a){const l=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(l)}let o=i.get(a);if(o||(pt(a,null,t),o=i.get(a)),!o||o.res===void 0){const l="This should not happen: Alias anchor was not resolved?";throw new ReferenceError(l)}if(r>=0&&(o.count+=1,o.aliasCount===0&&(o.aliasCount=Zs(n,a,i)),o.count*o.aliasCount>r)){const l="Excessive alias count indicates a resource exhaustion attack";throw new ReferenceError(l)}return o.res}toString(e,t,i){const n=`*${this.source}`;if(e){if(ol(this.source),e.options.verifyAliasOrder&&!e.anchors.has(this.source)){const r=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(r)}if(e.implicitKey)return`${n} `}return n}}function Zs(s,e,t){if(ai(e)){const i=e.resolve(s),n=t&&i&&t.get(i);return n?n.count*n.aliasCount:0}else if(Ie(e)){let i=0;for(const n of e.items){const r=Zs(s,n,t);r>i&&(i=r)}return i}else if(we(e)){const i=Zs(s,e.key,t),n=Zs(s,e.value,t);return Math.max(i,n)}return 1}const ul=s=>!s||typeof s!="function"&&typeof s!="object";class Y extends Kr{constructor(e){super(Ft),this.value=e}toJSON(e,t){return t!=null&&t.keep?this.value:pt(this.value,e,t)}toString(){return String(this.value)}}Y.BLOCK_FOLDED="BLOCK_FOLDED";Y.BLOCK_LITERAL="BLOCK_LITERAL";Y.PLAIN="PLAIN";Y.QUOTE_DOUBLE="QUOTE_DOUBLE";Y.QUOTE_SINGLE="QUOTE_SINGLE";const Ch="tag:yaml.org,2002:";function Ah(s,e,t){if(e){const i=t.filter(r=>r.tag===e),n=i.find(r=>!r.format)??i[0];if(!n)throw new Error(`Tag ${e} not found`);return n}return t.find(i=>{var n;return((n=i.identify)==null?void 0:n.call(i,s))&&!i.format})}function Ts(s,e,t){var p,d,u;if(yi(s)&&(s=s.contents),_e(s))return s;if(we(s)){const g=(d=(p=t.schema[Qt]).createNode)==null?void 0:d.call(p,t.schema,null,t);return g.items.push(s),g}(s instanceof String||s instanceof Number||s instanceof Boolean||typeof BigInt<"u"&&s instanceof BigInt)&&(s=s.valueOf());const{aliasDuplicateObjects:i,onAnchor:n,onTagObj:r,schema:a,sourceObjects:o}=t;let l;if(i&&s&&typeof s=="object"){if(l=o.get(s),l)return l.anchor??(l.anchor=n(s)),new An(l.anchor);l={anchor:null,node:null},o.set(s,l)}e!=null&&e.startsWith("!!")&&(e=Ch+e.slice(2));let c=Ah(s,e,a.tags);if(!c){if(s&&typeof s.toJSON=="function"&&(s=s.toJSON()),!s||typeof s!="object"){const g=new Y(s);return l&&(l.node=g),g}c=s instanceof Map?a[Qt]:Symbol.iterator in Object(s)?a[Yi]:a[Qt]}r&&(r(c),delete t.onTagObj);const f=c!=null&&c.createNode?c.createNode(t.schema,s,t):typeof((u=c==null?void 0:c.nodeClass)==null?void 0:u.from)=="function"?c.nodeClass.from(t.schema,s,t):new Y(s);return e?f.tag=e:c.default||(f.tag=c.tag),l&&(l.node=f),f}function gn(s,e,t){let i=t;for(let n=e.length-1;n>=0;--n){const r=e[n];if(typeof r=="number"&&Number.isInteger(r)&&r>=0){const a=[];a[r]=i,i=a}else i=new Map([[r,i]])}return Ts(i,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:s,sourceObjects:new Map})}const cs=s=>s==null||typeof s=="object"&&!!s[Symbol.iterator]().next().done;class dl extends Kr{constructor(e,t){super(e),Object.defineProperty(this,"schema",{value:t,configurable:!0,enumerable:!1,writable:!0})}clone(e){const t=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return e&&(t.schema=e),t.items=t.items.map(i=>_e(i)||we(i)?i.clone(e):i),this.range&&(t.range=this.range.slice()),t}addIn(e,t){if(cs(e))this.add(t);else{const[i,...n]=e,r=this.get(i,!0);if(Ie(r))r.addIn(n,t);else if(r===void 0&&this.schema)this.set(i,gn(this.schema,n,t));else throw new Error(`Expected YAML collection at ${i}. Remaining path: ${n}`)}}deleteIn(e){const[t,...i]=e;if(i.length===0)return this.delete(t);const n=this.get(t,!0);if(Ie(n))return n.deleteIn(i);throw new Error(`Expected YAML collection at ${t}. Remaining path: ${i}`)}getIn(e,t){const[i,...n]=e,r=this.get(i,!0);return n.length===0?!t&&ge(r)?r.value:r:Ie(r)?r.getIn(n,t):void 0}hasAllNullValues(e){return this.items.every(t=>{if(!we(t))return!1;const i=t.value;return i==null||e&&ge(i)&&i.value==null&&!i.commentBefore&&!i.comment&&!i.tag})}hasIn(e){const[t,...i]=e;if(i.length===0)return this.has(t);const n=this.get(t,!0);return Ie(n)?n.hasIn(i):!1}setIn(e,t){const[i,...n]=e;if(n.length===0)this.set(i,t);else{const r=this.get(i,!0);if(Ie(r))r.setIn(n,t);else if(r===void 0&&this.schema)this.set(i,gn(this.schema,n,t));else throw new Error(`Expected YAML collection at ${i}. Remaining path: ${n}`)}}}const Nh=s=>s.replace(/^(?!$)(?: $)?/gm,"#");function Mt(s,e){return/^\n+$/.test(s)?s.substring(1):e?s.replace(/^(?! *$)/gm,e):s}const ci=(s,e,t)=>s.endsWith(`
`)?Mt(t,e):t.includes(`
`)?`
`+Mt(t,e):(s.endsWith(" ")?"":" ")+t,fl="flow",kr="block",en="quoted";function Nn(s,e,t="flow",{indentAtStart:i,lineWidth:n=80,minContentWidth:r=20,onFold:a,onOverflow:o}={}){if(!n||n<0)return s;n<r&&(r=0);const l=Math.max(1+r,1+n-e.length);if(s.length<=l)return s;const c=[],f={};let p=n-e.length;typeof i=="number"&&(i>n-Math.max(2,r)?c.push(0):p=n-i);let d,u,g=!1,h=-1,m=-1,v=-1;t===kr&&(h=Ma(s,h,e.length),h!==-1&&(p=h+l));for(let w;w=s[h+=1];){if(t===en&&w==="\\"){switch(m=h,s[h+1]){case"x":h+=3;break;case"u":h+=5;break;case"U":h+=9;break;default:h+=1}v=h}if(w===`
`)t===kr&&(h=Ma(s,h,e.length)),p=h+e.length+l,d=void 0;else{if(w===" "&&u&&u!==" "&&u!==`
`&&u!=="	"){const k=s[h+1];k&&k!==" "&&k!==`
`&&k!=="	"&&(d=h)}if(h>=p)if(d)c.push(d),p=d+l,d=void 0;else if(t===en){for(;u===" "||u==="	";)u=w,w=s[h+=1],g=!0;const k=h>v+1?h-2:m-1;if(f[k])return s;c.push(k),f[k]=!0,p=k+l,d=void 0}else g=!0}u=w}if(g&&o&&o(),c.length===0)return s;a&&a();let b=s.slice(0,c[0]);for(let w=0;w<c.length;++w){const k=c[w],T=c[w+1]||s.length;k===0?b=`
${e}${s.slice(0,T)}`:(t===en&&f[k]&&(b+=`${s[k]}\\`),b+=`
${e}${s.slice(k+1,T)}`)}return b}function Ma(s,e,t){let i=e,n=e+1,r=s[n];for(;r===" "||r==="	";)if(e<n+t)r=s[++e];else{do r=s[++e];while(r&&r!==`
`);i=e,n=e+1,r=s[n]}return i}const Ln=(s,e)=>({indentAtStart:e?s.indent.length:s.indentAtStart,lineWidth:s.options.lineWidth,minContentWidth:s.options.minContentWidth}),Dn=s=>/^(%|---|\.\.\.)/m.test(s);function Lh(s,e,t){if(!e||e<0)return!1;const i=e-t,n=s.length;if(n<=i)return!1;for(let r=0,a=0;r<n;++r)if(s[r]===`
`){if(r-a>i)return!0;if(a=r+1,n-a<=i)return!1}return!0}function ps(s,e){const t=JSON.stringify(s);if(e.options.doubleQuotedAsJSON)return t;const{implicitKey:i}=e,n=e.options.doubleQuotedMinMultiLineLength,r=e.indent||(Dn(s)?"  ":"");let a="",o=0;for(let l=0,c=t[l];c;c=t[++l])if(c===" "&&t[l+1]==="\\"&&t[l+2]==="n"&&(a+=t.slice(o,l)+"\\ ",l+=1,o=l,c="\\"),c==="\\")switch(t[l+1]){case"u":{a+=t.slice(o,l);const f=t.substr(l+2,4);switch(f){case"0000":a+="\\0";break;case"0007":a+="\\a";break;case"000b":a+="\\v";break;case"001b":a+="\\e";break;case"0085":a+="\\N";break;case"00a0":a+="\\_";break;case"2028":a+="\\L";break;case"2029":a+="\\P";break;default:f.substr(0,2)==="00"?a+="\\x"+f.substr(2):a+=t.substr(l,6)}l+=5,o=l+1}break;case"n":if(i||t[l+2]==='"'||t.length<n)l+=1;else{for(a+=t.slice(o,l)+`

`;t[l+2]==="\\"&&t[l+3]==="n"&&t[l+4]!=='"';)a+=`
`,l+=2;a+=r,t[l+2]===" "&&(a+="\\"),l+=1,o=l+1}break;default:l+=1}return a=o?a+t.slice(o):t,i?a:Nn(a,r,en,Ln(e,!1))}function yr(s,e){if(e.options.singleQuote===!1||e.implicitKey&&s.includes(`
`)||/[ \t]\n|\n[ \t]/.test(s))return ps(s,e);const t=e.indent||(Dn(s)?"  ":""),i="'"+s.replace(/'/g,"''").replace(/\n+/g,`$&
${t}`)+"'";return e.implicitKey?i:Nn(i,t,fl,Ln(e,!1))}function Ci(s,e){const{singleQuote:t}=e.options;let i;if(t===!1)i=ps;else{const n=s.includes('"'),r=s.includes("'");n&&!r?i=yr:r&&!n?i=ps:i=t?yr:ps}return i(s,e)}let wr;try{wr=new RegExp(`(^|(?<!
))
+(?!
|$)`,"g")}catch{wr=/\n+(?!\n|$)/g}function tn({comment:s,type:e,value:t},i,n,r){const{blockQuote:a,commentString:o,lineWidth:l}=i.options;if(!a||/\n[\t ]+$/.test(t)||/^\s*$/.test(t))return Ci(t,i);const c=i.indent||(i.forceBlockIndent||Dn(t)?"  ":""),f=a==="literal"?!0:a==="folded"||e===Y.BLOCK_FOLDED?!1:e===Y.BLOCK_LITERAL?!0:!Lh(t,l,c.length);if(!t)return f?`|
`:`>
`;let p,d;for(d=t.length;d>0;--d){const T=t[d-1];if(T!==`
`&&T!=="	"&&T!==" ")break}let u=t.substring(d);const g=u.indexOf(`
`);g===-1?p="-":t===u||g!==u.length-1?(p="+",r&&r()):p="",u&&(t=t.slice(0,-u.length),u[u.length-1]===`
`&&(u=u.slice(0,-1)),u=u.replace(wr,`$&${c}`));let h=!1,m,v=-1;for(m=0;m<t.length;++m){const T=t[m];if(T===" ")h=!0;else if(T===`
`)v=m;else break}let b=t.substring(0,v<m?v+1:m);b&&(t=t.substring(b.length),b=b.replace(/\n+/g,`$&${c}`));let k=(h?c?"2":"1":"")+p;if(s&&(k+=" "+o(s.replace(/ ?[\r\n]+/g," ")),n&&n()),!f){const T=t.replace(/\n+/g,`
$&`).replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${c}`);let I=!1;const E=Ln(i,!0);a!=="folded"&&e!==Y.BLOCK_FOLDED&&(E.onOverflow=()=>{I=!0});const S=Nn(`${b}${T}${u}`,c,kr,E);if(!I)return`>${k}
${c}${S}`}return t=t.replace(/\n+/g,`$&${c}`),`|${k}
${c}${b}${t}${u}`}function Dh(s,e,t,i){const{type:n,value:r}=s,{actualString:a,implicitKey:o,indent:l,indentStep:c,inFlow:f}=e;if(o&&r.includes(`
`)||f&&/[[\]{},]/.test(r))return Ci(r,e);if(/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(r))return o||f||!r.includes(`
`)?Ci(r,e):tn(s,e,t,i);if(!o&&!f&&n!==Y.PLAIN&&r.includes(`
`))return tn(s,e,t,i);if(Dn(r)){if(l==="")return e.forceBlockIndent=!0,tn(s,e,t,i);if(o&&l===c)return Ci(r,e)}const p=r.replace(/\n+/g,`$&
${l}`);if(a){const d=h=>{var m;return h.default&&h.tag!=="tag:yaml.org,2002:str"&&((m=h.test)==null?void 0:m.test(p))},{compat:u,tags:g}=e.doc.schema;if(g.some(d)||u!=null&&u.some(d))return Ci(r,e)}return o?p:Nn(p,l,fl,Ln(e,!1))}function xs(s,e,t,i){const{implicitKey:n,inFlow:r}=e,a=typeof s.value=="string"?s:Object.assign({},s,{value:String(s.value)});let{type:o}=s;o!==Y.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(a.value)&&(o=Y.QUOTE_DOUBLE);const l=f=>{switch(f){case Y.BLOCK_FOLDED:case Y.BLOCK_LITERAL:return n||r?Ci(a.value,e):tn(a,e,t,i);case Y.QUOTE_DOUBLE:return ps(a.value,e);case Y.QUOTE_SINGLE:return yr(a.value,e);case Y.PLAIN:return Dh(a,e,t,i);default:return null}};let c=l(o);if(c===null){const{defaultKeyType:f,defaultStringType:p}=e.options,d=n&&f||p;if(c=l(d),c===null)throw new Error(`Unsupported default string type ${d}`)}return c}function hl(s,e){const t=Object.assign({blockQuote:!0,commentString:Nh,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},s.schema.toStringOptions,e);let i;switch(t.collectionStyle){case"block":i=!1;break;case"flow":i=!0;break;default:i=null}return{anchors:new Set,doc:s,flowCollectionPadding:t.flowCollectionPadding?" ":"",indent:"",indentStep:typeof t.indent=="number"?" ".repeat(t.indent):"  ",inFlow:i,options:t}}function Fh(s,e){var n;if(e.tag){const r=s.filter(a=>a.tag===e.tag);if(r.length>0)return r.find(a=>a.format===e.format)??r[0]}let t,i;if(ge(e)){i=e.value;let r=s.filter(a=>{var o;return(o=a.identify)==null?void 0:o.call(a,i)});if(r.length>1){const a=r.filter(o=>o.test);a.length>0&&(r=a)}t=r.find(a=>a.format===e.format)??r.find(a=>!a.format)}else i=e,t=s.find(r=>r.nodeClass&&i instanceof r.nodeClass);if(!t){const r=((n=i==null?void 0:i.constructor)==null?void 0:n.name)??(i===null?"null":typeof i);throw new Error(`Tag not resolved for ${r} value`)}return t}function xh(s,e,{anchors:t,doc:i}){if(!i.directives)return"";const n=[],r=(ge(s)||Ie(s))&&s.anchor;r&&ol(r)&&(t.add(r),n.push(`&${r}`));const a=s.tag??(e.default?null:e.tag);return a&&n.push(i.directives.tagString(a)),n.join(" ")}function Bi(s,e,t,i){var l;if(we(s))return s.toString(e,t,i);if(ai(s)){if(e.doc.directives)return s.toString(e);if((l=e.resolvedAliases)!=null&&l.has(s))throw new TypeError("Cannot stringify circular structure without alias nodes");e.resolvedAliases?e.resolvedAliases.add(s):e.resolvedAliases=new Set([s]),s=s.resolve(e.doc)}let n;const r=_e(s)?s:e.doc.createNode(s,{onTagObj:c=>n=c});n??(n=Fh(e.doc.schema.tags,r));const a=xh(r,n,e);a.length>0&&(e.indentAtStart=(e.indentAtStart??0)+a.length+1);const o=typeof n.stringify=="function"?n.stringify(r,e,t,i):ge(r)?xs(r,e,t,i):r.toString(e,t,i);return a?ge(r)||o[0]==="{"||o[0]==="["?`${a} ${o}`:`${a}
${e.indent}${o}`:o}function $h({key:s,value:e},t,i,n){const{allNullValues:r,doc:a,indent:o,indentStep:l,options:{commentString:c,indentSeq:f,simpleKeys:p}}=t;let d=_e(s)&&s.comment||null;if(p){if(d)throw new Error("With simple keys, key nodes cannot have comments");if(Ie(s)||!_e(s)&&typeof s=="object"){const E="With simple keys, collection cannot be used as a key value";throw new Error(E)}}let u=!p&&(!s||d&&e==null&&!t.inFlow||Ie(s)||(ge(s)?s.type===Y.BLOCK_FOLDED||s.type===Y.BLOCK_LITERAL:typeof s=="object"));t=Object.assign({},t,{allNullValues:!1,implicitKey:!u&&(p||!r),indent:o+l});let g=!1,h=!1,m=Bi(s,t,()=>g=!0,()=>h=!0);if(!u&&!t.inFlow&&m.length>1024){if(p)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");u=!0}if(t.inFlow){if(r||e==null)return g&&i&&i(),m===""?"?":u?`? ${m}`:m}else if(r&&!p||e==null&&u)return m=`? ${m}`,d&&!g?m+=ci(m,t.indent,c(d)):h&&n&&n(),m;g&&(d=null),u?(d&&(m+=ci(m,t.indent,c(d))),m=`? ${m}
${o}:`):(m=`${m}:`,d&&(m+=ci(m,t.indent,c(d))));let v,b,w;_e(e)?(v=!!e.spaceBefore,b=e.commentBefore,w=e.comment):(v=!1,b=null,w=null,e&&typeof e=="object"&&(e=a.createNode(e))),t.implicitKey=!1,!u&&!d&&ge(e)&&(t.indentAtStart=m.length+1),h=!1,!f&&l.length>=2&&!t.inFlow&&!u&&Xi(e)&&!e.flow&&!e.tag&&!e.anchor&&(t.indent=t.indent.substring(2));let k=!1;const T=Bi(e,t,()=>k=!0,()=>h=!0);let I=" ";if(d||v||b){if(I=v?`
`:"",b){const E=c(b);I+=`
${Mt(E,t.indent)}`}T===""&&!t.inFlow?I===`
`&&(I=`

`):I+=`
${t.indent}`}else if(!u&&Ie(e)){const E=T[0],S=T.indexOf(`
`),L=S!==-1,A=t.inFlow??e.flow??e.items.length===0;if(L||!A){let _=!1;if(L&&(E==="&"||E==="!")){let C=T.indexOf(" ");E==="&"&&C!==-1&&C<S&&T[C+1]==="!"&&(C=T.indexOf(" ",C+1)),(C===-1||S<C)&&(_=!0)}_||(I=`
${t.indent}`)}}else(T===""||T[0]===`
`)&&(I="");return m+=I+T,t.inFlow?k&&i&&i():w&&!k?m+=ci(m,t.indent,c(w)):h&&n&&n(),m}function pl(s,e){(s==="debug"||s==="warn")&&console.warn(e)}const Vs="<<",Bt={identify:s=>s===Vs||typeof s=="symbol"&&s.description===Vs,default:"key",tag:"tag:yaml.org,2002:merge",test:/^<<$/,resolve:()=>Object.assign(new Y(Symbol(Vs)),{addToJSMap:gl}),stringify:()=>Vs},Mh=(s,e)=>(Bt.identify(e)||ge(e)&&(!e.type||e.type===Y.PLAIN)&&Bt.identify(e.value))&&(s==null?void 0:s.doc.schema.tags.some(t=>t.tag===Bt.tag&&t.default));function gl(s,e,t){if(t=s&&ai(t)?t.resolve(s.doc):t,Xi(t))for(const i of t.items)Zn(s,e,i);else if(Array.isArray(t))for(const i of t)Zn(s,e,i);else Zn(s,e,t)}function Zn(s,e,t){const i=s&&ai(t)?t.resolve(s.doc):t;if(!Ji(i))throw new Error("Merge sources must be maps or map aliases");const n=i.toJSON(null,s,Map);for(const[r,a]of n)e instanceof Map?e.has(r)||e.set(r,a):e instanceof Set?e.add(r):Object.prototype.hasOwnProperty.call(e,r)||Object.defineProperty(e,r,{value:a,writable:!0,enumerable:!0,configurable:!0});return e}function ml(s,e,{key:t,value:i}){if(_e(t)&&t.addToJSMap)t.addToJSMap(s,e,i);else if(Mh(s,t))gl(s,e,i);else{const n=pt(t,"",s);if(e instanceof Map)e.set(n,pt(i,n,s));else if(e instanceof Set)e.add(n);else{const r=jh(t,n,s),a=pt(i,r,s);r in e?Object.defineProperty(e,r,{value:a,writable:!0,enumerable:!0,configurable:!0}):e[r]=a}}return e}function jh(s,e,t){if(e===null)return"";if(typeof e!="object")return String(e);if(_e(s)&&(t!=null&&t.doc)){const i=hl(t.doc,{});i.anchors=new Set;for(const r of t.anchors.keys())i.anchors.add(r.anchor);i.inFlow=!0,i.inStringifyKey=!0;const n=s.toString(i);if(!t.mapKeyWarned){let r=JSON.stringify(n);r.length>40&&(r=r.substring(0,36)+'..."'),pl(t.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${r}. Set mapAsMap: true to use object keys.`),t.mapKeyWarned=!0}return n}return JSON.stringify(e)}function Vr(s,e,t){const i=Ts(s,void 0,t),n=Ts(e,void 0,t);return new Ue(i,n)}class Ue{constructor(e,t=null){Object.defineProperty(this,bt,{value:tl}),this.key=e,this.value=t}clone(e){let{key:t,value:i}=this;return _e(t)&&(t=t.clone(e)),_e(i)&&(i=i.clone(e)),new Ue(t,i)}toJSON(e,t){const i=t!=null&&t.mapAsMap?new Map:{};return ml(t,i,this)}toString(e,t,i){return e!=null&&e.doc?$h(this,e,t,i):JSON.stringify(this)}}function vl(s,e,t){return(e.inFlow??s.flow?Bh:Rh)(s,e,t)}function Rh({comment:s,items:e},t,{blockItemPrefix:i,flowChars:n,itemIndent:r,onChompKeep:a,onComment:o}){const{indent:l,options:{commentString:c}}=t,f=Object.assign({},t,{indent:r,type:null});let p=!1;const d=[];for(let g=0;g<e.length;++g){const h=e[g];let m=null;if(_e(h))!p&&h.spaceBefore&&d.push(""),mn(t,d,h.commentBefore,p),h.comment&&(m=h.comment);else if(we(h)){const b=_e(h.key)?h.key:null;b&&(!p&&b.spaceBefore&&d.push(""),mn(t,d,b.commentBefore,p))}p=!1;let v=Bi(h,f,()=>m=null,()=>p=!0);m&&(v+=ci(v,r,c(m))),p&&m&&(p=!1),d.push(i+v)}let u;if(d.length===0)u=n.start+n.end;else{u=d[0];for(let g=1;g<d.length;++g){const h=d[g];u+=h?`
${l}${h}`:`
`}}return s?(u+=`
`+Mt(c(s),l),o&&o()):p&&a&&a(),u}function Bh({items:s},e,{flowChars:t,itemIndent:i}){const{indent:n,indentStep:r,flowCollectionPadding:a,options:{commentString:o}}=e;i+=r;const l=Object.assign({},e,{indent:i,inFlow:!0,type:null});let c=!1,f=0;const p=[];for(let g=0;g<s.length;++g){const h=s[g];let m=null;if(_e(h))h.spaceBefore&&p.push(""),mn(e,p,h.commentBefore,!1),h.comment&&(m=h.comment);else if(we(h)){const b=_e(h.key)?h.key:null;b&&(b.spaceBefore&&p.push(""),mn(e,p,b.commentBefore,!1),b.comment&&(c=!0));const w=_e(h.value)?h.value:null;w?(w.comment&&(m=w.comment),w.commentBefore&&(c=!0)):h.value==null&&(b!=null&&b.comment)&&(m=b.comment)}m&&(c=!0);let v=Bi(h,l,()=>m=null);g<s.length-1&&(v+=","),m&&(v+=ci(v,i,o(m))),!c&&(p.length>f||v.includes(`
`))&&(c=!0),p.push(v),f=p.length}const{start:d,end:u}=t;if(p.length===0)return d+u;if(!c){const g=p.reduce((h,m)=>h+m.length+2,2);c=e.options.lineWidth>0&&g>e.options.lineWidth}if(c){let g=d;for(const h of p)g+=h?`
${r}${n}${h}`:`
`;return`${g}
${n}${u}`}else return`${d}${a}${p.join(" ")}${a}${u}`}function mn({indent:s,options:{commentString:e}},t,i,n){if(i&&n&&(i=i.replace(/^\n+/,"")),i){const r=Mt(e(i),s);t.push(r.trimStart())}}function ui(s,e){const t=ge(e)?e.value:e;for(const i of s)if(we(i)&&(i.key===e||i.key===t||ge(i.key)&&i.key.value===t))return i}class nt extends dl{static get tagName(){return"tag:yaml.org,2002:map"}constructor(e){super(Qt,e),this.items=[]}static from(e,t,i){const{keepUndefined:n,replacer:r}=i,a=new this(e),o=(l,c)=>{if(typeof r=="function")c=r.call(t,l,c);else if(Array.isArray(r)&&!r.includes(l))return;(c!==void 0||n)&&a.items.push(Vr(l,c,i))};if(t instanceof Map)for(const[l,c]of t)o(l,c);else if(t&&typeof t=="object")for(const l of Object.keys(t))o(l,t[l]);return typeof e.sortMapEntries=="function"&&a.items.sort(e.sortMapEntries),a}add(e,t){var a;let i;we(e)?i=e:!e||typeof e!="object"||!("key"in e)?i=new Ue(e,e==null?void 0:e.value):i=new Ue(e.key,e.value);const n=ui(this.items,i.key),r=(a=this.schema)==null?void 0:a.sortMapEntries;if(n){if(!t)throw new Error(`Key ${i.key} already set`);ge(n.value)&&ul(i.value)?n.value.value=i.value:n.value=i.value}else if(r){const o=this.items.findIndex(l=>r(i,l)<0);o===-1?this.items.push(i):this.items.splice(o,0,i)}else this.items.push(i)}delete(e){const t=ui(this.items,e);return t?this.items.splice(this.items.indexOf(t),1).length>0:!1}get(e,t){const i=ui(this.items,e),n=i==null?void 0:i.value;return(!t&&ge(n)?n.value:n)??void 0}has(e){return!!ui(this.items,e)}set(e,t){this.add(new Ue(e,t),!0)}toJSON(e,t,i){const n=i?new i:t!=null&&t.mapAsMap?new Map:{};t!=null&&t.onCreate&&t.onCreate(n);for(const r of this.items)ml(t,n,r);return n}toString(e,t,i){if(!e)return JSON.stringify(this);for(const n of this.items)if(!we(n))throw new Error(`Map items must all be pairs; found ${JSON.stringify(n)} instead`);return!e.allNullValues&&this.hasAllNullValues(!1)&&(e=Object.assign({},e,{allNullValues:!0})),vl(this,e,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:e.indent||"",onChompKeep:i,onComment:t})}}const Qi={collection:"map",default:!0,nodeClass:nt,tag:"tag:yaml.org,2002:map",resolve(s,e){return Ji(s)||e("Expected a mapping for this tag"),s},createNode:(s,e,t)=>nt.from(s,e,t)};class si extends dl{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(e){super(Yi,e),this.items=[]}add(e){this.items.push(e)}delete(e){const t=zs(e);return typeof t!="number"?!1:this.items.splice(t,1).length>0}get(e,t){const i=zs(e);if(typeof i!="number")return;const n=this.items[i];return!t&&ge(n)?n.value:n}has(e){const t=zs(e);return typeof t=="number"&&t<this.items.length}set(e,t){const i=zs(e);if(typeof i!="number")throw new Error(`Expected a valid index, not ${e}.`);const n=this.items[i];ge(n)&&ul(t)?n.value=t:this.items[i]=t}toJSON(e,t){const i=[];t!=null&&t.onCreate&&t.onCreate(i);let n=0;for(const r of this.items)i.push(pt(r,String(n++),t));return i}toString(e,t,i){return e?vl(this,e,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(e.indent||"")+"  ",onChompKeep:i,onComment:t}):JSON.stringify(this)}static from(e,t,i){const{replacer:n}=i,r=new this(e);if(t&&Symbol.iterator in Object(t)){let a=0;for(let o of t){if(typeof n=="function"){const l=t instanceof Set?o:String(a++);o=n.call(t,l,o)}r.items.push(Ts(o,void 0,i))}}return r}}function zs(s){let e=ge(s)?s.value:s;return e&&typeof e=="string"&&(e=Number(e)),typeof e=="number"&&Number.isInteger(e)&&e>=0?e:null}const Zi={collection:"seq",default:!0,nodeClass:si,tag:"tag:yaml.org,2002:seq",resolve(s,e){return Xi(s)||e("Expected a sequence for this tag"),s},createNode:(s,e,t)=>si.from(s,e,t)},Fn={identify:s=>typeof s=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:s=>s,stringify(s,e,t,i){return e=Object.assign({actualString:!0},e),xs(s,e,t,i)}},xn={identify:s=>s==null,createNode:()=>new Y(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new Y(null),stringify:({source:s},e)=>typeof s=="string"&&xn.test.test(s)?s:e.options.nullStr},zr={identify:s=>typeof s=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:s=>new Y(s[0]==="t"||s[0]==="T"),stringify({source:s,value:e},t){if(s&&zr.test.test(s)){const i=s[0]==="t"||s[0]==="T";if(e===i)return s}return e?t.options.trueStr:t.options.falseStr}};function Pt({format:s,minFractionDigits:e,tag:t,value:i}){if(typeof i=="bigint")return String(i);const n=typeof i=="number"?i:Number(i);if(!isFinite(n))return isNaN(n)?".nan":n<0?"-.inf":".inf";let r=JSON.stringify(i);if(!s&&e&&(!t||t==="tag:yaml.org,2002:float")&&/^\d/.test(r)){let a=r.indexOf(".");a<0&&(a=r.length,r+=".");let o=e-(r.length-a-1);for(;o-- >0;)r+="0"}return r}const kl={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:s=>s.slice(-3).toLowerCase()==="nan"?NaN:s[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:Pt},yl={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:s=>parseFloat(s),stringify(s){const e=Number(s.value);return isFinite(e)?e.toExponential():Pt(s)}},wl={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(s){const e=new Y(parseFloat(s)),t=s.indexOf(".");return t!==-1&&s[s.length-1]==="0"&&(e.minFractionDigits=s.length-t-1),e},stringify:Pt},$n=s=>typeof s=="bigint"||Number.isInteger(s),Gr=(s,e,t,{intAsBigInt:i})=>i?BigInt(s):parseInt(s.substring(e),t);function bl(s,e,t){const{value:i}=s;return $n(i)&&i>=0?t+i.toString(e):Pt(s)}const Tl={identify:s=>$n(s)&&s>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(s,e,t)=>Gr(s,2,8,t),stringify:s=>bl(s,8,"0o")},Il={identify:$n,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(s,e,t)=>Gr(s,0,10,t),stringify:Pt},_l={identify:s=>$n(s)&&s>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(s,e,t)=>Gr(s,2,16,t),stringify:s=>bl(s,16,"0x")},Uh=[Qi,Zi,Fn,xn,zr,Tl,Il,_l,kl,yl,wl];function ja(s){return typeof s=="bigint"||Number.isInteger(s)}const Gs=({value:s})=>JSON.stringify(s),qh=[{identify:s=>typeof s=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:s=>s,stringify:Gs},{identify:s=>s==null,createNode:()=>new Y(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:Gs},{identify:s=>typeof s=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^true$|^false$/,resolve:s=>s==="true",stringify:Gs},{identify:ja,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(s,e,{intAsBigInt:t})=>t?BigInt(s):parseInt(s,10),stringify:({value:s})=>ja(s)?s.toString():JSON.stringify(s)},{identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:s=>parseFloat(s),stringify:Gs}],Hh={default:!0,tag:"",test:/^/,resolve(s,e){return e(`Unresolved plain scalar ${JSON.stringify(s)}`),s}},Kh=[Qi,Zi].concat(qh,Hh),Wr={identify:s=>s instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(s,e){if(typeof atob=="function"){const t=atob(s.replace(/[\n\r]/g,"")),i=new Uint8Array(t.length);for(let n=0;n<t.length;++n)i[n]=t.charCodeAt(n);return i}else return e("This environment does not support reading binary tags; either Buffer or atob is required"),s},stringify({comment:s,type:e,value:t},i,n,r){if(!t)return"";const a=t;let o;if(typeof btoa=="function"){let l="";for(let c=0;c<a.length;++c)l+=String.fromCharCode(a[c]);o=btoa(l)}else throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");if(e??(e=Y.BLOCK_LITERAL),e!==Y.QUOTE_DOUBLE){const l=Math.max(i.options.lineWidth-i.indent.length,i.options.minContentWidth),c=Math.ceil(o.length/l),f=new Array(c);for(let p=0,d=0;p<c;++p,d+=l)f[p]=o.substr(d,l);o=f.join(e===Y.BLOCK_LITERAL?`
`:" ")}return xs({comment:s,type:e,value:o},i,n,r)}};function Sl(s,e){if(Xi(s))for(let t=0;t<s.items.length;++t){let i=s.items[t];if(!we(i)){if(Ji(i)){i.items.length>1&&e("Each pair must have its own sequence indicator");const n=i.items[0]||new Ue(new Y(null));if(i.commentBefore&&(n.key.commentBefore=n.key.commentBefore?`${i.commentBefore}
${n.key.commentBefore}`:i.commentBefore),i.comment){const r=n.value??n.key;r.comment=r.comment?`${i.comment}
${r.comment}`:i.comment}i=n}s.items[t]=we(i)?i:new Ue(i)}}else e("Expected a sequence for this tag");return s}function Pl(s,e,t){const{replacer:i}=t,n=new si(s);n.tag="tag:yaml.org,2002:pairs";let r=0;if(e&&Symbol.iterator in Object(e))for(let a of e){typeof i=="function"&&(a=i.call(e,String(r++),a));let o,l;if(Array.isArray(a))if(a.length===2)o=a[0],l=a[1];else throw new TypeError(`Expected [key, value] tuple: ${a}`);else if(a&&a instanceof Object){const c=Object.keys(a);if(c.length===1)o=c[0],l=a[o];else throw new TypeError(`Expected tuple with one key, not ${c.length} keys`)}else o=a;n.items.push(Vr(o,l,t))}return n}const Yr={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:Sl,createNode:Pl};class Li extends si{constructor(){super(),this.add=nt.prototype.add.bind(this),this.delete=nt.prototype.delete.bind(this),this.get=nt.prototype.get.bind(this),this.has=nt.prototype.has.bind(this),this.set=nt.prototype.set.bind(this),this.tag=Li.tag}toJSON(e,t){if(!t)return super.toJSON(e);const i=new Map;t!=null&&t.onCreate&&t.onCreate(i);for(const n of this.items){let r,a;if(we(n)?(r=pt(n.key,"",t),a=pt(n.value,r,t)):r=pt(n,"",t),i.has(r))throw new Error("Ordered maps must not include duplicate keys");i.set(r,a)}return i}static from(e,t,i){const n=Pl(e,t,i),r=new this;return r.items=n.items,r}}Li.tag="tag:yaml.org,2002:omap";const Jr={collection:"seq",identify:s=>s instanceof Map,nodeClass:Li,default:!1,tag:"tag:yaml.org,2002:omap",resolve(s,e){const t=Sl(s,e),i=[];for(const{key:n}of t.items)ge(n)&&(i.includes(n.value)?e(`Ordered maps must not include duplicate keys: ${n.value}`):i.push(n.value));return Object.assign(new Li,t)},createNode:(s,e,t)=>Li.from(s,e,t)};function El({value:s,source:e},t){return e&&(s?Ol:Cl).test.test(e)?e:s?t.options.trueStr:t.options.falseStr}const Ol={identify:s=>s===!0,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new Y(!0),stringify:El},Cl={identify:s=>s===!1,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,resolve:()=>new Y(!1),stringify:El},Vh={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:s=>s.slice(-3).toLowerCase()==="nan"?NaN:s[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:Pt},zh={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:s=>parseFloat(s.replace(/_/g,"")),stringify(s){const e=Number(s.value);return isFinite(e)?e.toExponential():Pt(s)}},Gh={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(s){const e=new Y(parseFloat(s.replace(/_/g,""))),t=s.indexOf(".");if(t!==-1){const i=s.substring(t+1).replace(/_/g,"");i[i.length-1]==="0"&&(e.minFractionDigits=i.length)}return e},stringify:Pt},$s=s=>typeof s=="bigint"||Number.isInteger(s);function Mn(s,e,t,{intAsBigInt:i}){const n=s[0];if((n==="-"||n==="+")&&(e+=1),s=s.substring(e).replace(/_/g,""),i){switch(t){case 2:s=`0b${s}`;break;case 8:s=`0o${s}`;break;case 16:s=`0x${s}`;break}const a=BigInt(s);return n==="-"?BigInt(-1)*a:a}const r=parseInt(s,t);return n==="-"?-1*r:r}function Xr(s,e,t){const{value:i}=s;if($s(i)){const n=i.toString(e);return i<0?"-"+t+n.substr(1):t+n}return Pt(s)}const Wh={identify:$s,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(s,e,t)=>Mn(s,2,2,t),stringify:s=>Xr(s,2,"0b")},Yh={identify:$s,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(s,e,t)=>Mn(s,1,8,t),stringify:s=>Xr(s,8,"0")},Jh={identify:$s,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(s,e,t)=>Mn(s,0,10,t),stringify:Pt},Xh={identify:$s,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(s,e,t)=>Mn(s,2,16,t),stringify:s=>Xr(s,16,"0x")};class Di extends nt{constructor(e){super(e),this.tag=Di.tag}add(e){let t;we(e)?t=e:e&&typeof e=="object"&&"key"in e&&"value"in e&&e.value===null?t=new Ue(e.key,null):t=new Ue(e,null),ui(this.items,t.key)||this.items.push(t)}get(e,t){const i=ui(this.items,e);return!t&&we(i)?ge(i.key)?i.key.value:i.key:i}set(e,t){if(typeof t!="boolean")throw new Error(`Expected boolean value for set(key, value) in a YAML set, not ${typeof t}`);const i=ui(this.items,e);i&&!t?this.items.splice(this.items.indexOf(i),1):!i&&t&&this.items.push(new Ue(e))}toJSON(e,t){return super.toJSON(e,t,Set)}toString(e,t,i){if(!e)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},e,{allNullValues:!0}),t,i);throw new Error("Set items must all have null values")}static from(e,t,i){const{replacer:n}=i,r=new this(e);if(t&&Symbol.iterator in Object(t))for(let a of t)typeof n=="function"&&(a=n.call(t,a,a)),r.items.push(Vr(a,null,i));return r}}Di.tag="tag:yaml.org,2002:set";const Qr={collection:"map",identify:s=>s instanceof Set,nodeClass:Di,default:!1,tag:"tag:yaml.org,2002:set",createNode:(s,e,t)=>Di.from(s,e,t),resolve(s,e){if(Ji(s)){if(s.hasAllNullValues(!0))return Object.assign(new Di,s);e("Set items must all have null values")}else e("Expected a mapping for this tag");return s}};function Zr(s,e){const t=s[0],i=t==="-"||t==="+"?s.substring(1):s,n=a=>e?BigInt(a):Number(a),r=i.replace(/_/g,"").split(":").reduce((a,o)=>a*n(60)+n(o),n(0));return t==="-"?n(-1)*r:r}function Al(s){let{value:e}=s,t=a=>a;if(typeof e=="bigint")t=a=>BigInt(a);else if(isNaN(e)||!isFinite(e))return Pt(s);let i="";e<0&&(i="-",e*=t(-1));const n=t(60),r=[e%n];return e<60?r.unshift(0):(e=(e-r[0])/n,r.unshift(e%n),e>=60&&(e=(e-r[0])/n,r.unshift(e))),i+r.map(a=>String(a).padStart(2,"0")).join(":").replace(/000000\d*$/,"")}const Nl={identify:s=>typeof s=="bigint"||Number.isInteger(s),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(s,e,{intAsBigInt:t})=>Zr(s,t),stringify:Al},Ll={identify:s=>typeof s=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:s=>Zr(s,!1),stringify:Al},jn={identify:s=>s instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(s){const e=s.match(jn.test);if(!e)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");const[,t,i,n,r,a,o]=e.map(Number),l=e[7]?Number((e[7]+"00").substr(1,3)):0;let c=Date.UTC(t,i-1,n,r||0,a||0,o||0,l);const f=e[8];if(f&&f!=="Z"){let p=Zr(f,!1);Math.abs(p)<30&&(p*=60),c-=6e4*p}return new Date(c)},stringify:({value:s})=>(s==null?void 0:s.toISOString().replace(/(T00:00:00)?\.000Z$/,""))??""},Ra=[Qi,Zi,Fn,xn,Ol,Cl,Wh,Yh,Jh,Xh,Vh,zh,Gh,Wr,Bt,Jr,Yr,Qr,Nl,Ll,jn],Ba=new Map([["core",Uh],["failsafe",[Qi,Zi,Fn]],["json",Kh],["yaml11",Ra],["yaml-1.1",Ra]]),Ua={binary:Wr,bool:zr,float:wl,floatExp:yl,floatNaN:kl,floatTime:Ll,int:Il,intHex:_l,intOct:Tl,intTime:Nl,map:Qi,merge:Bt,null:xn,omap:Jr,pairs:Yr,seq:Zi,set:Qr,timestamp:jn},Qh={"tag:yaml.org,2002:binary":Wr,"tag:yaml.org,2002:merge":Bt,"tag:yaml.org,2002:omap":Jr,"tag:yaml.org,2002:pairs":Yr,"tag:yaml.org,2002:set":Qr,"tag:yaml.org,2002:timestamp":jn};function er(s,e,t){const i=Ba.get(e);if(i&&!s)return t&&!i.includes(Bt)?i.concat(Bt):i.slice();let n=i;if(!n)if(Array.isArray(s))n=[];else{const r=Array.from(Ba.keys()).filter(a=>a!=="yaml11").map(a=>JSON.stringify(a)).join(", ");throw new Error(`Unknown schema "${e}"; use one of ${r} or define customTags array`)}if(Array.isArray(s))for(const r of s)n=n.concat(r);else typeof s=="function"&&(n=s(n.slice()));return t&&(n=n.concat(Bt)),n.reduce((r,a)=>{const o=typeof a=="string"?Ua[a]:a;if(!o){const l=JSON.stringify(a),c=Object.keys(Ua).map(f=>JSON.stringify(f)).join(", ");throw new Error(`Unknown custom tag ${l}; use one of ${c}`)}return r.includes(o)||r.push(o),r},[])}const Zh=(s,e)=>s.key<e.key?-1:s.key>e.key?1:0;class Rn{constructor({compat:e,customTags:t,merge:i,resolveKnownTags:n,schema:r,sortMapEntries:a,toStringDefaults:o}){this.compat=Array.isArray(e)?er(e,"compat"):e?er(null,e):null,this.name=typeof r=="string"&&r||"core",this.knownTags=n?Qh:{},this.tags=er(t,this.name,i),this.toStringOptions=o??null,Object.defineProperty(this,Qt,{value:Qi}),Object.defineProperty(this,Ft,{value:Fn}),Object.defineProperty(this,Yi,{value:Zi}),this.sortMapEntries=typeof a=="function"?a:a===!0?Zh:null}clone(){const e=Object.create(Rn.prototype,Object.getOwnPropertyDescriptors(this));return e.tags=this.tags.slice(),e}}function ep(s,e){var l;const t=[];let i=e.directives===!0;if(e.directives!==!1&&s.directives){const c=s.directives.toString(s);c?(t.push(c),i=!0):s.directives.docStart&&(i=!0)}i&&t.push("---");const n=hl(s,e),{commentString:r}=n.options;if(s.commentBefore){t.length!==1&&t.unshift("");const c=r(s.commentBefore);t.unshift(Mt(c,""))}let a=!1,o=null;if(s.contents){if(_e(s.contents)){if(s.contents.spaceBefore&&i&&t.push(""),s.contents.commentBefore){const p=r(s.contents.commentBefore);t.push(Mt(p,""))}n.forceBlockIndent=!!s.comment,o=s.contents.comment}const c=o?void 0:()=>a=!0;let f=Bi(s.contents,n,()=>o=null,c);o&&(f+=ci(f,"",r(o))),(f[0]==="|"||f[0]===">")&&t[t.length-1]==="---"?t[t.length-1]=`--- ${f}`:t.push(f)}else t.push(Bi(s.contents,n));if((l=s.directives)!=null&&l.docEnd)if(s.comment){const c=r(s.comment);c.includes(`
`)?(t.push("..."),t.push(Mt(c,""))):t.push(`... ${c}`)}else t.push("...");else{let c=s.comment;c&&a&&(c=c.replace(/^\n+/,"")),c&&((!a||o)&&t[t.length-1]!==""&&t.push(""),t.push(Mt(r(c),"")))}return t.join(`
`)+`
`}class es{constructor(e,t,i){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,bt,{value:vr});let n=null;typeof t=="function"||Array.isArray(t)?n=t:i===void 0&&t&&(i=t,t=void 0);const r=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,stringKeys:!1,uniqueKeys:!0,version:"1.2"},i);this.options=r;let{version:a}=r;i!=null&&i._directives?(this.directives=i._directives.atDocument(),this.directives.yaml.explicit&&(a=this.directives.yaml.version)):this.directives=new Ke({version:a}),this.setSchema(a,i),this.contents=e===void 0?null:this.createNode(e,n,i)}clone(){const e=Object.create(es.prototype,{[bt]:{value:vr}});return e.commentBefore=this.commentBefore,e.comment=this.comment,e.errors=this.errors.slice(),e.warnings=this.warnings.slice(),e.options=Object.assign({},this.options),this.directives&&(e.directives=this.directives.clone()),e.schema=this.schema.clone(),e.contents=_e(this.contents)?this.contents.clone(e.schema):this.contents,this.range&&(e.range=this.range.slice()),e}add(e){Ii(this.contents)&&this.contents.add(e)}addIn(e,t){Ii(this.contents)&&this.contents.addIn(e,t)}createAlias(e,t){if(!e.anchor){const i=ll(this);e.anchor=!t||i.has(t)?cl(t||"a",i):t}return new An(e.anchor)}createNode(e,t,i){let n;if(typeof t=="function")e=t.call({"":e},"",e),n=t;else if(Array.isArray(t)){const m=b=>typeof b=="number"||b instanceof String||b instanceof Number,v=t.filter(m).map(String);v.length>0&&(t=t.concat(v)),n=t}else i===void 0&&t&&(i=t,t=void 0);const{aliasDuplicateObjects:r,anchorPrefix:a,flow:o,keepUndefined:l,onTagObj:c,tag:f}=i??{},{onAnchor:p,setAnchors:d,sourceObjects:u}=Oh(this,a||"a"),g={aliasDuplicateObjects:r??!0,keepUndefined:l??!1,onAnchor:p,onTagObj:c,replacer:n,schema:this.schema,sourceObjects:u},h=Ts(e,f,g);return o&&Ie(h)&&(h.flow=!0),d(),h}createPair(e,t,i={}){const n=this.createNode(e,null,i),r=this.createNode(t,null,i);return new Ue(n,r)}delete(e){return Ii(this.contents)?this.contents.delete(e):!1}deleteIn(e){return cs(e)?this.contents==null?!1:(this.contents=null,!0):Ii(this.contents)?this.contents.deleteIn(e):!1}get(e,t){return Ie(this.contents)?this.contents.get(e,t):void 0}getIn(e,t){return cs(e)?!t&&ge(this.contents)?this.contents.value:this.contents:Ie(this.contents)?this.contents.getIn(e,t):void 0}has(e){return Ie(this.contents)?this.contents.has(e):!1}hasIn(e){return cs(e)?this.contents!==void 0:Ie(this.contents)?this.contents.hasIn(e):!1}set(e,t){this.contents==null?this.contents=gn(this.schema,[e],t):Ii(this.contents)&&this.contents.set(e,t)}setIn(e,t){cs(e)?this.contents=t:this.contents==null?this.contents=gn(this.schema,Array.from(e),t):Ii(this.contents)&&this.contents.setIn(e,t)}setSchema(e,t={}){typeof e=="number"&&(e=String(e));let i;switch(e){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new Ke({version:"1.1"}),i={resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=e:this.directives=new Ke({version:e}),i={resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,i=null;break;default:{const n=JSON.stringify(e);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${n}`)}}if(t.schema instanceof Object)this.schema=t.schema;else if(i)this.schema=new Rn(Object.assign(i,t));else throw new Error("With a null YAML version, the { schema: Schema } option is required")}toJS({json:e,jsonArg:t,mapAsMap:i,maxAliasCount:n,onAnchor:r,reviver:a}={}){const o={anchors:new Map,doc:this,keep:!e,mapAsMap:i===!0,mapKeyWarned:!1,maxAliasCount:typeof n=="number"?n:100},l=pt(this.contents,t??"",o);if(typeof r=="function")for(const{count:c,res:f}of o.anchors.values())r(f,c);return typeof a=="function"?Oi(a,{"":l},"",l):l}toJSON(e,t){return this.toJS({json:!0,jsonArg:e,mapAsMap:!1,onAnchor:t})}toString(e={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in e&&(!Number.isInteger(e.indent)||Number(e.indent)<=0)){const t=JSON.stringify(e.indent);throw new Error(`"indent" option must be a positive integer, not ${t}`)}return ep(this,e)}}function Ii(s){if(Ie(s))return!0;throw new Error("Expected a YAML collection as document contents")}class ea extends Error{constructor(e,t,i,n){super(),this.name=e,this.code=i,this.message=n,this.pos=t}}class di extends ea{constructor(e,t,i){super("YAMLParseError",e,t,i)}}class Dl extends ea{constructor(e,t,i){super("YAMLWarning",e,t,i)}}const vn=(s,e)=>t=>{if(t.pos[0]===-1)return;t.linePos=t.pos.map(o=>e.linePos(o));const{line:i,col:n}=t.linePos[0];t.message+=` at line ${i}, column ${n}`;let r=n-1,a=s.substring(e.lineStarts[i-1],e.lineStarts[i]).replace(/[\n\r]+$/,"");if(r>=60&&a.length>80){const o=Math.min(r-39,a.length-79);a=""+a.substring(o),r-=o-1}if(a.length>80&&(a=a.substring(0,79)+""),i>1&&/^ *$/.test(a.substring(0,r))){let o=s.substring(e.lineStarts[i-2],e.lineStarts[i-1]);o.length>80&&(o=o.substring(0,79)+`
`),a=o+a}if(/[^ ]/.test(a)){let o=1;const l=t.linePos[1];l&&l.line===i&&l.col>n&&(o=Math.max(1,Math.min(l.col-n,80-r)));const c=" ".repeat(r)+"^".repeat(o);t.message+=`:

${a}
${c}
`}};function Ui(s,{flow:e,indicator:t,next:i,offset:n,onError:r,parentIndent:a,startOnNewline:o}){let l=!1,c=o,f=o,p="",d="",u=!1,g=!1,h=null,m=null,v=null,b=null,w=null,k=null,T=null;for(const S of s)switch(g&&(S.type!=="space"&&S.type!=="newline"&&S.type!=="comma"&&r(S.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),g=!1),h&&(c&&S.type!=="comment"&&S.type!=="newline"&&r(h,"TAB_AS_INDENT","Tabs are not allowed as indentation"),h=null),S.type){case"space":!e&&(t!=="doc-start"||(i==null?void 0:i.type)!=="flow-collection")&&S.source.includes("	")&&(h=S),f=!0;break;case"comment":{f||r(S,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const L=S.source.substring(1)||" ";p?p+=d+L:p=L,d="",c=!1;break}case"newline":c?p?p+=S.source:(!k||t!=="seq-item-ind")&&(l=!0):d+=S.source,c=!0,u=!0,(m||v)&&(b=S),f=!0;break;case"anchor":m&&r(S,"MULTIPLE_ANCHORS","A node can have at most one anchor"),S.source.endsWith(":")&&r(S.offset+S.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),m=S,T??(T=S.offset),c=!1,f=!1,g=!0;break;case"tag":{v&&r(S,"MULTIPLE_TAGS","A node can have at most one tag"),v=S,T??(T=S.offset),c=!1,f=!1,g=!0;break}case t:(m||v)&&r(S,"BAD_PROP_ORDER",`Anchors and tags must be after the ${S.source} indicator`),k&&r(S,"UNEXPECTED_TOKEN",`Unexpected ${S.source} in ${e??"collection"}`),k=S,c=t==="seq-item-ind"||t==="explicit-key-ind",f=!1;break;case"comma":if(e){w&&r(S,"UNEXPECTED_TOKEN",`Unexpected , in ${e}`),w=S,c=!1,f=!1;break}default:r(S,"UNEXPECTED_TOKEN",`Unexpected ${S.type} token`),c=!1,f=!1}const I=s[s.length-1],E=I?I.offset+I.source.length:n;return g&&i&&i.type!=="space"&&i.type!=="newline"&&i.type!=="comma"&&(i.type!=="scalar"||i.source!=="")&&r(i.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),h&&(c&&h.indent<=a||(i==null?void 0:i.type)==="block-map"||(i==null?void 0:i.type)==="block-seq")&&r(h,"TAB_AS_INDENT","Tabs are not allowed as indentation"),{comma:w,found:k,spaceBefore:l,comment:p,hasNewline:u,anchor:m,tag:v,newlineAfterProp:b,end:E,start:T??E}}function Is(s){if(!s)return null;switch(s.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(s.source.includes(`
`))return!0;if(s.end){for(const e of s.end)if(e.type==="newline")return!0}return!1;case"flow-collection":for(const e of s.items){for(const t of e.start)if(t.type==="newline")return!0;if(e.sep){for(const t of e.sep)if(t.type==="newline")return!0}if(Is(e.key)||Is(e.value))return!0}return!1;default:return!0}}function br(s,e,t){if((e==null?void 0:e.type)==="flow-collection"){const i=e.end[0];i.indent===s&&(i.source==="]"||i.source==="}")&&Is(e)&&t(i,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}function Fl(s,e,t){const{uniqueKeys:i}=s.options;if(i===!1)return!1;const n=typeof i=="function"?i:(r,a)=>r===a||ge(r)&&ge(a)&&r.value===a.value;return e.some(r=>n(r.key,t))}const qa="All mapping items must start at the same column";function tp({composeNode:s,composeEmptyNode:e},t,i,n,r){var f;const a=(r==null?void 0:r.nodeClass)??nt,o=new a(t.schema);t.atRoot&&(t.atRoot=!1);let l=i.offset,c=null;for(const p of i.items){const{start:d,key:u,sep:g,value:h}=p,m=Ui(d,{indicator:"explicit-key-ind",next:u??(g==null?void 0:g[0]),offset:l,onError:n,parentIndent:i.indent,startOnNewline:!0}),v=!m.found;if(v){if(u&&(u.type==="block-seq"?n(l,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in u&&u.indent!==i.indent&&n(l,"BAD_INDENT",qa)),!m.anchor&&!m.tag&&!g){c=m.end,m.comment&&(o.comment?o.comment+=`
`+m.comment:o.comment=m.comment);continue}(m.newlineAfterProp||Is(u))&&n(u??d[d.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else((f=m.found)==null?void 0:f.indent)!==i.indent&&n(l,"BAD_INDENT",qa);t.atKey=!0;const b=m.end,w=u?s(t,u,m,n):e(t,b,d,null,m,n);t.schema.compat&&br(i.indent,u,n),t.atKey=!1,Fl(t,o.items,w)&&n(b,"DUPLICATE_KEY","Map keys must be unique");const k=Ui(g??[],{indicator:"map-value-ind",next:h,offset:w.range[2],onError:n,parentIndent:i.indent,startOnNewline:!u||u.type==="block-scalar"});if(l=k.end,k.found){v&&((h==null?void 0:h.type)==="block-map"&&!k.hasNewline&&n(l,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),t.options.strict&&m.start<k.found.offset-1024&&n(w.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));const T=h?s(t,h,k,n):e(t,l,g,null,k,n);t.schema.compat&&br(i.indent,h,n),l=T.range[2];const I=new Ue(w,T);t.options.keepSourceTokens&&(I.srcToken=p),o.items.push(I)}else{v&&n(w.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),k.comment&&(w.comment?w.comment+=`
`+k.comment:w.comment=k.comment);const T=new Ue(w);t.options.keepSourceTokens&&(T.srcToken=p),o.items.push(T)}}return c&&c<l&&n(c,"IMPOSSIBLE","Map comment with trailing content"),o.range=[i.offset,l,c??l],o}function ip({composeNode:s,composeEmptyNode:e},t,i,n,r){const a=(r==null?void 0:r.nodeClass)??si,o=new a(t.schema);t.atRoot&&(t.atRoot=!1),t.atKey&&(t.atKey=!1);let l=i.offset,c=null;for(const{start:f,value:p}of i.items){const d=Ui(f,{indicator:"seq-item-ind",next:p,offset:l,onError:n,parentIndent:i.indent,startOnNewline:!0});if(!d.found)if(d.anchor||d.tag||p)p&&p.type==="block-seq"?n(d.end,"BAD_INDENT","All sequence items must start at the same column"):n(l,"MISSING_CHAR","Sequence item without - indicator");else{c=d.end,d.comment&&(o.comment=d.comment);continue}const u=p?s(t,p,d,n):e(t,d.end,f,null,d,n);t.schema.compat&&br(i.indent,p,n),l=u.range[2],o.items.push(u)}return o.range=[i.offset,l,c??l],o}function Ms(s,e,t,i){let n="";if(s){let r=!1,a="";for(const o of s){const{source:l,type:c}=o;switch(c){case"space":r=!0;break;case"comment":{t&&!r&&i(o,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const f=l.substring(1)||" ";n?n+=a+f:n=f,a="";break}case"newline":n&&(a+=l),r=!0;break;default:i(o,"UNEXPECTED_TOKEN",`Unexpected ${c} at node end`)}e+=l.length}}return{comment:n,offset:e}}const tr="Block collections are not allowed within flow collections",ir=s=>s&&(s.type==="block-map"||s.type==="block-seq");function sp({composeNode:s,composeEmptyNode:e},t,i,n,r){const a=i.start.source==="{",o=a?"flow map":"flow sequence",l=(r==null?void 0:r.nodeClass)??(a?nt:si),c=new l(t.schema);c.flow=!0;const f=t.atRoot;f&&(t.atRoot=!1),t.atKey&&(t.atKey=!1);let p=i.offset+i.start.source.length;for(let m=0;m<i.items.length;++m){const v=i.items[m],{start:b,key:w,sep:k,value:T}=v,I=Ui(b,{flow:o,indicator:"explicit-key-ind",next:w??(k==null?void 0:k[0]),offset:p,onError:n,parentIndent:i.indent,startOnNewline:!1});if(!I.found){if(!I.anchor&&!I.tag&&!k&&!T){m===0&&I.comma?n(I.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${o}`):m<i.items.length-1&&n(I.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${o}`),I.comment&&(c.comment?c.comment+=`
`+I.comment:c.comment=I.comment),p=I.end;continue}!a&&t.options.strict&&Is(w)&&n(w,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(m===0)I.comma&&n(I.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${o}`);else if(I.comma||n(I.start,"MISSING_CHAR",`Missing , between ${o} items`),I.comment){let E="";e:for(const S of b)switch(S.type){case"comma":case"space":break;case"comment":E=S.source.substring(1);break e;default:break e}if(E){let S=c.items[c.items.length-1];we(S)&&(S=S.value??S.key),S.comment?S.comment+=`
`+E:S.comment=E,I.comment=I.comment.substring(E.length+1)}}if(!a&&!k&&!I.found){const E=T?s(t,T,I,n):e(t,I.end,k,null,I,n);c.items.push(E),p=E.range[2],ir(T)&&n(E.range,"BLOCK_IN_FLOW",tr)}else{t.atKey=!0;const E=I.end,S=w?s(t,w,I,n):e(t,E,b,null,I,n);ir(w)&&n(S.range,"BLOCK_IN_FLOW",tr),t.atKey=!1;const L=Ui(k??[],{flow:o,indicator:"map-value-ind",next:T,offset:S.range[2],onError:n,parentIndent:i.indent,startOnNewline:!1});if(L.found){if(!a&&!I.found&&t.options.strict){if(k)for(const C of k){if(C===L.found)break;if(C.type==="newline"){n(C,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}I.start<L.found.offset-1024&&n(L.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else T&&("source"in T&&T.source&&T.source[0]===":"?n(T,"MISSING_CHAR",`Missing space after : in ${o}`):n(L.start,"MISSING_CHAR",`Missing , or : between ${o} items`));const A=T?s(t,T,L,n):L.found?e(t,L.end,k,null,L,n):null;A?ir(T)&&n(A.range,"BLOCK_IN_FLOW",tr):L.comment&&(S.comment?S.comment+=`
`+L.comment:S.comment=L.comment);const _=new Ue(S,A);if(t.options.keepSourceTokens&&(_.srcToken=v),a){const C=c;Fl(t,C.items,S)&&n(E,"DUPLICATE_KEY","Map keys must be unique"),C.items.push(_)}else{const C=new nt(t.schema);C.flow=!0,C.items.push(_);const D=(A??S).range;C.range=[S.range[0],D[1],D[2]],c.items.push(C)}p=A?A.range[2]:L.end}}const d=a?"}":"]",[u,...g]=i.end;let h=p;if(u&&u.source===d)h=u.offset+u.source.length;else{const m=o[0].toUpperCase()+o.substring(1),v=f?`${m} must end with a ${d}`:`${m} in block collection must be sufficiently indented and end with a ${d}`;n(p,f?"MISSING_CHAR":"BAD_INDENT",v),u&&u.source.length!==1&&g.unshift(u)}if(g.length>0){const m=Ms(g,h,t.options.strict,n);m.comment&&(c.comment?c.comment+=`
`+m.comment:c.comment=m.comment),c.range=[i.offset,h,m.offset]}else c.range=[i.offset,h,h];return c}function sr(s,e,t,i,n,r){const a=t.type==="block-map"?tp(s,e,t,i,r):t.type==="block-seq"?ip(s,e,t,i,r):sp(s,e,t,i,r),o=a.constructor;return n==="!"||n===o.tagName?(a.tag=o.tagName,a):(n&&(a.tag=n),a)}function np(s,e,t,i,n){var d;const r=i.tag,a=r?e.directives.tagName(r.source,u=>n(r,"TAG_RESOLVE_FAILED",u)):null;if(t.type==="block-seq"){const{anchor:u,newlineAfterProp:g}=i,h=u&&r?u.offset>r.offset?u:r:u??r;h&&(!g||g.offset<h.offset)&&n(h,"MISSING_CHAR","Missing newline after block sequence props")}const o=t.type==="block-map"?"map":t.type==="block-seq"?"seq":t.start.source==="{"?"map":"seq";if(!r||!a||a==="!"||a===nt.tagName&&o==="map"||a===si.tagName&&o==="seq")return sr(s,e,t,n,a);let l=e.schema.tags.find(u=>u.tag===a&&u.collection===o);if(!l){const u=e.schema.knownTags[a];if(u&&u.collection===o)e.schema.tags.push(Object.assign({},u,{default:!1})),l=u;else return u?n(r,"BAD_COLLECTION_TYPE",`${u.tag} used for ${o} collection, but expects ${u.collection??"scalar"}`,!0):n(r,"TAG_RESOLVE_FAILED",`Unresolved tag: ${a}`,!0),sr(s,e,t,n,a)}const c=sr(s,e,t,n,a,l),f=((d=l.resolve)==null?void 0:d.call(l,c,u=>n(r,"TAG_RESOLVE_FAILED",u),e.options))??c,p=_e(f)?f:new Y(f);return p.range=c.range,p.tag=a,l!=null&&l.format&&(p.format=l.format),p}function xl(s,e,t){const i=e.offset,n=rp(e,s.options.strict,t);if(!n)return{value:"",type:null,comment:"",range:[i,i,i]};const r=n.mode===">"?Y.BLOCK_FOLDED:Y.BLOCK_LITERAL,a=e.source?ap(e.source):[];let o=a.length;for(let h=a.length-1;h>=0;--h){const m=a[h][1];if(m===""||m==="\r")o=h;else break}if(o===0){const h=n.chomp==="+"&&a.length>0?`
`.repeat(Math.max(1,a.length-1)):"";let m=i+n.length;return e.source&&(m+=e.source.length),{value:h,type:r,comment:n.comment,range:[i,m,m]}}let l=e.indent+n.indent,c=e.offset+n.length,f=0;for(let h=0;h<o;++h){const[m,v]=a[h];if(v===""||v==="\r")n.indent===0&&m.length>l&&(l=m.length);else{m.length<l&&t(c+m.length,"MISSING_CHAR","Block scalars with more-indented leading empty lines must use an explicit indentation indicator"),n.indent===0&&(l=m.length),f=h,l===0&&!s.atRoot&&t(c,"BAD_INDENT","Block scalar values in collections must be indented");break}c+=m.length+v.length+1}for(let h=a.length-1;h>=o;--h)a[h][0].length>l&&(o=h+1);let p="",d="",u=!1;for(let h=0;h<f;++h)p+=a[h][0].slice(l)+`
`;for(let h=f;h<o;++h){let[m,v]=a[h];c+=m.length+v.length+1;const b=v[v.length-1]==="\r";if(b&&(v=v.slice(0,-1)),v&&m.length<l){const k=`Block scalar lines must not be less indented than their ${n.indent?"explicit indentation indicator":"first line"}`;t(c-v.length-(b?2:1),"BAD_INDENT",k),m=""}r===Y.BLOCK_LITERAL?(p+=d+m.slice(l)+v,d=`
`):m.length>l||v[0]==="	"?(d===" "?d=`
`:!u&&d===`
`&&(d=`

`),p+=d+m.slice(l)+v,d=`
`,u=!0):v===""?d===`
`?p+=`
`:d=`
`:(p+=d+v,d=" ",u=!1)}switch(n.chomp){case"-":break;case"+":for(let h=o;h<a.length;++h)p+=`
`+a[h][0].slice(l);p[p.length-1]!==`
`&&(p+=`
`);break;default:p+=`
`}const g=i+n.length+e.source.length;return{value:p,type:r,comment:n.comment,range:[i,g,g]}}function rp({offset:s,props:e},t,i){if(e[0].type!=="block-scalar-header")return i(e[0],"IMPOSSIBLE","Block scalar header not found"),null;const{source:n}=e[0],r=n[0];let a=0,o="",l=-1;for(let d=1;d<n.length;++d){const u=n[d];if(!o&&(u==="-"||u==="+"))o=u;else{const g=Number(u);!a&&g?a=g:l===-1&&(l=s+d)}}l!==-1&&i(l,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${n}`);let c=!1,f="",p=n.length;for(let d=1;d<e.length;++d){const u=e[d];switch(u.type){case"space":c=!0;case"newline":p+=u.source.length;break;case"comment":t&&!c&&i(u,"MISSING_CHAR","Comments must be separated from other tokens by white space characters"),p+=u.source.length,f=u.source.substring(1);break;case"error":i(u,"UNEXPECTED_TOKEN",u.message),p+=u.source.length;break;default:{const g=`Unexpected token in block scalar header: ${u.type}`;i(u,"UNEXPECTED_TOKEN",g);const h=u.source;h&&typeof h=="string"&&(p+=h.length)}}}return{mode:r,indent:a,chomp:o,comment:f,length:p}}function ap(s){const e=s.split(/\n( *)/),t=e[0],i=t.match(/^( *)/),r=[i!=null&&i[1]?[i[1],t.slice(i[1].length)]:["",t]];for(let a=1;a<e.length;a+=2)r.push([e[a],e[a+1]]);return r}function $l(s,e,t){const{offset:i,type:n,source:r,end:a}=s;let o,l;const c=(d,u,g)=>t(i+d,u,g);switch(n){case"scalar":o=Y.PLAIN,l=op(r,c);break;case"single-quoted-scalar":o=Y.QUOTE_SINGLE,l=lp(r,c);break;case"double-quoted-scalar":o=Y.QUOTE_DOUBLE,l=cp(r,c);break;default:return t(s,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${n}`),{value:"",type:null,comment:"",range:[i,i+r.length,i+r.length]}}const f=i+r.length,p=Ms(a,f,e,t);return{value:l,type:o,comment:p.comment,range:[i,f,p.offset]}}function op(s,e){let t="";switch(s[0]){case"	":t="a tab character";break;case",":t="flow indicator character ,";break;case"%":t="directive indicator character %";break;case"|":case">":{t=`block scalar indicator ${s[0]}`;break}case"@":case"`":{t=`reserved character ${s[0]}`;break}}return t&&e(0,"BAD_SCALAR_START",`Plain value cannot start with ${t}`),Ml(s)}function lp(s,e){return(s[s.length-1]!=="'"||s.length===1)&&e(s.length,"MISSING_CHAR","Missing closing 'quote"),Ml(s.slice(1,-1)).replace(/''/g,"'")}function Ml(s){let e,t;try{e=new RegExp(`(.*?)(?<![ 	])[ 	]*\r?
`,"sy"),t=new RegExp(`[ 	]*(.*?)(?:(?<![ 	])[ 	]*)?\r?
`,"sy")}catch{e=/(.*?)[ \t]*\r?\n/sy,t=/[ \t]*(.*?)[ \t]*\r?\n/sy}let i=e.exec(s);if(!i)return s;let n=i[1],r=" ",a=e.lastIndex;for(t.lastIndex=a;i=t.exec(s);)i[1]===""?r===`
`?n+=r:r=`
`:(n+=r+i[1],r=" "),a=t.lastIndex;const o=/[ \t]*(.*)/sy;return o.lastIndex=a,i=o.exec(s),n+r+((i==null?void 0:i[1])??"")}function cp(s,e){let t="";for(let i=1;i<s.length-1;++i){const n=s[i];if(!(n==="\r"&&s[i+1]===`
`))if(n===`
`){const{fold:r,offset:a}=up(s,i);t+=r,i=a}else if(n==="\\"){let r=s[++i];const a=dp[r];if(a)t+=a;else if(r===`
`)for(r=s[i+1];r===" "||r==="	";)r=s[++i+1];else if(r==="\r"&&s[i+1]===`
`)for(r=s[++i+1];r===" "||r==="	";)r=s[++i+1];else if(r==="x"||r==="u"||r==="U"){const o={x:2,u:4,U:8}[r];t+=fp(s,i+1,o,e),i+=o}else{const o=s.substr(i-1,2);e(i-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${o}`),t+=o}}else if(n===" "||n==="	"){const r=i;let a=s[i+1];for(;a===" "||a==="	";)a=s[++i+1];a!==`
`&&!(a==="\r"&&s[i+2]===`
`)&&(t+=i>r?s.slice(r,i+1):n)}else t+=n}return(s[s.length-1]!=='"'||s.length===1)&&e(s.length,"MISSING_CHAR",'Missing closing "quote'),t}function up(s,e){let t="",i=s[e+1];for(;(i===" "||i==="	"||i===`
`||i==="\r")&&!(i==="\r"&&s[e+2]!==`
`);)i===`
`&&(t+=`
`),e+=1,i=s[e+1];return t||(t=" "),{fold:t,offset:e}}const dp={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v",N:"",_:"",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","	":"	"};function fp(s,e,t,i){const n=s.substr(e,t),a=n.length===t&&/^[0-9a-fA-F]+$/.test(n)?parseInt(n,16):NaN;if(isNaN(a)){const o=s.substr(e-2,t+2);return i(e-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${o}`),o}return String.fromCodePoint(a)}function jl(s,e,t,i){const{value:n,type:r,comment:a,range:o}=e.type==="block-scalar"?xl(s,e,i):$l(e,s.options.strict,i),l=t?s.directives.tagName(t.source,p=>i(t,"TAG_RESOLVE_FAILED",p)):null;let c;s.options.stringKeys&&s.atKey?c=s.schema[Ft]:l?c=hp(s.schema,n,l,t,i):e.type==="scalar"?c=pp(s,n,e,i):c=s.schema[Ft];let f;try{const p=c.resolve(n,d=>i(t??e,"TAG_RESOLVE_FAILED",d),s.options);f=ge(p)?p:new Y(p)}catch(p){const d=p instanceof Error?p.message:String(p);i(t??e,"TAG_RESOLVE_FAILED",d),f=new Y(n)}return f.range=o,f.source=n,r&&(f.type=r),l&&(f.tag=l),c.format&&(f.format=c.format),a&&(f.comment=a),f}function hp(s,e,t,i,n){var o;if(t==="!")return s[Ft];const r=[];for(const l of s.tags)if(!l.collection&&l.tag===t)if(l.default&&l.test)r.push(l);else return l;for(const l of r)if((o=l.test)!=null&&o.test(e))return l;const a=s.knownTags[t];return a&&!a.collection?(s.tags.push(Object.assign({},a,{default:!1,test:void 0})),a):(n(i,"TAG_RESOLVE_FAILED",`Unresolved tag: ${t}`,t!=="tag:yaml.org,2002:str"),s[Ft])}function pp({atKey:s,directives:e,schema:t},i,n,r){const a=t.tags.find(o=>{var l;return(o.default===!0||s&&o.default==="key")&&((l=o.test)==null?void 0:l.test(i))})||t[Ft];if(t.compat){const o=t.compat.find(l=>{var c;return l.default&&((c=l.test)==null?void 0:c.test(i))})??t[Ft];if(a.tag!==o.tag){const l=e.tagString(a.tag),c=e.tagString(o.tag),f=`Value may be parsed as either ${l} or ${c}`;r(n,"TAG_RESOLVE_FAILED",f,!0)}}return a}function gp(s,e,t){if(e){t??(t=e.length);for(let i=t-1;i>=0;--i){let n=e[i];switch(n.type){case"space":case"comment":case"newline":s-=n.source.length;continue}for(n=e[++i];(n==null?void 0:n.type)==="space";)s+=n.source.length,n=e[++i];break}}return s}const mp={composeNode:Rl,composeEmptyNode:ta};function Rl(s,e,t,i){const n=s.atKey,{spaceBefore:r,comment:a,anchor:o,tag:l}=t;let c,f=!0;switch(e.type){case"alias":c=vp(s,e,i),(o||l)&&i(e,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":c=jl(s,e,l,i),o&&(c.anchor=o.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":c=np(mp,s,e,t,i),o&&(c.anchor=o.source.substring(1));break;default:{const p=e.type==="error"?e.message:`Unsupported token (type: ${e.type})`;i(e,"UNEXPECTED_TOKEN",p),c=ta(s,e.offset,void 0,null,t,i),f=!1}}return o&&c.anchor===""&&i(o,"BAD_ALIAS","Anchor cannot be an empty string"),n&&s.options.stringKeys&&(!ge(c)||typeof c.value!="string"||c.tag&&c.tag!=="tag:yaml.org,2002:str")&&i(l??e,"NON_STRING_KEY","With stringKeys, all keys must be strings"),r&&(c.spaceBefore=!0),a&&(e.type==="scalar"&&e.source===""?c.comment=a:c.commentBefore=a),s.options.keepSourceTokens&&f&&(c.srcToken=e),c}function ta(s,e,t,i,{spaceBefore:n,comment:r,anchor:a,tag:o,end:l},c){const f={type:"scalar",offset:gp(e,t,i),indent:-1,source:""},p=jl(s,f,o,c);return a&&(p.anchor=a.source.substring(1),p.anchor===""&&c(a,"BAD_ALIAS","Anchor cannot be an empty string")),n&&(p.spaceBefore=!0),r&&(p.comment=r,p.range[2]=l),p}function vp({options:s},{offset:e,source:t,end:i},n){const r=new An(t.substring(1));r.source===""&&n(e,"BAD_ALIAS","Alias cannot be an empty string"),r.source.endsWith(":")&&n(e+t.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);const a=e+t.length,o=Ms(i,a,s.strict,n);return r.range=[e,a,o.offset],o.comment&&(r.comment=o.comment),r}function kp(s,e,{offset:t,start:i,value:n,end:r},a){const o=Object.assign({_directives:e},s),l=new es(void 0,o),c={atKey:!1,atRoot:!0,directives:l.directives,options:l.options,schema:l.schema},f=Ui(i,{indicator:"doc-start",next:n??(r==null?void 0:r[0]),offset:t,onError:a,parentIndent:0,startOnNewline:!0});f.found&&(l.directives.docStart=!0,n&&(n.type==="block-map"||n.type==="block-seq")&&!f.hasNewline&&a(f.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),l.contents=n?Rl(c,n,f,a):ta(c,f.end,i,null,f,a);const p=l.contents.range[2],d=Ms(r,p,!1,a);return d.comment&&(l.comment=d.comment),l.range=[t,p,d.offset],l}function ns(s){if(typeof s=="number")return[s,s+1];if(Array.isArray(s))return s.length===2?s:[s[0],s[1]];const{offset:e,source:t}=s;return[e,e+(typeof t=="string"?t.length:1)]}function Ha(s){var n;let e="",t=!1,i=!1;for(let r=0;r<s.length;++r){const a=s[r];switch(a[0]){case"#":e+=(e===""?"":i?`

`:`
`)+(a.substring(1)||" "),t=!0,i=!1;break;case"%":((n=s[r+1])==null?void 0:n[0])!=="#"&&(r+=1),t=!1;break;default:t||(i=!0),t=!1}}return{comment:e,afterEmptyLine:i}}class ia{constructor(e={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(t,i,n,r)=>{const a=ns(t);r?this.warnings.push(new Dl(a,i,n)):this.errors.push(new di(a,i,n))},this.directives=new Ke({version:e.version||"1.2"}),this.options=e}decorate(e,t){const{comment:i,afterEmptyLine:n}=Ha(this.prelude);if(i){const r=e.contents;if(t)e.comment=e.comment?`${e.comment}
${i}`:i;else if(n||e.directives.docStart||!r)e.commentBefore=i;else if(Ie(r)&&!r.flow&&r.items.length>0){let a=r.items[0];we(a)&&(a=a.key);const o=a.commentBefore;a.commentBefore=o?`${i}
${o}`:i}else{const a=r.commentBefore;r.commentBefore=a?`${i}
${a}`:i}}t?(Array.prototype.push.apply(e.errors,this.errors),Array.prototype.push.apply(e.warnings,this.warnings)):(e.errors=this.errors,e.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:Ha(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(e,t=!1,i=-1){for(const n of e)yield*this.next(n);yield*this.end(t,i)}*next(e){switch(e.type){case"directive":this.directives.add(e.source,(t,i,n)=>{const r=ns(e);r[0]+=t,this.onError(r,"BAD_DIRECTIVE",i,n)}),this.prelude.push(e.source),this.atDirectives=!0;break;case"document":{const t=kp(this.options,this.directives,e,this.onError);this.atDirectives&&!t.directives.docStart&&this.onError(e,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(t,!1),this.doc&&(yield this.doc),this.doc=t,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(e.source);break;case"error":{const t=e.source?`${e.message}: ${JSON.stringify(e.source)}`:e.message,i=new di(ns(e),"UNEXPECTED_TOKEN",t);this.atDirectives||!this.doc?this.errors.push(i):this.doc.errors.push(i);break}case"doc-end":{if(!this.doc){const i="Unexpected doc-end without preceding document";this.errors.push(new di(ns(e),"UNEXPECTED_TOKEN",i));break}this.doc.directives.docEnd=!0;const t=Ms(e.end,e.offset+e.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),t.comment){const i=this.doc.comment;this.doc.comment=i?`${i}
${t.comment}`:t.comment}this.doc.range[2]=t.offset;break}default:this.errors.push(new di(ns(e),"UNEXPECTED_TOKEN",`Unsupported token ${e.type}`))}}*end(e=!1,t=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(e){const i=Object.assign({_directives:this.directives},this.options),n=new es(void 0,i);this.atDirectives&&this.onError(t,"MISSING_CHAR","Missing directives-end indicator line"),n.range=[0,t,t],this.decorate(n,!1),yield n}}}function yp(s,e=!0,t){if(s){const i=(n,r,a)=>{const o=typeof n=="number"?n:Array.isArray(n)?n[0]:n.offset;if(t)t(o,r,a);else throw new di([o,o+1],r,a)};switch(s.type){case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return $l(s,e,i);case"block-scalar":return xl({options:{strict:e}},s,i)}}return null}function wp(s,e){const{implicitKey:t=!1,indent:i,inFlow:n=!1,offset:r=-1,type:a="PLAIN"}=e,o=xs({type:a,value:s},{implicitKey:t,indent:i>0?" ".repeat(i):"",inFlow:n,options:{blockQuote:!0,lineWidth:-1}}),l=e.end??[{type:"newline",offset:-1,indent:i,source:`
`}];switch(o[0]){case"|":case">":{const c=o.indexOf(`
`),f=o.substring(0,c),p=o.substring(c+1)+`
`,d=[{type:"block-scalar-header",offset:r,indent:i,source:f}];return Bl(d,l)||d.push({type:"newline",offset:-1,indent:i,source:`
`}),{type:"block-scalar",offset:r,indent:i,props:d,source:p}}case'"':return{type:"double-quoted-scalar",offset:r,indent:i,source:o,end:l};case"'":return{type:"single-quoted-scalar",offset:r,indent:i,source:o,end:l};default:return{type:"scalar",offset:r,indent:i,source:o,end:l}}}function bp(s,e,t={}){let{afterKey:i=!1,implicitKey:n=!1,inFlow:r=!1,type:a}=t,o="indent"in s?s.indent:null;if(i&&typeof o=="number"&&(o+=2),!a)switch(s.type){case"single-quoted-scalar":a="QUOTE_SINGLE";break;case"double-quoted-scalar":a="QUOTE_DOUBLE";break;case"block-scalar":{const c=s.props[0];if(c.type!=="block-scalar-header")throw new Error("Invalid block scalar header");a=c.source[0]===">"?"BLOCK_FOLDED":"BLOCK_LITERAL";break}default:a="PLAIN"}const l=xs({type:a,value:e},{implicitKey:n||o===null,indent:o!==null&&o>0?" ".repeat(o):"",inFlow:r,options:{blockQuote:!0,lineWidth:-1}});switch(l[0]){case"|":case">":Tp(s,l);break;case'"':nr(s,l,"double-quoted-scalar");break;case"'":nr(s,l,"single-quoted-scalar");break;default:nr(s,l,"scalar")}}function Tp(s,e){const t=e.indexOf(`
`),i=e.substring(0,t),n=e.substring(t+1)+`
`;if(s.type==="block-scalar"){const r=s.props[0];if(r.type!=="block-scalar-header")throw new Error("Invalid block scalar header");r.source=i,s.source=n}else{const{offset:r}=s,a="indent"in s?s.indent:-1,o=[{type:"block-scalar-header",offset:r,indent:a,source:i}];Bl(o,"end"in s?s.end:void 0)||o.push({type:"newline",offset:-1,indent:a,source:`
`});for(const l of Object.keys(s))l!=="type"&&l!=="offset"&&delete s[l];Object.assign(s,{type:"block-scalar",indent:a,props:o,source:n})}}function Bl(s,e){if(e)for(const t of e)switch(t.type){case"space":case"comment":s.push(t);break;case"newline":return s.push(t),!0}return!1}function nr(s,e,t){switch(s.type){case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":s.type=t,s.source=e;break;case"block-scalar":{const i=s.props.slice(1);let n=e.length;s.props[0].type==="block-scalar-header"&&(n-=s.props[0].source.length);for(const r of i)r.offset+=n;delete s.props,Object.assign(s,{type:t,source:e,end:i});break}case"block-map":case"block-seq":{const n={type:"newline",offset:s.offset+e.length,indent:s.indent,source:`
`};delete s.items,Object.assign(s,{type:t,source:e,end:[n]});break}default:{const i="indent"in s?s.indent:-1,n="end"in s&&Array.isArray(s.end)?s.end.filter(r=>r.type==="space"||r.type==="comment"||r.type==="newline"):[];for(const r of Object.keys(s))r!=="type"&&r!=="offset"&&delete s[r];Object.assign(s,{type:t,indent:i,source:e,end:n})}}}const Ip=s=>"type"in s?kn(s):sn(s);function kn(s){switch(s.type){case"block-scalar":{let e="";for(const t of s.props)e+=kn(t);return e+s.source}case"block-map":case"block-seq":{let e="";for(const t of s.items)e+=sn(t);return e}case"flow-collection":{let e=s.start.source;for(const t of s.items)e+=sn(t);for(const t of s.end)e+=t.source;return e}case"document":{let e=sn(s);if(s.end)for(const t of s.end)e+=t.source;return e}default:{let e=s.source;if("end"in s&&s.end)for(const t of s.end)e+=t.source;return e}}}function sn({start:s,key:e,sep:t,value:i}){let n="";for(const r of s)n+=r.source;if(e&&(n+=kn(e)),t)for(const r of t)n+=r.source;return i&&(n+=kn(i)),n}const Tr=Symbol("break visit"),_p=Symbol("skip children"),Ul=Symbol("remove item");function ki(s,e){"type"in s&&s.type==="document"&&(s={start:s.start,value:s.value}),ql(Object.freeze([]),s,e)}ki.BREAK=Tr;ki.SKIP=_p;ki.REMOVE=Ul;ki.itemAtPath=(s,e)=>{let t=s;for(const[i,n]of e){const r=t==null?void 0:t[i];if(r&&"items"in r)t=r.items[n];else return}return t};ki.parentCollection=(s,e)=>{const t=ki.itemAtPath(s,e.slice(0,-1)),i=e[e.length-1][0],n=t==null?void 0:t[i];if(n&&"items"in n)return n;throw new Error("Parent collection not found")};function ql(s,e,t){let i=t(e,s);if(typeof i=="symbol")return i;for(const n of["key","value"]){const r=e[n];if(r&&"items"in r){for(let a=0;a<r.items.length;++a){const o=ql(Object.freeze(s.concat([[n,a]])),r.items[a],t);if(typeof o=="number")a=o-1;else{if(o===Tr)return Tr;o===Ul&&(r.items.splice(a,1),a-=1)}}typeof i=="function"&&n==="key"&&(i=i(e,s))}}return typeof i=="function"?i(e,s):i}const Bn="\uFEFF",Un="",qn="",_s="",Sp=s=>!!s&&"items"in s,Pp=s=>!!s&&(s.type==="scalar"||s.type==="single-quoted-scalar"||s.type==="double-quoted-scalar"||s.type==="block-scalar");function Ep(s){switch(s){case Bn:return"<BOM>";case Un:return"<DOC>";case qn:return"<FLOW_END>";case _s:return"<SCALAR>";default:return JSON.stringify(s)}}function Hl(s){switch(s){case Bn:return"byte-order-mark";case Un:return"doc-mode";case qn:return"flow-error-end";case _s:return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case`
`:case`\r
`:return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(s[0]){case" ":case"	":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}const Op=Object.freeze(Object.defineProperty({__proto__:null,BOM:Bn,DOCUMENT:Un,FLOW_END:qn,SCALAR:_s,createScalarToken:wp,isCollection:Sp,isScalar:Pp,prettyToken:Ep,resolveAsScalar:yp,setScalarValue:bp,stringify:Ip,tokenType:Hl,visit:ki},Symbol.toStringTag,{value:"Module"}));function Tt(s){switch(s){case void 0:case" ":case`
`:case"\r":case"	":return!0;default:return!1}}const Ka=new Set("0123456789ABCDEFabcdef"),Cp=new Set("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()"),Ws=new Set(",[]{}"),Ap=new Set(` ,[]{}
\r	`),rr=s=>!s||Ap.has(s);class Kl{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(e,t=!1){if(e){if(typeof e!="string")throw TypeError("source is not a string");this.buffer=this.buffer?this.buffer+e:e,this.lineEndPos=null}this.atEnd=!t;let i=this.next??"stream";for(;i&&(t||this.hasChars(1));)i=yield*this.parseNext(i)}atLineEnd(){let e=this.pos,t=this.buffer[e];for(;t===" "||t==="	";)t=this.buffer[++e];return!t||t==="#"||t===`
`?!0:t==="\r"?this.buffer[e+1]===`
`:!1}charAt(e){return this.buffer[this.pos+e]}continueScalar(e){let t=this.buffer[e];if(this.indentNext>0){let i=0;for(;t===" ";)t=this.buffer[++i+e];if(t==="\r"){const n=this.buffer[i+e+1];if(n===`
`||!n&&!this.atEnd)return e+i+1}return t===`
`||i>=this.indentNext||!t&&!this.atEnd?e+i:-1}if(t==="-"||t==="."){const i=this.buffer.substr(e,3);if((i==="---"||i==="...")&&Tt(this.buffer[e+3]))return-1}return e}getLine(){let e=this.lineEndPos;return(typeof e!="number"||e!==-1&&e<this.pos)&&(e=this.buffer.indexOf(`
`,this.pos),this.lineEndPos=e),e===-1?this.atEnd?this.buffer.substring(this.pos):null:(this.buffer[e-1]==="\r"&&(e-=1),this.buffer.substring(this.pos,e))}hasChars(e){return this.pos+e<=this.buffer.length}setNext(e){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=e,null}peek(e){return this.buffer.substr(this.pos,e)}*parseNext(e){switch(e){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let e=this.getLine();if(e===null)return this.setNext("stream");if(e[0]===Bn&&(yield*this.pushCount(1),e=e.substring(1)),e[0]==="%"){let t=e.length,i=e.indexOf("#");for(;i!==-1;){const r=e[i-1];if(r===" "||r==="	"){t=i-1;break}else i=e.indexOf("#",i+1)}for(;;){const r=e[t-1];if(r===" "||r==="	")t-=1;else break}const n=(yield*this.pushCount(t))+(yield*this.pushSpaces(!0));return yield*this.pushCount(e.length-n),this.pushNewline(),"stream"}if(this.atLineEnd()){const t=yield*this.pushSpaces(!0);return yield*this.pushCount(e.length-t),yield*this.pushNewline(),"stream"}return yield Un,yield*this.parseLineStart()}*parseLineStart(){const e=this.charAt(0);if(!e&&!this.atEnd)return this.setNext("line-start");if(e==="-"||e==="."){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");const t=this.peek(3);if((t==="---"||t==="...")&&Tt(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,t==="---"?"doc":"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!Tt(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){const[e,t]=this.peek(2);if(!t&&!this.atEnd)return this.setNext("block-start");if((e==="-"||e==="?"||e===":")&&Tt(t)){const i=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=i,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);const e=this.getLine();if(e===null)return this.setNext("doc");let t=yield*this.pushIndicators();switch(e[t]){case"#":yield*this.pushCount(e.length-t);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(rr),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return t+=yield*this.parseBlockScalarHeader(),t+=yield*this.pushSpaces(!0),yield*this.pushCount(e.length-t),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let e,t,i=-1;do e=yield*this.pushNewline(),e>0?(t=yield*this.pushSpaces(!1),this.indentValue=i=t):t=0,t+=yield*this.pushSpaces(!0);while(e+t>0);const n=this.getLine();if(n===null)return this.setNext("flow");if((i!==-1&&i<this.indentNext&&n[0]!=="#"||i===0&&(n.startsWith("---")||n.startsWith("..."))&&Tt(n[3]))&&!(i===this.indentNext-1&&this.flowLevel===1&&(n[0]==="]"||n[0]==="}")))return this.flowLevel=0,yield qn,yield*this.parseLineStart();let r=0;for(;n[r]===",";)r+=yield*this.pushCount(1),r+=yield*this.pushSpaces(!0),this.flowKey=!1;switch(r+=yield*this.pushIndicators(),n[r]){case void 0:return"flow";case"#":return yield*this.pushCount(n.length-r),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(rr),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{const a=this.charAt(1);if(this.flowKey||Tt(a)||a===",")return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){const e=this.charAt(0);let t=this.buffer.indexOf(e,this.pos+1);if(e==="'")for(;t!==-1&&this.buffer[t+1]==="'";)t=this.buffer.indexOf("'",t+2);else for(;t!==-1;){let r=0;for(;this.buffer[t-1-r]==="\\";)r+=1;if(r%2===0)break;t=this.buffer.indexOf('"',t+1)}const i=this.buffer.substring(0,t);let n=i.indexOf(`
`,this.pos);if(n!==-1){for(;n!==-1;){const r=this.continueScalar(n+1);if(r===-1)break;n=i.indexOf(`
`,r)}n!==-1&&(t=n-(i[n-1]==="\r"?2:1))}if(t===-1){if(!this.atEnd)return this.setNext("quoted-scalar");t=this.buffer.length}return yield*this.pushToIndex(t+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let e=this.pos;for(;;){const t=this.buffer[++e];if(t==="+")this.blockScalarKeep=!0;else if(t>"0"&&t<="9")this.blockScalarIndent=Number(t)-1;else if(t!=="-")break}return yield*this.pushUntil(t=>Tt(t)||t==="#")}*parseBlockScalar(){let e=this.pos-1,t=0,i;e:for(let r=this.pos;i=this.buffer[r];++r)switch(i){case" ":t+=1;break;case`
`:e=r,t=0;break;case"\r":{const a=this.buffer[r+1];if(!a&&!this.atEnd)return this.setNext("block-scalar");if(a===`
`)break}default:break e}if(!i&&!this.atEnd)return this.setNext("block-scalar");if(t>=this.indentNext){this.blockScalarIndent===-1?this.indentNext=t:this.indentNext=this.blockScalarIndent+(this.indentNext===0?1:this.indentNext);do{const r=this.continueScalar(e+1);if(r===-1)break;e=this.buffer.indexOf(`
`,r)}while(e!==-1);if(e===-1){if(!this.atEnd)return this.setNext("block-scalar");e=this.buffer.length}}let n=e+1;for(i=this.buffer[n];i===" ";)i=this.buffer[++n];if(i==="	"){for(;i==="	"||i===" "||i==="\r"||i===`
`;)i=this.buffer[++n];e=n-1}else if(!this.blockScalarKeep)do{let r=e-1,a=this.buffer[r];a==="\r"&&(a=this.buffer[--r]);const o=r;for(;a===" ";)a=this.buffer[--r];if(a===`
`&&r>=this.pos&&r+1+t>o)e=r;else break}while(!0);return yield _s,yield*this.pushToIndex(e+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){const e=this.flowLevel>0;let t=this.pos-1,i=this.pos-1,n;for(;n=this.buffer[++i];)if(n===":"){const r=this.buffer[i+1];if(Tt(r)||e&&Ws.has(r))break;t=i}else if(Tt(n)){let r=this.buffer[i+1];if(n==="\r"&&(r===`
`?(i+=1,n=`
`,r=this.buffer[i+1]):t=i),r==="#"||e&&Ws.has(r))break;if(n===`
`){const a=this.continueScalar(i+1);if(a===-1)break;i=Math.max(i,a-2)}}else{if(e&&Ws.has(n))break;t=i}return!n&&!this.atEnd?this.setNext("plain-scalar"):(yield _s,yield*this.pushToIndex(t+1,!0),e?"flow":"doc")}*pushCount(e){return e>0?(yield this.buffer.substr(this.pos,e),this.pos+=e,e):0}*pushToIndex(e,t){const i=this.buffer.slice(this.pos,e);return i?(yield i,this.pos+=i.length,i.length):(t&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(rr))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{const e=this.flowLevel>0,t=this.charAt(1);if(Tt(t)||e&&Ws.has(t))return e?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if(this.charAt(1)==="<"){let e=this.pos+2,t=this.buffer[e];for(;!Tt(t)&&t!==">";)t=this.buffer[++e];return yield*this.pushToIndex(t===">"?e+1:e,!1)}else{let e=this.pos+1,t=this.buffer[e];for(;t;)if(Cp.has(t))t=this.buffer[++e];else if(t==="%"&&Ka.has(this.buffer[e+1])&&Ka.has(this.buffer[e+2]))t=this.buffer[e+=3];else break;return yield*this.pushToIndex(e,!1)}}*pushNewline(){const e=this.buffer[this.pos];return e===`
`?yield*this.pushCount(1):e==="\r"&&this.charAt(1)===`
`?yield*this.pushCount(2):0}*pushSpaces(e){let t=this.pos-1,i;do i=this.buffer[++t];while(i===" "||e&&i==="	");const n=t-this.pos;return n>0&&(yield this.buffer.substr(this.pos,n),this.pos=t),n}*pushUntil(e){let t=this.pos,i=this.buffer[t];for(;!e(i);)i=this.buffer[++t];return yield*this.pushToIndex(t,!1)}}class Vl{constructor(){this.lineStarts=[],this.addNewLine=e=>this.lineStarts.push(e),this.linePos=e=>{let t=0,i=this.lineStarts.length;for(;t<i;){const r=t+i>>1;this.lineStarts[r]<e?t=r+1:i=r}if(this.lineStarts[t]===e)return{line:t+1,col:1};if(t===0)return{line:0,col:e};const n=this.lineStarts[t-1];return{line:t,col:e-n+1}}}}function zt(s,e){for(let t=0;t<s.length;++t)if(s[t].type===e)return!0;return!1}function Va(s){for(let e=0;e<s.length;++e)switch(s[e].type){case"space":case"comment":case"newline":break;default:return e}return-1}function zl(s){switch(s==null?void 0:s.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function Ys(s){switch(s.type){case"document":return s.start;case"block-map":{const e=s.items[s.items.length-1];return e.sep??e.start}case"block-seq":return s.items[s.items.length-1].start;default:return[]}}function _i(s){var t;if(s.length===0)return[];let e=s.length;e:for(;--e>=0;)switch(s[e].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;((t=s[++e])==null?void 0:t.type)==="space";);return s.splice(e,s.length)}function za(s){if(s.start.type==="flow-seq-start")for(const e of s.items)e.sep&&!e.value&&!zt(e.start,"explicit-key-ind")&&!zt(e.sep,"map-value-ind")&&(e.key&&(e.value=e.key),delete e.key,zl(e.value)?e.value.end?Array.prototype.push.apply(e.value.end,e.sep):e.value.end=e.sep:Array.prototype.push.apply(e.start,e.sep),delete e.sep)}class sa{constructor(e){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new Kl,this.onNewLine=e}*parse(e,t=!1){this.onNewLine&&this.offset===0&&this.onNewLine(0);for(const i of this.lexer.lex(e,t))yield*this.next(i);t||(yield*this.end())}*next(e){if(this.source=e,this.atScalar){this.atScalar=!1,yield*this.step(),this.offset+=e.length;return}const t=Hl(e);if(t)if(t==="scalar")this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=t,yield*this.step(),t){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+e.length);break;case"space":this.atNewLine&&e[0]===" "&&(this.indent+=e.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=e.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=e.length}else{const i=`Not a YAML token: ${e}`;yield*this.pop({type:"error",offset:this.offset,message:i,source:e}),this.offset+=e.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){const e=this.peek(1);if(this.type==="doc-end"&&(!e||e.type!=="doc-end")){for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source});return}if(!e)return yield*this.stream();switch(e.type){case"document":return yield*this.document(e);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(e);case"block-scalar":return yield*this.blockScalar(e);case"block-map":return yield*this.blockMap(e);case"block-seq":return yield*this.blockSequence(e);case"flow-collection":return yield*this.flowCollection(e);case"doc-end":return yield*this.documentEnd(e)}yield*this.pop()}peek(e){return this.stack[this.stack.length-e]}*pop(e){const t=e??this.stack.pop();if(!t)yield{type:"error",offset:this.offset,source:"",message:"Tried to pop an empty stack"};else if(this.stack.length===0)yield t;else{const i=this.peek(1);switch(t.type==="block-scalar"?t.indent="indent"in i?i.indent:0:t.type==="flow-collection"&&i.type==="document"&&(t.indent=0),t.type==="flow-collection"&&za(t),i.type){case"document":i.value=t;break;case"block-scalar":i.props.push(t);break;case"block-map":{const n=i.items[i.items.length-1];if(n.value){i.items.push({start:[],key:t,sep:[]}),this.onKeyLine=!0;return}else if(n.sep)n.value=t;else{Object.assign(n,{key:t,sep:[]}),this.onKeyLine=!n.explicitKey;return}break}case"block-seq":{const n=i.items[i.items.length-1];n.value?i.items.push({start:[],value:t}):n.value=t;break}case"flow-collection":{const n=i.items[i.items.length-1];!n||n.value?i.items.push({start:[],key:t,sep:[]}):n.sep?n.value=t:Object.assign(n,{key:t,sep:[]});return}default:yield*this.pop(),yield*this.pop(t)}if((i.type==="document"||i.type==="block-map"||i.type==="block-seq")&&(t.type==="block-map"||t.type==="block-seq")){const n=t.items[t.items.length-1];n&&!n.sep&&!n.value&&n.start.length>0&&Va(n.start)===-1&&(t.indent===0||n.start.every(r=>r.type!=="comment"||r.indent<t.indent))&&(i.type==="document"?i.end=n.start:i.items.push({start:n.start}),t.items.splice(-1,1))}}}*stream(){switch(this.type){case"directive-line":yield{type:"directive",offset:this.offset,source:this.source};return;case"byte-order-mark":case"space":case"comment":case"newline":yield this.sourceToken;return;case"doc-mode":case"doc-start":{const e={type:"document",offset:this.offset,start:[]};this.type==="doc-start"&&e.start.push(this.sourceToken),this.stack.push(e);return}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(e){if(e.value)return yield*this.lineEnd(e);switch(this.type){case"doc-start":{Va(e.start)!==-1?(yield*this.pop(),yield*this.step()):e.start.push(this.sourceToken);return}case"anchor":case"tag":case"space":case"comment":case"newline":e.start.push(this.sourceToken);return}const t=this.startBlockValue(e);t?this.stack.push(t):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(e){if(this.type==="map-value-ind"){const t=Ys(this.peek(2)),i=_i(t);let n;e.end?(n=e.end,n.push(this.sourceToken),delete e.end):n=[this.sourceToken];const r={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:i,key:e,sep:n}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=r}else yield*this.lineEnd(e)}*blockScalar(e){switch(this.type){case"space":case"comment":case"newline":e.props.push(this.sourceToken);return;case"scalar":if(e.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let t=this.source.indexOf(`
`)+1;for(;t!==0;)this.onNewLine(this.offset+t),t=this.source.indexOf(`
`,t)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(e){var i;const t=e.items[e.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,t.value){const n="end"in t.value?t.value.end:void 0,r=Array.isArray(n)?n[n.length-1]:void 0;(r==null?void 0:r.type)==="comment"?n==null||n.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else if(t.sep)t.sep.push(this.sourceToken);else{if(this.atIndentedComment(t.start,e.indent)){const n=e.items[e.items.length-2],r=(i=n==null?void 0:n.value)==null?void 0:i.end;if(Array.isArray(r)){Array.prototype.push.apply(r,t.start),r.push(this.sourceToken),e.items.pop();return}}t.start.push(this.sourceToken)}return}if(this.indent>=e.indent){const n=!this.onKeyLine&&this.indent===e.indent,r=n&&(t.sep||t.explicitKey)&&this.type!=="seq-item-ind";let a=[];if(r&&t.sep&&!t.value){const o=[];for(let l=0;l<t.sep.length;++l){const c=t.sep[l];switch(c.type){case"newline":o.push(l);break;case"space":break;case"comment":c.indent>e.indent&&(o.length=0);break;default:o.length=0}}o.length>=2&&(a=t.sep.splice(o[1]))}switch(this.type){case"anchor":case"tag":r||t.value?(a.push(this.sourceToken),e.items.push({start:a}),this.onKeyLine=!0):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"explicit-key-ind":!t.sep&&!t.explicitKey?(t.start.push(this.sourceToken),t.explicitKey=!0):r||t.value?(a.push(this.sourceToken),e.items.push({start:a,explicitKey:!0})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken],explicitKey:!0}]}),this.onKeyLine=!0;return;case"map-value-ind":if(t.explicitKey)if(t.sep)if(t.value)e.items.push({start:[],key:null,sep:[this.sourceToken]});else if(zt(t.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:a,key:null,sep:[this.sourceToken]}]});else if(zl(t.key)&&!zt(t.sep,"newline")){const o=_i(t.start),l=t.key,c=t.sep;c.push(this.sourceToken),delete t.key,delete t.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:l,sep:c}]})}else a.length>0?t.sep=t.sep.concat(a,this.sourceToken):t.sep.push(this.sourceToken);else if(zt(t.start,"newline"))Object.assign(t,{key:null,sep:[this.sourceToken]});else{const o=_i(t.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:null,sep:[this.sourceToken]}]})}else t.sep?t.value||r?e.items.push({start:a,key:null,sep:[this.sourceToken]}):zt(t.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});this.onKeyLine=!0;return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const o=this.flowScalar(this.type);r||t.value?(e.items.push({start:a,key:o,sep:[]}),this.onKeyLine=!0):t.sep?this.stack.push(o):(Object.assign(t,{key:o,sep:[]}),this.onKeyLine=!0);return}default:{const o=this.startBlockValue(e);if(o){if(o.type==="block-seq"){if(!t.explicitKey&&t.sep&&!zt(t.sep,"newline")){yield*this.pop({type:"error",offset:this.offset,message:"Unexpected block-seq-ind on same line with key",source:this.source});return}}else n&&e.items.push({start:a});this.stack.push(o);return}}}}yield*this.pop(),yield*this.step()}*blockSequence(e){var i;const t=e.items[e.items.length-1];switch(this.type){case"newline":if(t.value){const n="end"in t.value?t.value.end:void 0,r=Array.isArray(n)?n[n.length-1]:void 0;(r==null?void 0:r.type)==="comment"?n==null||n.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(t.start,e.indent)){const n=e.items[e.items.length-2],r=(i=n==null?void 0:n.value)==null?void 0:i.end;if(Array.isArray(r)){Array.prototype.push.apply(r,t.start),r.push(this.sourceToken),e.items.pop();return}}t.start.push(this.sourceToken)}return;case"anchor":case"tag":if(t.value||this.indent<=e.indent)break;t.start.push(this.sourceToken);return;case"seq-item-ind":if(this.indent!==e.indent)break;t.value||zt(t.start,"seq-item-ind")?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken);return}if(this.indent>e.indent){const n=this.startBlockValue(e);if(n){this.stack.push(n);return}}yield*this.pop(),yield*this.step()}*flowCollection(e){const t=e.items[e.items.length-1];if(this.type==="flow-error-end"){let i;do yield*this.pop(),i=this.peek(1);while(i&&i.type==="flow-collection")}else if(e.end.length===0){switch(this.type){case"comma":case"explicit-key-ind":!t||t.sep?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken);return;case"map-value-ind":!t||t.value?e.items.push({start:[],key:null,sep:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});return;case"space":case"comment":case"newline":case"anchor":case"tag":!t||t.value?e.items.push({start:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const n=this.flowScalar(this.type);!t||t.value?e.items.push({start:[],key:n,sep:[]}):t.sep?this.stack.push(n):Object.assign(t,{key:n,sep:[]});return}case"flow-map-end":case"flow-seq-end":e.end.push(this.sourceToken);return}const i=this.startBlockValue(e);i?this.stack.push(i):(yield*this.pop(),yield*this.step())}else{const i=this.peek(2);if(i.type==="block-map"&&(this.type==="map-value-ind"&&i.indent===e.indent||this.type==="newline"&&!i.items[i.items.length-1].sep))yield*this.pop(),yield*this.step();else if(this.type==="map-value-ind"&&i.type!=="flow-collection"){const n=Ys(i),r=_i(n);za(e);const a=e.end.splice(1,e.end.length);a.push(this.sourceToken);const o={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:r,key:e,sep:a}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=o}else yield*this.lineEnd(e)}}flowScalar(e){if(this.onNewLine){let t=this.source.indexOf(`
`)+1;for(;t!==0;)this.onNewLine(this.offset+t),t=this.source.indexOf(`
`,t)+1}return{type:e,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(e){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;const t=Ys(e),i=_i(t);return i.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:i,explicitKey:!0}]}}case"map-value-ind":{this.onKeyLine=!0;const t=Ys(e),i=_i(t);return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:i,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(e,t){return this.type!=="comment"||this.indent<=t?!1:e.every(i=>i.type==="newline"||i.type==="space")}*documentEnd(e){this.type!=="doc-mode"&&(e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop()))}*lineEnd(e){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;case"space":case"comment":default:e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop())}}}function Gl(s){const e=s.prettyErrors!==!1;return{lineCounter:s.lineCounter||e&&new Vl||null,prettyErrors:e}}function Np(s,e={}){const{lineCounter:t,prettyErrors:i}=Gl(e),n=new sa(t==null?void 0:t.addNewLine),r=new ia(e),a=Array.from(r.compose(n.parse(s)));if(i&&t)for(const o of a)o.errors.forEach(vn(s,t)),o.warnings.forEach(vn(s,t));return a.length>0?a:Object.assign([],{empty:!0},r.streamInfo())}function Wl(s,e={}){const{lineCounter:t,prettyErrors:i}=Gl(e),n=new sa(t==null?void 0:t.addNewLine),r=new ia(e);let a=null;for(const o of r.compose(n.parse(s),!0,s.length))if(!a)a=o;else if(a.options.logLevel!=="silent"){a.errors.push(new di(o.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}return i&&t&&(a.errors.forEach(vn(s,t)),a.warnings.forEach(vn(s,t))),a}function Lp(s,e,t){let i;typeof e=="function"?i=e:t===void 0&&e&&typeof e=="object"&&(t=e);const n=Wl(s,t);if(!n)return null;if(n.warnings.forEach(r=>pl(n.options.logLevel,r)),n.errors.length>0){if(n.options.logLevel!=="silent")throw n.errors[0];n.errors=[]}return n.toJS(Object.assign({reviver:i},t))}function Dp(s,e,t){let i=null;if(typeof e=="function"||Array.isArray(e)?i=e:t===void 0&&e&&(t=e),typeof t=="string"&&(t=t.length),typeof t=="number"){const n=Math.round(t);t=n<1?void 0:n>8?{indent:8}:{indent:n}}if(s===void 0){const{keepUndefined:n}=t??e??{};if(!n)return}return yi(s)&&!i?s.toString(t):new es(s,i,t).toString(t)}const Fp=Object.freeze(Object.defineProperty({__proto__:null,Alias:An,CST:Op,Composer:ia,Document:es,Lexer:Kl,LineCounter:Vl,Pair:Ue,Parser:sa,Scalar:Y,Schema:Rn,YAMLError:ea,YAMLMap:nt,YAMLParseError:di,YAMLSeq:si,YAMLWarning:Dl,isAlias:ai,isCollection:Ie,isDocument:yi,isMap:Ji,isNode:_e,isPair:we,isScalar:ge,isSeq:Xi,parse:Lp,parseAllDocuments:Np,parseDocument:Wl,stringify:Dp,visit:wi,visitAsync:Cn},Symbol.toStringTag,{value:"Module"})),Yl={JsonQuery:"This query is written using JSON. This is deprecated and will be removed in a future version. Please use YAML instead.",GroupParameter:"The 'group' field is deprecated and will be removed in a future version. Please use 'groupBy' instead."};class Xe extends Error{constructor(e,t=void 0){super(e),this.inner=t}toString(){return this.inner?`${this.message}: '${this.inner}'`:super.toString()}}function xp(s){let e;const t=[];try{e=$p(s),t.push(Yl.JsonQuery)}catch(r){try{e=Mp(s)}catch(a){throw new Xe("Unable to parse as YAML or JSON",{eJson:r,eYaml:a})}}const[i,n]=jp(e);return t.push(...n),[i,t]}function $p(s){try{return JSON.parse(s)}catch(e){throw new Xe("Invalid JSON",e)}}function Mp(s){try{return Fp.parse(s)}catch(e){throw new Xe("Invalid YAML",e)}}function jp(s){const e=Up(s,"group")??!1,t=e?xt.Project:qp(s,"groupBy",Kp)??xt.None,i=[];return e&&i.push(Yl.GroupParameter),[{name:Ga(s,"name")??"",filter:Rp("filter",Ga(s,"filter")),autorefresh:Bp(s,"autorefresh")??0,sorting:Wa(s,"sorting",Hp)??[ut.Order],show:new Set(Wa(s,"show",Ya)??Object.values(Ya)),groupBy:t},i]}function Rp(s,e){if(e===void 0)throw new Xe(`Field ${s} must be text`);return e}function Ga(s,e){const t=s[e];if(t!==void 0){if(typeof t!="string")throw new Xe(`Field ${e} must be text`);return t}}function Bp(s,e,t){const i=s[e];if(i===void 0)return;if(typeof i!="number")throw new Xe(`Field ${e} must be a number`);const n=i;if(Number.isNaN(n))throw new Xe(`Field ${e} must be a number`);if(n<0)throw new Xe(`Field ${e} must be a positive number`);return n}function Up(s,e){const t=s[e];if(t!==void 0){if(typeof t!="boolean")throw new Xe(`Field ${e} must be a boolean.`);return t}}function Wa(s,e,t){const i=s[e];if(i===void 0)return;const n=Object.keys(t).join(", ");if(!Array.isArray(i))throw new Xe(`Field ${e} must be an array from values: ${n}`);const r=i,a=[];for(const o of r){if(typeof o!="string")throw new Xe(`Field ${e} must be an array from values: ${n}`);const l=t[o];if(l===void 0)throw new Xe(`Field ${e} must be an array from values: ${n}`);a.push(l)}return a}function qp(s,e,t){const i=s[e];if(i===void 0)return;const n=Object.keys(t).join(", ");if(typeof i!="string")throw new Xe(`Field ${e} must be one of: ${n}`);const r=t[i];if(r===void 0)throw new Xe(`Field ${e} must be one of: ${n}`);return r}const Hp={priority:ut.Priority,priorityAscending:ut.PriorityAscending,priorityDescending:ut.Priority,date:ut.Date,dateAscending:ut.Date,dateDescending:ut.DateDescending,order:ut.Order,dateAdded:ut.DateAdded,dateAddedAscending:ut.DateAdded,dateAddedDescending:ut.DateAddedDescending},Ya={due:Si.Due,date:Si.Due,description:Si.Description,labels:Si.Labels,project:Si.Project},Kp={project:xt.Project,section:xt.Section,priority:xt.Priority,due:xt.Date,date:xt.Date,labels:xt.Label};class Vp{constructor(e){this.plugin=e}onNewBlock(e,t,i){let n;try{const[r,a]=xp(e);n=new Ja(t,this.plugin,Sh,{query:r,warnings:a},!0)}catch(r){log.error(r),n=new Ja(t,this.plugin,yh,{error:r},!1)}i.addChild(n)}}class Ja extends F.MarkdownRenderChild{constructor(e,t,i,n,r){super(e),this.plugin=t,this.component=i,this.props=n}onload(){const e=this.component;this.root=Co(e,{target:this.containerEl,props:this.props})}onunload(){this.root&&Ao(this.root)}}var Jl=(s=>(s.createdTime="",s.scheduled_date="",s.startDate="",s.dueDate="",s.completedTime="",s.cancelled_date="",s))(Jl||{});class zp{parseDates(e){let t=this.getEmptydateHolder();const i="\\[\\s*(\\d{1,2}:\\d{2})(?:\\s*-\\s*(\\d{1,2}:\\d{2}))?\\s*\\]",n=new RegExp(i,"i"),r=e.match(n);let a,o;r&&(a=r[1],o=r[2]);for(const[l,c]of Object.entries(Jl)){let f=this.extractDates(l,e,c);if(f){if((l=="scheduled_date"||l=="startDate")&&a&&!f.hasATime){f.hasATime=!0,f.time=a;const p=`${f.date}T${a}`;f.isoDate=this.formatDateToISO(new Date(p))}if(l=="dueDate"&&!f.hasATime){let p="";if(a&&o?(p=o,f.hasATime=!0):a&&(p=a,f.hasATime=!0),p){f.time=p;const d=`${f.date}T${p}`;f.isoDate=this.formatDateToISO(new Date(d))}}f.hasATime&&(t.isAllDay=!f.hasATime),t[l]=f}}return t}addDatesToLine(e,t){let i=[],n="",r="",a=null;if(t.dateHolder?a=Object.keys(t.dateHolder):(y.warn("No DateHolder found: ",t.dateHolder),t.dateHolder=this.getEmptydateHolder()),a)for(let o=0;o<a.length;o++){const l=a[o];if(l=="isAllDay")continue;const c=t.dateHolder[l];if(c&&c.isoDate){const f=this.buildDateLineComponent(c.isoDate,c.emoji,i);switch(l){case"scheduled_date":case"startDate":n=f;break;case"dueDate":r=f;break}}}else y.error("Date Holder Keys Not found.");if(!t.isAllDay){let o=e.indexOf("]",0);o=o+1,n!=""&&r!=""?e=e.substring(0,o)+" ["+n+" - "+r+"] "+e.substring(o):n!=""?e=e.substring(0,o)+" ["+n+"]"+e.substring(o):r!=""&&(e=e.substring(0,o)+" ["+r+"]"+e.substring(o))}return i&&i.forEach(o=>{e+=" "+o}),e}stripDatesFromLine(e){let t,i=/[]\s(\d{4}-\d{2}-\d{2})(\s\d{1,}:\d{2})?/gus;t=e.replace(i,"");const n=/\[\s*(\d{1,2}:\d{2})(?:\s*-\s*(\d{1,2}:\d{2}))?\s*\]/gus;return t=t.replace(n,""),t}addDateHolderToTask(e,t){let i=this.getEmptydateHolder();"isAllDay"in e?"dueDate"in e&&(i.dueDate=this.getDateAndTime(e.dueDate,e.isAllDay,""),e.dueDate!==e.startDate&&(t?t.dateHolder.scheduled_date?i.scheduled_date=this.getDateAndTime(e.startDate,e.isAllDay,""):i.startDate=this.getDateAndTime(e.startDate,e.isAllDay,""):i.startDate=this.getDateAndTime(e.startDate,e.isAllDay,""))):e.dateHolder=i,e.completedTime&&(i.completedTime=this.getDateAndTime(e.completedTime,!1,"")),t&&(t.dateHolder.cancelled_date&&(i.cancelled_date=t.dateHolder.cancelled_date),t.dateHolder.createdTime&&(i.createdTime=t.dateHolder.createdTime)),e.dateHolder=i}areDatesChanged(e,t){var a,o;const i=e.dateHolder,n=t.dateHolder;if(!i){if(y.error("Edited Task has no dateholder"),n){const l=Object.keys(n);if(l)for(let c=0;c<l.length;c++){const f=l[c];if(f!="isAllDay"&&n[f])return!0}}return!1}if(!n)return y.error("Cached Task has no dateholder"),!0;const r=Object.keys(i);if(r)for(let l=0;l<r.length;l++){const c=r[l];if(c!="isAllDay"){if(i[c]&&!n[c])return!0;if(i[c]){let f=!1;if(i[c].hasATime?f=this.areDatesDifferent(i[c].isoDate,n[c].isoDate):f=((a=i[c])==null?void 0:a.date)!=((o=n[c])==null?void 0:o.date),f)return y.debug("dateChanged",{key:c,newDate:i[c].isoDate,oldDate:n[c].isoDate}),!0}if(!i[c]&&n[c])return!0}}return!1}formatDateToISO(e){return isNaN(e.getTime())?"Invalid Date":new Date(e.getTime()).toISOString().replace(/Z$/,"+0000")}utcToLocal(e){const t=new Date(e),i="en-US",n=Intl.DateTimeFormat().resolvedOptions().timeZone,r=t.toLocaleString(i,{timeZone:n}),[a,o]=r.split(", ");let[l,c,f]=a.split("/");if(l=String(l).padStart(2,"0"),c=String(c).padStart(2,"0"),o){let[p,d]=o.split(":");return r.includes("PM")&&p!=="12"?p=(Number(p)+12).toString():r.includes("AM")&&p==="12"&&(p="00"),p=String(p).padStart(2,"0"),d=String(d).padStart(2,"0"),`${f}-${l}-${c} ${p}:${d}`}return`${f}-${l}-${c}`}cleanDate(e){if(e.includes("+-")){e=e.replace("+-","-");let t=/(.*)([+-])(\d*)/;const i=e.match(t);i&&i[3].length<4&&(e=i[1]+"-0"+i[3])}return new Date(e)}getEmptydateHolder(){return{cancelled_date:null,createdTime:null,completedTime:null,dueDate:null,scheduled_date:null,startDate:null,isAllDay:!0}}getEmptyDate(){return{hasATime:!1,date:null,time:null,isoDate:null,emoji:null}}getDateAndTime(e,t,i){let n=this.getEmptyDate();n.isoDate=this.formatDateToISO(new Date(e));const a=this.utcToLocal(e).split(" ");return n.date=a[0],a[1]?n.time=a[1]:n.time="",n.hasATime=!t,n.emoji=i,n}buildDateLineComponent(e,t,i){let n=this.utcToLocal(e),r="",a=n.split(" "),o=t+" "+a[0];return i.push(o),a[1]&&(r=a[1]),r}extractDates(e,t,i){let n={};const r=`(${i})\\s(\\d{4}-\\d{2}-\\d{2})\\s*(\\d{1,}:\\d{2})*`;let a=t.match(r);if(a){let o=null,l=!1;if(!a[3])o=`${a[2]}T00:00:00.000`,l=!1;else{a[3].includes("24:")&&(a[3]=a[3].replace("24:","00:"));let[c,f]=a[3].split(":");c=String(c).padStart(2,"0"),f=String(f).padStart(2,"0"),o=`${a[2]}T${c}:${f}`,l=!0}o=this.formatDateToISO(new Date(o)),n={hasATime:l,date:a[2],time:a[3],isoDate:o,emoji:a[1]}}else n=null;return n}areDatesDifferent(e,t){const i=this.cleanDate(e),n=this.cleanDate(t);return i.getTime()!==n.getTime()}}class Gp extends F.Plugin{constructor(){super(...arguments),this.service=new Vu(this),this.taskParser=new id(this.app,this),this.fileOperation=new Uo(this.app,this),this.cacheOperation=new Bo(this.app,this),this.dateMan=new zp,this.lastLines=new Map}async onload(){this.app.workspace.onLayoutReady(async()=>{await this.pluginLoad()})}reloadInterval(){this.syncIntervalId&&(window.clearInterval(this.syncIntervalId),this.syncIntervalId=void 0);const e=O().automaticSynchronizationInterval*1e3;e!==0&&(this.syncIntervalId=window.setInterval(this.scheduledSynchronization.bind(this),e))}async onunload(){this.syncIntervalId&&window.clearInterval(this.syncIntervalId),y.debug("TickTickSync unloaded!")}async loadSettings(){try{let e=await this.loadData();try{e=await this.migrateData(e)}catch(i){return y.error("Failed to migrate data:",i),!1}e!=null&&e.TickTickTasksData&&($o(e.TickTickTasksData.projects),oi(e.TickTickTasksData.tasks),Mo(e.TickTickTasksData.projectGroups),delete e.TickTickTasksData);const t=Object.assign({},xo,e);Ee(t)}catch(e){return y.error(`Failed to load data:( ${e})`),!1}return!0}async saveSettings(){try{const e=O();e&&Object.keys(e).length>0?await this.saveData({...e,TickTickTasksData:{projects:pi(),tasks:ft()}}):y.warn("Settings are empty or invalid, not saving to avoid data loss.")}catch(e){y.error("Error saving settings:",e)}}async initializePlugin(){if(!O().token)return!1;if(!await this.saveProjectsToCache())return this.tickTickRestAPI=void 0,new F.Notice("TickTickSync plugin initialization failed, please check userID and password in settings."),!1;this.initializeModuleClass();try{O().skipBackup||this.service.backup()}catch(t){return y.error("error creating user data folder: ",t),new F.Notice("error creating user data folder"),!1}return new F.Notice("TickTickSync loaded successfully."+O().skipBackup?" Skipping backup.":"TickTick data has been backed up."),!0}initializeModuleClass(){this.tickTickRestAPI||(this.tickTickRestAPI=new zu(this.app,this,null))}async lineNumberCheck(){var o;const e=this.app.workspace.getActiveViewOfType(F.MarkdownView);if(!e)return!1;const t=e==null?void 0:e.editor.getCursor(),i=t==null?void 0:t.line;e.data;const n=(o=e==null?void 0:e.app.workspace.activeEditor)==null?void 0:o.file,r=n==null?void 0:n.name,a=n==null?void 0:n.path;if(typeof this.lastLines>"u"||typeof this.lastLines.get(r)>"u")return this.lastLines.set(r,i),!1;if(this.lastLines.has(r)&&i!==this.lastLines.get(r)){const l=this.lastLines.get(r),c=e.editor.getLine(l);return this.checkModuleClass()?(this.lastLines.set(r,i),await this.service.lineModifiedTaskCheck(a,c,l)):!1}return!1}async checkboxEventhandler(e,t){const i=e.target,n=i.checked;if(i.className==="task-list-item-checkbox"&&t){t.getCursor("from");const a=t.posAtMouse(e).line,o=t.getLine(a);if(this.taskParser.isMarkdownTask(o)){const l=this.taskParser.getTickTickId(o);l?n?await this.service.closeTask(l):await this.service.openTask(l):this.taskParser.getLineItemId(o)&&new F.Notice("Item will be updated on next sync")}}}checkModuleClass(){return O().token?(this.service.initialized||this.service.initialize(),this.tickTickRestAPI===void 0&&this.initializeModuleClass(),!0):(new F.Notice("Please login from settings."),!1)}async setStatusBarText(){var n,r;const e=this.app.workspace.getActiveViewOfType(F.MarkdownView);if(!e||!e.file){(n=this.statusBar)==null||n.setText("");return}const t=e.file.path;let i=await this.cacheOperation.getDefaultProjectNameForFilepath(t);i||(t.startsWith("Inbox")?i="Inbox":i="No default Project"),(r=this.statusBar)==null||r.setText(i)}async scheduledSynchronization(){if(!this.checkModuleClass())return;const e=performance.now();y.debug(`TickTick scheduled synchronization task started at ${new Date().toLocaleString()}`);try{await this.service.synchronization()}catch(i){y.error("An error occurred: ",i),new F.Notice(`An error occurred: ${i}`)}const t=performance.now();y.debug(`TickTick scheduled synchronization task completed at ${new Date().toLocaleString()}, took ${(t-e).toFixed(2)} ms`)}async saveProjectsToCache(){if(!this.checkModuleClass())return!1;let e=!1;const t=performance.now();y.debug(`TickTick saveProjectsToCache started at ${new Date().toLocaleString()}`);try{e=await this.service.saveProjectsToCache()}catch(n){y.error(`An error in saveProjectsToCache occurred:( ${n}`),new F.Notice(`An error in saveProjectsToCache occurred: ${n}`)}const i=performance.now();return y.debug(`TickTick saveProjectsToCache completed at ${new Date().toLocaleString()}, took ${(i-t).toFixed(2)} ms`),e}async pluginLoad(){if(this.addSettingTab(new vh(this.app,this)),!await this.loadSettings()){new F.Notice("Settings failed to load. Please reload the TickTickSync plugin.");return}y.setLevel(O().logLevel),y.info(`loading plugin "${this.manifest.name}" v${this.manifest.version}`);try{await this.initializePlugin()}catch(i){y.error(`API Initialization Failed.( ${i})`)}el.service.set(this.service);const t=new Vp(this);this.registerMarkdownCodeBlockProcessor("ticktick",t.onNewBlock.bind(t)),this.addRibbonIcon("sync","TickTickSync",async i=>{await this.synchronizeNow()}),this.registerEvents(),this.reloadInterval(),this.addCommand({id:"set-default-project-for-TickTick-task-in-the-current-file",name:"Set default TickTick project for current file",editorCallback:(i,n)=>{if(!n||!n.file){new F.Notice("No active file.");return}const r=n.file.path;new sd(this.app,this,r)}}),this.addCommand({id:"tts-sync",name:"Synchronize",callback:async()=>{await this.synchronizeNow()}}),this.statusBar=this.addStatusBarItem()}async synchronizeNow(){await this.scheduledSynchronization(),new F.Notice("Sync completed..")}registerEvents(){this.registerDomEvent(document,"keyup",async t=>{var n;if(!O().token)return;const i=(n=this.app.workspace.activeEditor)==null?void 0:n.editor;if(!(!i||!i.hasFocus())){if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","PageUp","PageDown"].includes(t.key)){if(!this.checkModuleClass())return;await this.lineNumberCheck()}if(["Delete","Backspace"].includes(t.key))try{if(!this.checkModuleClass())return;await this.service.deletedTaskCheck(null),await this.saveSettings()}catch(r){y.warn(`An error occurred while deleting tasks: ${r}`)}}}),this.registerDomEvent(document,"click",async t=>{var r;const{target:i}=t;if(!O().token)return;const n=(r=this.app.workspace.activeEditor)==null?void 0:r.editor;this.checkModuleClass()&&(await this.lineNumberCheck(),i&&i.type==="checkbox"&&await this.checkboxEventhandler(t,n))});let e;this.registerEvent(this.app.workspace.on("editor-change",async(t,i)=>{e=setTimeout(async()=>{clearTimeout(e);try{if(!O().token||O().enableFullVaultSync||(await this.lineNumberCheck(),!this.checkModuleClass()))return;await this.service.lineNewContentTaskCheck(t,i),await this.saveSettings()}catch(n){y.error("An error occurred while check new task in line: ",n)}},1e3)})),this.registerEvent(this.app.vault.on("delete",async t=>{if(t instanceof F.TFolder||!O().token)return;await this.service.deletedFileCheck(t.path)&&await this.saveSettings()})),this.registerEvent(this.app.vault.on("rename",async(t,i)=>{if(t instanceof F.TFolder||!O().token)return;await this.service.renamedFileCheck(t.path,i)&&await this.saveSettings()})),this.registerEvent(this.app.vault.on("modify",async t=>{try{if(!O().token)return;const i=t.path,n=this.app.workspace.getActiveFile();if((n==null?void 0:n.path)==i)return;await this.service.fullTextNewTaskCheck(i)}catch(i){y.error("An error occurred while modifying the file: ",i)}})),this.registerEvent(this.app.workspace.on("active-leaf-change",async t=>{await this.setStatusBarText()}))}async migrateData(e){if(!e)return e;const t=[];if(!e.version){const i=e.fileMetadata;if(Array.isArray(i))for(const n in i){const r=i[n];let a={};a={TickTickTasks:r.TickTickTasks.map(o=>({taskId:o,taskItems:[]})),TickTickCount:r.TickTickCount,defaultProjectId:r.defaultProjectId},i[n]=a}O().token&&await this.scheduledSynchronization()}return(!e.version||Kt(e.version,"1.0.10"))&&(delete e.username,delete e.password),(!e.version||Kt(e.version,"1.0.36"))&&(e.tagAndOr=1,t.push(["New Task Limiting rules","Please update your preferences in settings as needed.","priorTo1.0.36"])),(!e.version||Kt(e.version,"1.0.40"))&&t.push(["New Date/Time Handling","Old date formats will be converted on the next synchronization operation.","priorTo1.0.40"]),(!e.version||Kt(e.version,"1.1.1"))&&t.push(["Note Synchronization","TickTickSync will now synchronize Notes.","priorTo1.1.1"]),(!e.version||Kt(e.version,"1.1.7"))&&t.push(["Note and Default Project Settings","Note and Default Project settings improvements.","priorTo1.1.7"]),(!e.version||Kt(e.version,"1.1.8"))&&t.push(["Link to Tasks now Configurable","Link to Tasks are now Configurable.","priorTo1.1.8"]),(!e.version||Kt(e.version,"1.1.10"))&&t.push(["Several Changes",`Tasks stay where they are created.
Backups now configurable.
Note delimiter now configurable.`,"priorTo1.1.9"]),t.length>0&&await this.LatestChangesModal(t),(!e.version||Kt(e.version,this.manifest.version))&&(e.version=this.manifest.version,await this.saveSettings()),e}async LatestChangesModal(e){return await new nd(this.app,e,i=>{this.ret=i}).showModal()}}module.exports=Gp;

/* nosourcemap */